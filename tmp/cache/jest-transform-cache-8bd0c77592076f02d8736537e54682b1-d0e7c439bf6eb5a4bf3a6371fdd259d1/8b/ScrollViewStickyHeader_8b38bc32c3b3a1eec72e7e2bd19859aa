82edbe8110d93b4e82da098ad8ae92b7
'use strict';

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));

var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));

var _possibleConstructorReturn2 = _interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));

var _getPrototypeOf3 = _interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));

var _inherits2 = _interopRequireDefault(require("@babel/runtime/helpers/inherits"));

var AnimatedImplementation = require('../../Animated/src/AnimatedImplementation');

var React = require('react');

var StyleSheet = require('../../StyleSheet/StyleSheet');

var View = require('../View/View');

var AnimatedView = AnimatedImplementation.createAnimatedComponent(View);

var ScrollViewStickyHeader = function (_React$Component) {
  (0, _inherits2["default"])(ScrollViewStickyHeader, _React$Component);

  function ScrollViewStickyHeader() {
    var _getPrototypeOf2;

    var _this;

    (0, _classCallCheck2["default"])(this, ScrollViewStickyHeader);

    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {
      args[_key] = arguments[_key];
    }

    _this = (0, _possibleConstructorReturn2["default"])(this, (_getPrototypeOf2 = (0, _getPrototypeOf3["default"])(ScrollViewStickyHeader)).call.apply(_getPrototypeOf2, [this].concat(args)));
    _this.state = {
      measured: false,
      layoutY: 0,
      layoutHeight: 0,
      nextHeaderLayoutY: _this.props.nextHeaderLayoutY
    };

    _this._onLayout = function (event) {
      _this.setState({
        measured: true,
        layoutY: event.nativeEvent.layout.y,
        layoutHeight: event.nativeEvent.layout.height
      });

      _this.props.onLayout(event);

      var child = React.Children.only(_this.props.children);

      if (child.props.onLayout) {
        child.props.onLayout(event);
      }
    };

    return _this;
  }

  (0, _createClass2["default"])(ScrollViewStickyHeader, [{
    key: "setNextHeaderY",
    value: function setNextHeaderY(y) {
      this.setState({
        nextHeaderLayoutY: y
      });
    }
  }, {
    key: "render",
    value: function render() {
      var _this$props = this.props,
          inverted = _this$props.inverted,
          scrollViewHeight = _this$props.scrollViewHeight;
      var _this$state = this.state,
          measured = _this$state.measured,
          layoutHeight = _this$state.layoutHeight,
          layoutY = _this$state.layoutY,
          nextHeaderLayoutY = _this$state.nextHeaderLayoutY;
      var inputRange = [-1, 0];
      var outputRange = [0, 0];

      if (measured) {
        if (inverted) {
          if (scrollViewHeight != null) {
            var stickStartPoint = layoutY + layoutHeight - scrollViewHeight;

            if (stickStartPoint > 0) {
              inputRange.push(stickStartPoint);
              outputRange.push(0);
              inputRange.push(stickStartPoint + 1);
              outputRange.push(1);
              var collisionPoint = (nextHeaderLayoutY || 0) - layoutHeight - scrollViewHeight;

              if (collisionPoint > stickStartPoint) {
                inputRange.push(collisionPoint, collisionPoint + 1);
                outputRange.push(collisionPoint - stickStartPoint, collisionPoint - stickStartPoint);
              }
            }
          }
        } else {
          inputRange.push(layoutY);
          outputRange.push(0);

          var _collisionPoint = (nextHeaderLayoutY || 0) - layoutHeight;

          if (_collisionPoint >= layoutY) {
            inputRange.push(_collisionPoint, _collisionPoint + 1);
            outputRange.push(_collisionPoint - layoutY, _collisionPoint - layoutY);
          } else {
            inputRange.push(layoutY + 1);
            outputRange.push(1);
          }
        }
      }

      var translateY = this.props.scrollAnimatedValue.interpolate({
        inputRange: inputRange,
        outputRange: outputRange
      });
      var child = React.Children.only(this.props.children);
      return React.createElement(AnimatedView, {
        collapsable: false,
        onLayout: this._onLayout,
        style: [child.props.style, styles.header, {
          transform: [{
            translateY: translateY
          }]
        }]
      }, React.cloneElement(child, {
        style: styles.fill,
        onLayout: undefined
      }));
    }
  }]);
  return ScrollViewStickyHeader;
}(React.Component);

var styles = StyleSheet.create({
  header: {
    zIndex: 10
  },
  fill: {
    flex: 1
  }
});
module.exports = ScrollViewStickyHeader;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIlNjcm9sbFZpZXdTdGlja3lIZWFkZXIuanMiXSwibmFtZXMiOlsiQW5pbWF0ZWRJbXBsZW1lbnRhdGlvbiIsInJlcXVpcmUiLCJSZWFjdCIsIlN0eWxlU2hlZXQiLCJWaWV3IiwiQW5pbWF0ZWRWaWV3IiwiY3JlYXRlQW5pbWF0ZWRDb21wb25lbnQiLCJTY3JvbGxWaWV3U3RpY2t5SGVhZGVyIiwic3RhdGUiLCJtZWFzdXJlZCIsImxheW91dFkiLCJsYXlvdXRIZWlnaHQiLCJuZXh0SGVhZGVyTGF5b3V0WSIsInByb3BzIiwiX29uTGF5b3V0IiwiZXZlbnQiLCJzZXRTdGF0ZSIsIm5hdGl2ZUV2ZW50IiwibGF5b3V0IiwieSIsImhlaWdodCIsIm9uTGF5b3V0IiwiY2hpbGQiLCJDaGlsZHJlbiIsIm9ubHkiLCJjaGlsZHJlbiIsImludmVydGVkIiwic2Nyb2xsVmlld0hlaWdodCIsImlucHV0UmFuZ2UiLCJvdXRwdXRSYW5nZSIsInN0aWNrU3RhcnRQb2ludCIsInB1c2giLCJjb2xsaXNpb25Qb2ludCIsInRyYW5zbGF0ZVkiLCJzY3JvbGxBbmltYXRlZFZhbHVlIiwiaW50ZXJwb2xhdGUiLCJzdHlsZSIsInN0eWxlcyIsImhlYWRlciIsInRyYW5zZm9ybSIsImNsb25lRWxlbWVudCIsImZpbGwiLCJ1bmRlZmluZWQiLCJDb21wb25lbnQiLCJjcmVhdGUiLCJ6SW5kZXgiLCJmbGV4IiwibW9kdWxlIiwiZXhwb3J0cyJdLCJtYXBwaW5ncyI6IkFBU0E7Ozs7Ozs7Ozs7Ozs7O0FBRUEsSUFBTUEsc0JBQXNCLEdBQUdDLE9BQU8sQ0FBQywyQ0FBRCxDQUF0Qzs7QUFDQSxJQUFNQyxLQUFLLEdBQUdELE9BQU8sQ0FBQyxPQUFELENBQXJCOztBQUNBLElBQU1FLFVBQVUsR0FBR0YsT0FBTyxDQUFDLDZCQUFELENBQTFCOztBQUNBLElBQU1HLElBQUksR0FBR0gsT0FBTyxDQUFDLGNBQUQsQ0FBcEI7O0FBSUEsSUFBTUksWUFBWSxHQUFHTCxzQkFBc0IsQ0FBQ00s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QUFRLEVBQUVxQjtBQUZlLE9BQTFCLENBSkgsQ0FERjtBQVdEOzs7RUEvR2tDeEMsS0FBSyxDQUFDeUMsUzs7QUFrSDNDLElBQU1OLE1BQU0sR0FBR2xDLFVBQVUsQ0FBQ3lDLE1BQVgsQ0FBa0I7QUFDL0JOLEVBQUFBLE1BQU0sRUFBRTtBQUNOTyxJQUFBQSxNQUFNLEVBQUU7QUFERixHQUR1QjtBQUkvQkosRUFBQUEsSUFBSSxFQUFFO0FBQ0pLLElBQUFBLElBQUksRUFBRTtBQURGO0FBSnlCLENBQWxCLENBQWY7QUFTQUMsTUFBTSxDQUFDQyxPQUFQLEdBQWlCekMsc0JBQWpCIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBDb3B5cmlnaHQgKGMpIEZhY2Vib29rLCBJbmMuIGFuZCBpdHMgYWZmaWxpYXRlcy5cbiAqXG4gKiBUaGlzIHNvdXJjZSBjb2RlIGlzIGxpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgbGljZW5zZSBmb3VuZCBpbiB0aGVcbiAqIExJQ0VOU0UgZmlsZSBpbiB0aGUgcm9vdCBkaXJlY3Rvcnkgb2YgdGhpcyBzb3VyY2UgdHJlZS5cbiAqXG4gKiBAZmxvd1xuICogQGZvcm1hdFxuICovXG4ndXNlIHN0cmljdCc7XG5cbmNvbnN0IEFuaW1hdGVkSW1wbGVtZW50YXRpb24gPSByZXF1aXJlKCcuLi8uLi9BbmltYXRlZC9zcmMvQW5pbWF0ZWRJbXBsZW1lbnRhdGlvbicpO1xuY29uc3QgUmVhY3QgPSByZXF1aXJlKCdyZWFjdCcpO1xuY29uc3QgU3R5bGVTaGVldCA9IHJlcXVpcmUoJy4uLy4uL1N0eWxlU2hlZXQvU3R5bGVTaGVldCcpO1xuY29uc3QgVmlldyA9IHJlcXVpcmUoJy4uL1ZpZXcvVmlldycpO1xuXG5pbXBvcnQgdHlwZSB7TGF5b3V0RXZlbnR9IGZyb20gJy4uLy4uL1R5cGVzL0NvcmVFdmVudFR5cGVzJztcblxuY29uc3QgQW5pbWF0ZWRWaWV3ID0gQW5pbWF0ZWRJbXBsZW1lbnRhdGlvbi5jcmVhdGVBbmltYXRlZENvbXBvbmVudChWaWV3KTtcblxuZXhwb3J0IHR5cGUgUHJvcHMgPSB7XG4gIGNoaWxkcmVuPzogUmVhY3QuRWxlbWVudDxhbnk+LFxuICBuZXh0SGVhZGVyTGF5b3V0WTogP251bWJlcixcbiAgb25MYXlvdXQ6IChldmVudDogTGF5b3V0RXZlbnQpID0+IHZvaWQsXG4gIHNjcm9sbEFuaW1hdGVkVmFsdWU6IEFuaW1hdGVkSW1wbGVtZW50YXRpb24uVmFsdWUsXG4gIC8vIFdpbGwgY2F1c2Ugc3RpY2t5IGhlYWRlcnMgdG8gc3RpY2sgYXQgdGhlIGJvdHRvbSBvZiB0aGUgU2Nyb2xsVmlldyBpbnN0ZWFkXG4gIC8vIG9mIHRoZSB0b3AuXG4gIGludmVydGVkOiA/Ym9vbGVhbixcbiAgLy8gVGhlIGhlaWdodCBvZiB0aGUgcGFyZW50IFNjcm9sbFZpZXcuIEN1cnJlbnRseSBvbmx5IHNldCB3aGVuIGludmVydGVkLlxuICBzY3JvbGxWaWV3SGVpZ2h0OiA/bnVtYmVyLFxufTtcblxudHlwZSBTdGF0ZSA9IHtcbiAgbWVhc3VyZWQ6IGJvb2xlYW4sXG4gIGxheW91dFk6IG51bWJlcixcbiAgbGF5b3V0SGVpZ2h0OiBudW1iZXIsXG4gIG5leHRIZWFkZXJMYXlvdXRZOiA/bnVtYmVyLFxufTtcblxuY2xhc3MgU2Nyb2xsVmlld1N0aWNreUhlYWRlciBleHRlbmRzIFJlYWN0LkNvbXBvbmVudDxQcm9wcywgU3RhdGU+IHtcbiAgc3RhdGU6IFN0YXRlID0ge1xuICAgIG1lYXN1cmVkOiBmYWxzZSxcbiAgICBsYXlvdXRZOiAwLFxuICAgIGxheW91dEhlaWdodDogMCxcbiAgICBuZXh0SGVhZGVyTGF5b3V0WTogdGhpcy5wcm9wcy5uZXh0SGVhZGVyTGF5b3V0WSxcbiAgfTtcblxuICBzZXROZXh0SGVhZGVyWSh5OiBudW1iZXIpIHtcbiAgICB0aGlzLnNldFN0YXRlKHtuZXh0SGVhZGVyTGF5b3V0WTogeX0pO1xuICB9XG5cbiAgX29uTGF5b3V0ID0gZXZlbnQgPT4ge1xuICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgbWVhc3VyZWQ6IHRydWUsXG4gICAgICBsYXlvdXRZOiBldmVudC5uYXRpdmVFdmVudC5sYXlvdXQueSxcbiAgICAgIGxheW91dEhlaWdodDogZXZlbnQubmF0aXZlRXZlbnQubGF5b3V0LmhlaWdodCxcbiAgICB9KTtcblxuICAgIHRoaXMucHJvcHMub25MYXlvdXQoZXZlbnQpO1xuICAgIGNvbnN0IGNoaWxkID0gUmVhY3QuQ2hpbGRyZW4ub25seSh0aGlzLnByb3BzLmNoaWxkcmVuKTtcbiAgICBpZiAoY2hpbGQucHJvcHMub25MYXlvdXQpIHtcbiAgICAgIGNoaWxkLnByb3BzLm9uTGF5b3V0KGV2ZW50KTtcbiAgICB9XG4gIH07XG5cbiAgcmVuZGVyKCk6IFJlYWN0Lk5vZGUge1xuICAgIGNvbnN0IHtpbnZlcnRlZCwgc2Nyb2xsVmlld0hlaWdodH0gPSB0aGlzLnByb3BzO1xuICAgIGNvbnN0IHttZWFzdXJlZCwgbGF5b3V0SGVpZ2h0LCBsYXlvdXRZLCBuZXh0SGVhZGVyTGF5b3V0WX0gPSB0aGlzLnN0YXRlO1xuICAgIGNvbnN0IGlucHV0UmFuZ2U6IEFycmF5PG51bWJlcj4gPSBbLTEsIDBdO1xuICAgIGNvbnN0IG91dHB1dFJhbmdlOiBBcnJheTxudW1iZXI+ID0gWzAsIDBdO1xuXG4gICAgaWYgKG1lYXN1cmVkKSB7XG4gICAgICBpZiAoaW52ZXJ0ZWQpIHtcbiAgICAgICAgLy8gVGhlIGludGVycG9sYXRpb24gbG9va3MgbGlrZTpcbiAgICAgICAgLy8gLSBOZWdhdGl2ZSBzY3JvbGw6IG5vIHRyYW5zbGF0aW9uXG4gICAgICAgIC8vIC0gYHN0aWNrU3RhcnRQb2ludGAgaXMgdGhlIHBvaW50IGF0IHdoaWNoIHRoZSBoZWFkZXIgd2lsbCBzdGFydCBzdGlja2luZy5cbiAgICAgICAgLy8gICBJdCBpcyBjYWxjdWxhdGVkIHVzaW5nIHRoZSBTY3JvbGxWaWV3IHZpZXdwb3J0IGhlaWdodCBzbyBpdCBpcyBhIHRoZSBib3R0b20uXG4gICAgICAgIC8vIC0gSGVhZGVycyB0aGF0IGFyZSBpbiB0aGUgaW5pdGlhbCB2aWV3cG9ydCB3aWxsIG5ldmVyIHN0aWNrLCBgc3RpY2tTdGFydFBvaW50YFxuICAgICAgICAvLyAgIHdpbGwgYmUgbmVnYXRpdmUuXG4gICAgICAgIC8vIC0gRnJvbSAwIHRvIGBzdGlja1N0YXJ0UG9pbnRgIG5vIHRyYW5zbGF0aW9uLiBUaGlzIHdpbGwgY2F1c2UgdGhlIGhlYWRlclxuICAgICAgICAvLyAgIHRvIHNjcm9sbCBub3JtYWxseSB1bnRpbCBpdCByZWFjaGVzIHRoZSB0b3Agb2YgdGhlIHNjcm9sbCB2aWV3LlxuICAgICAgICAvLyAtIEZyb20gYHN0aWNrU3RhcnRQb2ludGAgdG8gd2hlbiB0aGUgbmV4dCBoZWFkZXIgeSBoaXRzIHRoZSBib3R0b20gZWRnZSBvZiB0aGUgaGVhZGVyOiB0cmFuc2xhdGVcbiAgICAgICAgLy8gICBlcXVhbGx5IHRvIHNjcm9sbC4gVGhpcyB3aWxsIGNhdXNlIHRoZSBoZWFkZXIgdG8gc3RheSBhdCB0aGUgdG9wIG9mIHRoZSBzY3JvbGwgdmlldy5cbiAgICAgICAgLy8gLSBQYXN0IHRoZSBjb2xsaXNpb24gd2l0aCB0aGUgbmV4dCBoZWFkZXIgeTogbm8gbW9yZSB0cmFuc2xhdGlvbi4gVGhpcyB3aWxsIGNhdXNlIHRoZVxuICAgICAgICAvLyAgIGhlYWRlciB0byBjb250aW51ZSBzY3JvbGxpbmcgdXAgYW5kIG1ha2Ugcm9vbSBmb3IgdGhlIG5leHQgc3RpY2t5IGhlYWRlci5cbiAgICAgICAgLy8gICBJbiB0aGUgY2FzZSB0aGF0IHRoZXJlIGlzIG5vIG5leHQgaGVhZGVyIGp1c3QgdHJhbnNsYXRlIGVxdWFsbHkgdG9cbiAgICAgICAgLy8gICBzY3JvbGwgaW5kZWZpbml0ZWx5LlxuICAgICAgICBpZiAoc2Nyb2xsVmlld0hlaWdodCAhPSBudWxsKSB7XG4gICAgICAgICAgY29uc3Qgc3RpY2tTdGFydFBvaW50ID0gbGF5b3V0WSArIGxheW91dEhlaWdodCAtIHNjcm9sbFZpZXdIZWlnaHQ7XG4gICAgICAgICAgaWYgKHN0aWNrU3RhcnRQb2ludCA+IDApIHtcbiAgICAgICAgICAgIGlucHV0UmFuZ2UucHVzaChzdGlja1N0YXJ0UG9pbnQpO1xuICAgICAgICAgICAgb3V0cHV0UmFuZ2UucHVzaCgwKTtcbiAgICAgICAgICAgIGlucHV0UmFuZ2UucHVzaChzdGlja1N0YXJ0UG9pbnQgKyAxKTtcbiAgICAgICAgICAgIG91dHB1dFJhbmdlLnB1c2goMSk7XG4gICAgICAgICAgICAvLyBJZiB0aGUgbmV4dCBzdGlja3kgaGVhZGVyIGhhcyBub3QgbG9hZGVkIHlldCAocHJvYmFibHkgd2luZG93aW5nKSBvciBpcyB0aGUgbGFzdFxuICAgICAgICAgICAgLy8gd2UgY2FuIGp1c3Qga2VlcCBpdCBzdGlja2VkIGZvcmV2ZXIuXG4gICAgICAgICAgICBjb25zdCBjb2xsaXNpb25Qb2ludCA9XG4gICAgICAgICAgICAgIChuZXh0SGVhZGVyTGF5b3V0WSB8fCAwKSAtIGxheW91dEhlaWdodCAtIHNjcm9sbFZpZXdIZWlnaHQ7XG4gICAgICAgICAgICBpZiAoY29sbGlzaW9uUG9pbnQgPiBzdGlja1N0YXJ0UG9pbnQpIHtcbiAgICAgICAgICAgICAgaW5wdXRSYW5nZS5wdXNoKGNvbGxpc2lvblBvaW50LCBjb2xsaXNpb25Qb2ludCArIDEpO1xuICAgICAgICAgICAgICBvdXRwdXRSYW5nZS5wdXNoKFxuICAgICAgICAgICAgICAgIGNvbGxpc2lvblBvaW50IC0gc3RpY2tTdGFydFBvaW50LFxuICAgICAgICAgICAgICAgIGNvbGxpc2lvblBvaW50IC0gc3RpY2tTdGFydFBvaW50LFxuICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gVGhlIGludGVycG9sYXRpb24gbG9va3MgbGlrZTpcbiAgICAgICAgLy8gLSBOZWdhdGl2ZSBzY3JvbGw6IG5vIHRyYW5zbGF0aW9uXG4gICAgICAgIC8vIC0gRnJvbSAwIHRvIHRoZSB5IG9mIHRoZSBoZWFkZXI6IG5vIHRyYW5zbGF0aW9uLiBUaGlzIHdpbGwgY2F1c2UgdGhlIGhlYWRlclxuICAgICAgICAvLyAgIHRvIHNjcm9sbCBub3JtYWxseSB1bnRpbCBpdCByZWFjaGVzIHRoZSB0b3Agb2YgdGhlIHNjcm9sbCB2aWV3LlxuICAgICAgICAvLyAtIEZyb20gaGVhZGVyIHkgdG8gd2hlbiB0aGUgbmV4dCBoZWFkZXIgeSBoaXRzIHRoZSBib3R0b20gZWRnZSBvZiB0aGUgaGVhZGVyOiB0cmFuc2xhdGVcbiAgICAgICAgLy8gICBlcXVhbGx5IHRvIHNjcm9sbC4gVGhpcyB3aWxsIGNhdXNlIHRoZSBoZWFkZXIgdG8gc3RheSBhdCB0aGUgdG9wIG9mIHRoZSBzY3JvbGwgdmlldy5cbiAgICAgICAgLy8gLSBQYXN0IHRoZSBjb2xsaXNpb24gd2l0aCB0aGUgbmV4dCBoZWFkZXIgeTogbm8gbW9yZSB0cmFuc2xhdGlvbi4gVGhpcyB3aWxsIGNhdXNlIHRoZVxuICAgICAgICAvLyAgIGhlYWRlciB0byBjb250aW51ZSBzY3JvbGxpbmcgdXAgYW5kIG1ha2Ugcm9vbSBmb3IgdGhlIG5leHQgc3RpY2t5IGhlYWRlci5cbiAgICAgICAgLy8gICBJbiB0aGUgY2FzZSB0aGF0IHRoZXJlIGlzIG5vIG5leHQgaGVhZGVyIGp1c3QgdHJhbnNsYXRlIGVxdWFsbHkgdG9cbiAgICAgICAgLy8gICBzY3JvbGwgaW5kZWZpbml0ZWx5LlxuICAgICAgICBpbnB1dFJhbmdlLnB1c2gobGF5b3V0WSk7XG4gICAgICAgIG91dHB1dFJhbmdlLnB1c2goMCk7XG4gICAgICAgIC8vIElmIHRoZSBuZXh0IHN0aWNreSBoZWFkZXIgaGFzIG5vdCBsb2FkZWQgeWV0IChwcm9iYWJseSB3aW5kb3dpbmcpIG9yIGlzIHRoZSBsYXN0XG4gICAgICAgIC8vIHdlIGNhbiBqdXN0IGtlZXAgaXQgc3RpY2tlZCBmb3JldmVyLlxuICAgICAgICBjb25zdCBjb2xsaXNpb25Qb2ludCA9IChuZXh0SGVhZGVyTGF5b3V0WSB8fCAwKSAtIGxheW91dEhlaWdodDtcbiAgICAgICAgaWYgKGNvbGxpc2lvblBvaW50ID49IGxheW91dFkpIHtcbiAgICAgICAgICBpbnB1dFJhbmdlLnB1c2goY29sbGlzaW9uUG9pbnQsIGNvbGxpc2lvblBvaW50ICsgMSk7XG4gICAgICAgICAgb3V0cHV0UmFuZ2UucHVzaChjb2xsaXNpb25Qb2ludCAtIGxheW91dFksIGNvbGxpc2lvblBvaW50IC0gbGF5b3V0WSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgaW5wdXRSYW5nZS5wdXNoKGxheW91dFkgKyAxKTtcbiAgICAgICAgICBvdXRwdXRSYW5nZS5wdXNoKDEpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgY29uc3QgdHJhbnNsYXRlWSA9IHRoaXMucHJvcHMuc2Nyb2xsQW5pbWF0ZWRWYWx1ZS5pbnRlcnBvbGF0ZSh7XG4gICAgICBpbnB1dFJhbmdlLFxuICAgICAgb3V0cHV0UmFuZ2UsXG4gICAgfSk7XG4gICAgY29uc3QgY2hpbGQgPSBSZWFjdC5DaGlsZHJlbi5vbmx5KHRoaXMucHJvcHMuY2hpbGRyZW4pO1xuXG4gICAgcmV0dXJuIChcbiAgICAgIDxBbmltYXRlZFZpZXdcbiAgICAgICAgY29sbGFwc2FibGU9e2ZhbHNlfVxuICAgICAgICBvbkxheW91dD17dGhpcy5fb25MYXlvdXR9XG4gICAgICAgIHN0eWxlPXtbY2hpbGQucHJvcHMuc3R5bGUsIHN0eWxlcy5oZWFkZXIsIHt0cmFuc2Zvcm06IFt7dHJhbnNsYXRlWX1dfV19PlxuICAgICAgICB7UmVhY3QuY2xvbmVFbGVtZW50KGNoaWxkLCB7XG4gICAgICAgICAgc3R5bGU6IHN0eWxlcy5maWxsLCAvLyBXZSB0cmFuc2ZlciB0aGUgY2hpbGQgc3R5bGUgdG8gdGhlIHdyYXBwZXIuXG4gICAgICAgICAgb25MYXlvdXQ6IHVuZGVmaW5lZCwgLy8gd2UgY2FsbCB0aGlzIG1hbnVhbGx5IHRocm91Z2ggb3VyIHRoaXMuX29uTGF5b3V0XG4gICAgICAgIH0pfVxuICAgICAgPC9BbmltYXRlZFZpZXc+XG4gICAgKTtcbiAgfVxufVxuXG5jb25zdCBzdHlsZXMgPSBTdHlsZVNoZWV0LmNyZWF0ZSh7XG4gIGhlYWRlcjoge1xuICAgIHpJbmRleDogMTAsXG4gIH0sXG4gIGZpbGw6IHtcbiAgICBmbGV4OiAxLFxuICB9LFxufSk7XG5cbm1vZHVsZS5leHBvcnRzID0gU2Nyb2xsVmlld1N0aWNreUhlYWRlcjtcbiJdfQ==