4f66ec7d0278e7123e698c13c914ab7d
'use strict';

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));

var _possibleConstructorReturn2 = _interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));

var _getPrototypeOf3 = _interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));

var _inherits2 = _interopRequireDefault(require("@babel/runtime/helpers/inherits"));

var _wrapNativeSuper2 = _interopRequireDefault(require("@babel/runtime/helpers/wrapNativeSuper"));

var SyntheticError = function (_Error) {
  (0, _inherits2["default"])(SyntheticError, _Error);

  function SyntheticError() {
    var _getPrototypeOf2;

    var _this;

    (0, _classCallCheck2["default"])(this, SyntheticError);

    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {
      args[_key] = arguments[_key];
    }

    _this = (0, _possibleConstructorReturn2["default"])(this, (_getPrototypeOf2 = (0, _getPrototypeOf3["default"])(SyntheticError)).call.apply(_getPrototypeOf2, [this].concat(args)));
    _this.name = '';
    return _this;
  }

  return SyntheticError;
}((0, _wrapNativeSuper2["default"])(Error));

var exceptionID = 0;

function reportException(e, isFatal) {
  var NativeExceptionsManager = require('./NativeExceptionsManager')["default"];

  if (NativeExceptionsManager) {
    var parseErrorStack = require('./Devtools/parseErrorStack');

    var stack = parseErrorStack(e);
    var currentExceptionID = ++exceptionID;
    var originalMessage = e.message || '';
    var message = originalMessage;

    if (e.componentStack != null) {
      message += "\n\nThis error is located at:" + e.componentStack;
    }

    var namePrefix = e.name == null || e.name === '' ? '' : e.name + ": ";
    var isFromConsoleError = e.name === 'console.error';

    if (!message.startsWith(namePrefix)) {
      message = namePrefix + message;
    }

    if (!isFromConsoleError) {
      if (console._errorOriginal) {
        console._errorOriginal(message);
      } else {
        console.error(message);
      }
    }

    message = e.jsEngine == null ? message : message + ", js engine: " + e.jsEngine;
    NativeExceptionsManager.reportException({
      message: message,
      originalMessage: message === originalMessage ? null : originalMessage,
      name: e.name == null || e.name === '' ? null : e.name,
      componentStack: typeof e.componentStack === 'string' ? e.componentStack : null,
      stack: stack,
      id: currentExceptionID,
      isFatal: isFatal,
      extraData: {
        jsEngine: e.jsEngine,
        rawStack: e.stack,
        framesPopped: e.framesToPop
      }
    });

    if (__DEV__) {
      if (e.preventSymbolication === true) {
        return;
      }

      var symbolicateStackTrace = require('./Devtools/symbolicateStackTrace');

      symbolicateStackTrace(stack).then(function (prettyStack) {
        if (prettyStack) {
          var stackWithoutCollapsedFrames = prettyStack.filter(function (frame) {
            return !frame.collapse;
          });
          NativeExceptionsManager.updateExceptionMessage(message, stackWithoutCollapsedFrames, currentExceptionID);
        } else {
          throw new Error('The stack is null');
        }
      })["catch"](function (error) {
        console.log('Unable to symbolicate stack trace: ' + error.message);
      });
    }
  }
}

function handleException(e, isFatal) {
  var error;

  if (e instanceof Error) {
    error = e;
  } else {
    error = new SyntheticError(e);
  }

  reportException(error, isFatal);
}

function reactConsoleErrorHandler() {
  if (!console.reportErrorsAsExceptions) {
    console._errorOriginal.apply(console, arguments);

    return;
  }

  if (arguments[0] && arguments[0].stack) {
    reportException(arguments[0], false);
  } else {
    console._errorOriginal.apply(console, arguments);

    var stringifySafe = require('../Utilities/stringifySafe');

    var str = Array.prototype.map.call(arguments, stringifySafe).join(', ');

    if (str.slice(0, 10) === '"Warning: ') {
      return;
    }

    var _error = new SyntheticError(str);

    _error.name = 'console.error';
    _error.framesToPop = (_error.framesToPop || 0) + 1;
    reportException(_error, false);
  }
}

function installConsoleErrorReporter() {
  if (console._errorOriginal) {
    return;
  }

  console._errorOriginal = console.error.bind(console);
  console.error = reactConsoleErrorHandler;

  if (console.reportErrorsAsExceptions === undefined) {
    console.reportErrorsAsExceptions = true;
  }
}

module.exports = {
  handleException: handleException,
  installConsoleErrorReporter: installConsoleErrorReporter,
  SyntheticError: SyntheticError
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkV4Y2VwdGlvbnNNYW5hZ2VyLmpzIl0sIm5hbWVzIjpbIlN5bnRoZXRpY0Vycm9yIiwibmFtZSIsIkVycm9yIiwiZXhjZXB0aW9uSUQiLCJyZXBvcnRFeGNlcHRpb24iLCJlIiwiaXNGYXRhbCIsIk5hdGl2ZUV4Y2VwdGlvbnNNYW5hZ2VyIiwicmVxdWlyZSIsInBhcnNlRXJyb3JTdGFjayIsInN0YWNrIiwiY3VycmVudEV4Y2VwdGlvbklEIiwib3JpZ2luYWxNZXNzYWdlIiwibWVzc2FnZSIsImNvbXBvbmVudFN0YWNrIiwibmFtZVByZWZpeCIsImlzRnJvbUNvbnNvbGVFcnJvciIsInN0YXJ0c1dpdGgiLCJjb25zb2xlIiwiX2Vycm9yT3JpZ2luYWwiLCJlcnJvciIsImpzRW5naW5lIiwiaWQiLCJleHRyYURhdGEiLCJyYXdTdGFjayIsImZyYW1lc1BvcHBlZCIsImZyYW1lc1RvUG9wIiwiX19ERVZfXyIsInByZXZlbnRTeW1ib2xpY2F0aW9uIiwic3ltYm9saWNhdGVTdGFja1RyYWNlIiwidGhlbiIsInByZXR0eVN0YWNrIiwic3RhY2tXaXRob3V0Q29sbGFwc2VkRnJhbWVzIiwiZmlsdGVyIiwiZnJhbWUiLCJjb2xsYXBzZSIsInVwZGF0ZUV4Y2VwdGlvbk1lc3NhZ2UiLCJsb2ciLCJoYW5kbGVFeGNlcHRpb24iLCJyZWFjdENvbnNvbGVFcnJvckhhbmRsZXIiLCJyZXBvcnRFcnJvcnNBc0V4Y2VwdGlvbnMiLCJhcHBseSIsImFyZ3VtZW50cyIsInN0cmluZ2lmeVNhZmUiLCJzdHIiLCJBcnJheSIsInByb3RvdHlwZSIsIm1hcCIsImNhbGwiLCJqb2luIiwic2xpY2UiLCJpbnN0YWxsQ29uc29sZUVycm9yUmVwb3J0ZXIiLCJiaW5kIiwidW5kZWZpbmVkIiwibW9kdWxlIiwiZXhwb3J0cyJdLCJtYXBwaW5ncyI6IkFBVUE7Ozs7Ozs7Ozs7Ozs7O0lBSU1BLGM7Ozs7Ozs7Ozs7Ozs7OztVQUNKQyxJLEdBQWUsRTs7Ozs7b0NBRFlDLEs7O0FBTzdCLElB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LEdBQWlCO0FBQUNqQixFQUFBQSxlQUFlLEVBQWZBLGVBQUQ7QUFBa0JhLEVBQUFBLDJCQUEyQixFQUEzQkEsMkJBQWxCO0FBQStDbkQsRUFBQUEsY0FBYyxFQUFkQTtBQUEvQyxDQUFqQiIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQ29weXJpZ2h0IChjKSBGYWNlYm9vaywgSW5jLiBhbmQgaXRzIGFmZmlsaWF0ZXMuXG4gKlxuICogVGhpcyBzb3VyY2UgY29kZSBpcyBsaWNlbnNlZCB1bmRlciB0aGUgTUlUIGxpY2Vuc2UgZm91bmQgaW4gdGhlXG4gKiBMSUNFTlNFIGZpbGUgaW4gdGhlIHJvb3QgZGlyZWN0b3J5IG9mIHRoaXMgc291cmNlIHRyZWUuXG4gKlxuICogQGZvcm1hdFxuICogQGZsb3cgc3RyaWN0LWxvY2FsXG4gKi9cblxuJ3VzZSBzdHJpY3QnO1xuXG5pbXBvcnQgdHlwZSB7RXh0ZW5kZWRFcnJvcn0gZnJvbSAnLi9EZXZ0b29scy9wYXJzZUVycm9yU3RhY2snO1xuXG5jbGFzcyBTeW50aGV0aWNFcnJvciBleHRlbmRzIEVycm9yIHtcbiAgbmFtZTogc3RyaW5nID0gJyc7XG59XG5cbi8qKlxuICogSGFuZGxlcyB0aGUgZGV2ZWxvcGVyLXZpc2libGUgYXNwZWN0IG9mIGVycm9ycyBhbmQgZXhjZXB0aW9uc1xuICovXG5sZXQgZXhjZXB0aW9uSUQgPSAwO1xuZnVuY3Rpb24gcmVwb3J0RXhjZXB0aW9uKGU6IEV4dGVuZGVkRXJyb3IsIGlzRmF0YWw6IGJvb2xlYW4pIHtcbiAgY29uc3QgTmF0aXZlRXhjZXB0aW9uc01hbmFnZXIgPSByZXF1aXJlKCcuL05hdGl2ZUV4Y2VwdGlvbnNNYW5hZ2VyJykuZGVmYXVsdDtcbiAgaWYgKE5hdGl2ZUV4Y2VwdGlvbnNNYW5hZ2VyKSB7XG4gICAgY29uc3QgcGFyc2VFcnJvclN0YWNrID0gcmVxdWlyZSgnLi9EZXZ0b29scy9wYXJzZUVycm9yU3RhY2snKTtcbiAgICBjb25zdCBzdGFjayA9IHBhcnNlRXJyb3JTdGFjayhlKTtcbiAgICBjb25zdCBjdXJyZW50RXhjZXB0aW9uSUQgPSArK2V4Y2VwdGlvbklEO1xuICAgIGNvbnN0IG9yaWdpbmFsTWVzc2FnZSA9IGUubWVzc2FnZSB8fCAnJztcbiAgICBsZXQgbWVzc2FnZSA9IG9yaWdpbmFsTWVzc2FnZTtcbiAgICBpZiAoZS5jb21wb25lbnRTdGFjayAhPSBudWxsKSB7XG4gICAgICBtZXNzYWdlICs9IGBcXG5cXG5UaGlzIGVycm9yIGlzIGxvY2F0ZWQgYXQ6JHtlLmNvbXBvbmVudFN0YWNrfWA7XG4gICAgfVxuICAgIGNvbnN0IG5hbWVQcmVmaXggPSBlLm5hbWUgPT0gbnVsbCB8fCBlLm5hbWUgPT09ICcnID8gJycgOiBgJHtlLm5hbWV9OiBgO1xuICAgIGNvbnN0IGlzRnJvbUNvbnNvbGVFcnJvciA9IGUubmFtZSA9PT0gJ2NvbnNvbGUuZXJyb3InO1xuXG4gICAgaWYgKCFtZXNzYWdlLnN0YXJ0c1dpdGgobmFtZVByZWZpeCkpIHtcbiAgICAgIG1lc3NhZ2UgPSBuYW1lUHJlZml4ICsgbWVzc2FnZTtcbiAgICB9XG5cbiAgICAvLyBFcnJvcnMgY3JlYXRlZCBieSBgY29uc29sZS5lcnJvcmAgaGF2ZSBhbHJlYWR5IGJlZW4gcHJpbnRlZC5cbiAgICBpZiAoIWlzRnJvbUNvbnNvbGVFcnJvcikge1xuICAgICAgaWYgKGNvbnNvbGUuX2Vycm9yT3JpZ2luYWwpIHtcbiAgICAgICAgY29uc29sZS5fZXJyb3JPcmlnaW5hbChtZXNzYWdlKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IobWVzc2FnZSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgbWVzc2FnZSA9XG4gICAgICBlLmpzRW5naW5lID09IG51bGwgPyBtZXNzYWdlIDogYCR7bWVzc2FnZX0sIGpzIGVuZ2luZTogJHtlLmpzRW5naW5lfWA7XG4gICAgTmF0aXZlRXhjZXB0aW9uc01hbmFnZXIucmVwb3J0RXhjZXB0aW9uKHtcbiAgICAgIG1lc3NhZ2UsXG4gICAgICBvcmlnaW5hbE1lc3NhZ2U6IG1lc3NhZ2UgPT09IG9yaWdpbmFsTWVzc2FnZSA/IG51bGwgOiBvcmlnaW5hbE1lc3NhZ2UsXG4gICAgICBuYW1lOiBlLm5hbWUgPT0gbnVsbCB8fCBlLm5hbWUgPT09ICcnID8gbnVsbCA6IGUubmFtZSxcbiAgICAgIGNvbXBvbmVudFN0YWNrOlxuICAgICAgICB0eXBlb2YgZS5jb21wb25lbnRTdGFjayA9PT0gJ3N0cmluZycgPyBlLmNvbXBvbmVudFN0YWNrIDogbnVsbCxcbiAgICAgIHN0YWNrLFxuICAgICAgaWQ6IGN1cnJlbnRFeGNlcHRpb25JRCxcbiAgICAgIGlzRmF0YWwsXG4gICAgICBleHRyYURhdGE6IHtcbiAgICAgICAganNFbmdpbmU6IGUuanNFbmdpbmUsXG4gICAgICAgIHJhd1N0YWNrOiBlLnN0YWNrLFxuICAgICAgICBmcmFtZXNQb3BwZWQ6IGUuZnJhbWVzVG9Qb3AsXG4gICAgICB9LFxuICAgIH0pO1xuICAgIGlmIChfX0RFVl9fKSB7XG4gICAgICBpZiAoZS5wcmV2ZW50U3ltYm9saWNhdGlvbiA9PT0gdHJ1ZSkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBjb25zdCBzeW1ib2xpY2F0ZVN0YWNrVHJhY2UgPSByZXF1aXJlKCcuL0RldnRvb2xzL3N5bWJvbGljYXRlU3RhY2tUcmFjZScpO1xuICAgICAgc3ltYm9saWNhdGVTdGFja1RyYWNlKHN0YWNrKVxuICAgICAgICAudGhlbihwcmV0dHlTdGFjayA9PiB7XG4gICAgICAgICAgaWYgKHByZXR0eVN0YWNrKSB7XG4gICAgICAgICAgICBjb25zdCBzdGFja1dpdGhvdXRDb2xsYXBzZWRGcmFtZXMgPSBwcmV0dHlTdGFjay5maWx0ZXIoXG4gICAgICAgICAgICAgIGZyYW1lID0+ICFmcmFtZS5jb2xsYXBzZSxcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgICBOYXRpdmVFeGNlcHRpb25zTWFuYWdlci51cGRhdGVFeGNlcHRpb25NZXNzYWdlKFxuICAgICAgICAgICAgICBtZXNzYWdlLFxuICAgICAgICAgICAgICBzdGFja1dpdGhvdXRDb2xsYXBzZWRGcmFtZXMsXG4gICAgICAgICAgICAgIGN1cnJlbnRFeGNlcHRpb25JRCxcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignVGhlIHN0YWNrIGlzIG51bGwnKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pXG4gICAgICAgIC5jYXRjaChlcnJvciA9PiB7XG4gICAgICAgICAgY29uc29sZS5sb2coJ1VuYWJsZSB0byBzeW1ib2xpY2F0ZSBzdGFjayB0cmFjZTogJyArIGVycm9yLm1lc3NhZ2UpO1xuICAgICAgICB9KTtcbiAgICB9XG4gIH1cbn1cblxuZGVjbGFyZSB2YXIgY29uc29sZTogdHlwZW9mIGNvbnNvbGUgJiB7XG4gIF9lcnJvck9yaWdpbmFsOiB0eXBlb2YgY29uc29sZS5lcnJvcixcbiAgcmVwb3J0RXJyb3JzQXNFeGNlcHRpb25zOiBib29sZWFuLFxufTtcblxuLyoqXG4gKiBMb2dzIGV4Y2VwdGlvbnMgdG8gdGhlIChuYXRpdmUpIGNvbnNvbGUgYW5kIGRpc3BsYXlzIHRoZW1cbiAqL1xuZnVuY3Rpb24gaGFuZGxlRXhjZXB0aW9uKGU6IG1peGVkLCBpc0ZhdGFsOiBib29sZWFuKSB7XG4gIGxldCBlcnJvcjogRXJyb3I7XG4gIGlmIChlIGluc3RhbmNlb2YgRXJyb3IpIHtcbiAgICBlcnJvciA9IGU7XG4gIH0gZWxzZSB7XG4gICAgLy8gV29ya2Fyb3VuZCBmb3IgcmVwb3J0aW5nIGVycm9ycyBjYXVzZWQgYnkgYHRocm93ICdzb21lIHN0cmluZydgXG4gICAgLy8gVW5mb3J0dW5hdGVseSB0aGVyZSBpcyBubyB3YXkgdG8gZmlndXJlIG91dCB0aGUgc3RhY2t0cmFjZSBpbiB0aGlzXG4gICAgLy8gY2FzZSwgc28gaWYgeW91IGVuZGVkIHVwIGhlcmUgdHJ5aW5nIHRvIHRyYWNlIGFuIGVycm9yLCBsb29rIGZvclxuICAgIC8vIGB0aHJvdyAnPGVycm9yIG1lc3NhZ2U+J2Agc29tZXdoZXJlIGluIHlvdXIgY29kZWJhc2UuXG4gICAgZXJyb3IgPSBuZXcgU3ludGhldGljRXJyb3IoZSk7XG4gIH1cbiAgcmVwb3J0RXhjZXB0aW9uKGVycm9yLCBpc0ZhdGFsKTtcbn1cblxuZnVuY3Rpb24gcmVhY3RDb25zb2xlRXJyb3JIYW5kbGVyKCkge1xuICBpZiAoIWNvbnNvbGUucmVwb3J0RXJyb3JzQXNFeGNlcHRpb25zKSB7XG4gICAgY29uc29sZS5fZXJyb3JPcmlnaW5hbC5hcHBseShjb25zb2xlLCBhcmd1bWVudHMpO1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGlmIChhcmd1bWVudHNbMF0gJiYgYXJndW1lbnRzWzBdLnN0YWNrKSB7XG4gICAgLy8gcmVwb3J0RXhjZXB0aW9uIHdpbGwgY29uc29sZS5lcnJvciB0aGlzIHdpdGggaGlnaCBlbm91Z2ggZmlkZWxpdHkuXG4gICAgcmVwb3J0RXhjZXB0aW9uKGFyZ3VtZW50c1swXSwgLyogaXNGYXRhbCAqLyBmYWxzZSk7XG4gIH0gZWxzZSB7XG4gICAgY29uc29sZS5fZXJyb3JPcmlnaW5hbC5hcHBseShjb25zb2xlLCBhcmd1bWVudHMpO1xuICAgIGNvbnN0IHN0cmluZ2lmeVNhZmUgPSByZXF1aXJlKCcuLi9VdGlsaXRpZXMvc3RyaW5naWZ5U2FmZScpO1xuICAgIGNvbnN0IHN0ciA9IEFycmF5LnByb3RvdHlwZS5tYXAuY2FsbChhcmd1bWVudHMsIHN0cmluZ2lmeVNhZmUpLmpvaW4oJywgJyk7XG4gICAgaWYgKHN0ci5zbGljZSgwLCAxMCkgPT09ICdcIldhcm5pbmc6ICcpIHtcbiAgICAgIC8vIFJlYWN0IHdhcm5pbmdzIHVzZSBjb25zb2xlLmVycm9yIHNvIHRoYXQgYSBzdGFjayB0cmFjZSBpcyBzaG93biwgYnV0XG4gICAgICAvLyB3ZSBkb24ndCAoY3VycmVudGx5KSB3YW50IHRoZXNlIHRvIHNob3cgYSByZWRib3hcbiAgICAgIC8vIChOb3RlOiBMb2dpYyBkdXBsaWNhdGVkIGluIHBvbHlmaWxscy9jb25zb2xlLmpzLilcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgY29uc3QgZXJyb3I6IEV4dGVuZGVkRXJyb3IgPSBuZXcgU3ludGhldGljRXJyb3Ioc3RyKTtcbiAgICBlcnJvci5uYW1lID0gJ2NvbnNvbGUuZXJyb3InO1xuICAgIGVycm9yLmZyYW1lc1RvUG9wID0gKGVycm9yLmZyYW1lc1RvUG9wIHx8IDApICsgMTtcbiAgICByZXBvcnRFeGNlcHRpb24oZXJyb3IsIC8qIGlzRmF0YWwgKi8gZmFsc2UpO1xuICB9XG59XG5cbi8qKlxuICogU2hvd3MgYSByZWRib3ggd2l0aCBzdGFja3RyYWNlIGZvciBhbGwgY29uc29sZS5lcnJvciBtZXNzYWdlcy4gIERpc2FibGUgYnlcbiAqIHNldHRpbmcgYGNvbnNvbGUucmVwb3J0RXJyb3JzQXNFeGNlcHRpb25zID0gZmFsc2U7YCBpbiB5b3VyIGFwcC5cbiAqL1xuZnVuY3Rpb24gaW5zdGFsbENvbnNvbGVFcnJvclJlcG9ydGVyKCkge1xuICAvLyBFbmFibGUgcmVwb3J0RXJyb3JzQXNFeGNlcHRpb25zXG4gIGlmIChjb25zb2xlLl9lcnJvck9yaWdpbmFsKSB7XG4gICAgcmV0dXJuOyAvLyBhbHJlYWR5IGluc3RhbGxlZFxuICB9XG4gIC8vIEZsb3cgZG9lc24ndCBsaWtlIGl0IHdoZW4geW91IHNldCBhcmJpdHJhcnkgdmFsdWVzIG9uIGEgZ2xvYmFsIG9iamVjdFxuICBjb25zb2xlLl9lcnJvck9yaWdpbmFsID0gY29uc29sZS5lcnJvci5iaW5kKGNvbnNvbGUpO1xuICBjb25zb2xlLmVycm9yID0gcmVhY3RDb25zb2xlRXJyb3JIYW5kbGVyO1xuICBpZiAoY29uc29sZS5yZXBvcnRFcnJvcnNBc0V4Y2VwdGlvbnMgPT09IHVuZGVmaW5lZCkge1xuICAgIC8vIEluZGl2aWR1YWwgYXBwcyBjYW4gZGlzYWJsZSB0aGlzXG4gICAgLy8gRmxvdyBkb2Vzbid0IGxpa2UgaXQgd2hlbiB5b3Ugc2V0IGFyYml0cmFyeSB2YWx1ZXMgb24gYSBnbG9iYWwgb2JqZWN0XG4gICAgY29uc29sZS5yZXBvcnRFcnJvcnNBc0V4Y2VwdGlvbnMgPSB0cnVlO1xuICB9XG59XG5cbm1vZHVsZS5leHBvcnRzID0ge2hhbmRsZUV4Y2VwdGlvbiwgaW5zdGFsbENvbnNvbGVFcnJvclJlcG9ydGVyLCBTeW50aGV0aWNFcnJvcn07XG4iXX0=