aeb077b6f3031c40737a3175d588d56b
var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = void 0;

var _typeof2 = _interopRequireDefault(require("@babel/runtime/helpers/typeof"));

var _extends2 = _interopRequireDefault(require("@babel/runtime/helpers/extends"));

var _regenerator = _interopRequireDefault(require("@babel/runtime/regenerator"));

var _slicedToArray2 = _interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));

var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));

var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));

var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));

var _possibleConstructorReturn2 = _interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));

var _getPrototypeOf2 = _interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));

var _inherits2 = _interopRequireDefault(require("@babel/runtime/helpers/inherits"));

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _react = _interopRequireDefault(require("react"));

var _propTypes = _interopRequireDefault(require("prop-types"));

var _reactNative = require("react-native");

var _reactNativeIphoneXHelper = require("react-native-iphone-x-helper");

function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }

function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(source, true).forEach(function (key) { (0, _defineProperty2["default"])(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(source).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }

var _KAM_DEFAULT_TAB_BAR_HEIGHT = (0, _reactNativeIphoneXHelper.isIphoneX)() ? 83 : 49;

var _KAM_KEYBOARD_OPENING_TIME = 250;
var _KAM_EXTRA_HEIGHT = 75;
var supportedKeyboardEvents = ['keyboardWillShow', 'keyboardDidShow', 'keyboardWillHide', 'keyboardDidHide', 'keyboardWillChangeFrame', 'keyboardDidChangeFrame'];

var keyboardEventToCallbackName = function keyboardEventToCallbackName(eventName) {
  return 'on' + eventName[0].toUpperCase() + eventName.substring(1);
};

var keyboardEventPropTypes = supportedKeyboardEvents.reduce(function (acc, eventName) {
  return _objectSpread({}, acc, (0, _defineProperty2["default"])({}, keyboardEventToCallbackName(eventName), _propTypes["default"].func));
}, {});
var keyboardAwareHOCTypeEvents = supportedKeyboardEvents.reduce(function (acc, eventName) {
  return _objectSpread({}, acc, (0, _defineProperty2["default"])({}, keyboardEventToCallbackName(eventName), Function));
}, {});

function getDisplayName(WrappedComponent) {
  return WrappedComponent && (WrappedComponent.displayName || WrappedComponent.name) || 'Component';
}

var ScrollIntoViewDefaultOptions = {
  enableOnAndroid: false,
  contentContainerStyle: undefined,
  enableAutomaticScroll: true,
  extraHeight: _KAM_EXTRA_HEIGHT,
  extraScrollHeight: 0,
  enableResetScrollToCoords: true,
  keyboardOpeningTime: _KAM_KEYBOARD_OPENING_TIME,
  viewIsInsideTabBar: false,
  refPropName: 'ref',
  extractNativeRef: function extractNativeRef(ref) {
    if (ref.getNode) {
      return ref.getNode();
    } else {
      return ref;
    }
  }
};

function KeyboardAwareHOC(ScrollableComponent) {
  var _class, _temp;

  var userOptions = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};

  var hocOptions = _objectSpread({}, ScrollIntoViewDefaultOptions, {}, userOptions);

  return _temp = _class = function (_React$Component) {
    (0, _inherits2["default"])(_class, _React$Component);

    function _class(props) {
      var _this;

      (0, _classCallCheck2["default"])(this, _class);
      _this = (0, _possibleConstructorReturn2["default"])(this, (0, _getPrototypeOf2["default"])(_class).call(this, props));
      _this._rnkasv_keyboardView = void 0;
      _this.keyboardWillShowEvent = void 0;
      _this.keyboardWillHideEvent = void 0;
      _this.position = void 0;
      _this.defaultResetScrollToCoords = void 0;
      _this.mountedComponent = void 0;
      _this.handleOnScroll = void 0;
      _this.state = void 0;

      _this.getScrollResponder = function () {
        return _this._rnkasv_keyboardView && _this._rnkasv_keyboardView.getScrollResponder && _this._rnkasv_keyboardView.getScrollResponder();
      };

      _this.scrollToPosition = function (x, y) {
        var animated = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : true;

        var responder = _this.getScrollResponder();

        responder && responder.scrollResponderScrollTo({
          x: x,
          y: y,
          animated: animated
        });
      };

      _this.scrollToEnd = function () {
        var animated = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : true;

        var responder = _this.getScrollResponder();

        responder && responder.scrollResponderScrollToEnd({
          animated: animated
        });
      };

      _this.scrollForExtraHeightOnAndroid = function (extraHeight) {
        _this.scrollToPosition(0, _this.position.y + extraHeight, true);
      };

      _this.scrollToFocusedInput = function (reactNode, extraHeight, keyboardOpeningTime) {
        if (extraHeight === undefined) {
          extraHeight = _this.props.extraHeight || 0;
        }

        if (keyboardOpeningTime === undefined) {
          keyboardOpeningTime = _this.props.keyboardOpeningTime || 0;
        }

        setTimeout(function () {
          if (!_this.mountedComponent) {
            return;
          }

          var responder = _this.getScrollResponder();

          responder && responder.scrollResponderScrollNativeHandleToKeyboard(reactNode, extraHeight, true);
        }, keyboardOpeningTime);
      };

      _this.scrollIntoView = function () {
        var _ref = (0, _asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee(element) {
          var options,
              _ref2,
              _ref3,
              parentLayout,
              childLayout,
              getScrollPosition,
              _getScrollPosition,
              x,
              y,
              animated,
              _args = arguments;

          return _regenerator["default"].wrap(function _callee$(_context) {
            while (1) {
              switch (_context.prev = _context.next) {
                case 0:
                  options = _args.length > 1 && _args[1] !== undefined ? _args[1] : {};

                  if (!(!_this._rnkasv_keyboardView || !element)) {
                    _context.next = 3;
                    break;
                  }

                  return _context.abrupt("return");

                case 3:
                  _context.next = 5;
                  return Promise.all([_this._measureElement(_this._rnkasv_keyboardView), _this._measureElement(element)]);

                case 5:
                  _ref2 = _context.sent;
                  _ref3 = (0, _slicedToArray2["default"])(_ref2, 2);
                  parentLayout = _ref3[0];
                  childLayout = _ref3[1];
                  getScrollPosition = options.getScrollPosition || _this._defaultGetScrollPosition;
                  _getScrollPosition = getScrollPosition(parentLayout, childLayout, _this.position), x = _getScrollPosition.x, y = _getScrollPosition.y, animated = _getScrollPosition.animated;

                  _this.scrollToPosition(x, y, animated);

                case 12:
                case "end":
                  return _context.stop();
              }
            }
          }, _callee);
        }));

        return function (_x) {
          return _ref.apply(this, arguments);
        };
      }();

      _this._defaultGetScrollPosition = function (parentLayout, childLayout, contentOffset) {
        return {
          x: 0,
          y: Math.max(0, childLayout.y - parentLayout.y + contentOffset.y),
          animated: true
        };
      };

      _this._measureElement = function (element) {
        var node = (0, _reactNative.findNodeHandle)(element);
        return new Promise(function (resolve) {
          _reactNative.UIManager.measureInWindow(node, function (x, y, width, height) {
            resolve({
              x: x,
              y: y,
              width: width,
              height: height
            });
          });
        });
      };

      _this._updateKeyboardSpace = function (frames) {
        if (_this.props.enableAutomaticScroll) {
          var keyboardSpace = frames.endCoordinates.height + _this.props.extraScrollHeight;

          if (_this.props.viewIsInsideTabBar) {
            keyboardSpace -= _KAM_DEFAULT_TAB_BAR_HEIGHT;
          }

          _this.setState({
            keyboardSpace: keyboardSpace
          });

          var currentlyFocusedField = _reactNative.TextInput.State.currentlyFocusedField();

          var responder = _this.getScrollResponder();

          if (!currentlyFocusedField || !responder) {
            return;
          }

          _reactNative.UIManager.viewIsDescendantOf(currentlyFocusedField, responder.getInnerViewNode(), function (isAncestor) {
            if (isAncestor) {
              _reactNative.UIManager.measureInWindow(currentlyFocusedField, function (x, y, width, height) {
                var textInputBottomPosition = y + height;
                var keyboardPosition = frames.endCoordinates.screenY;
                var totalExtraHeight = _this.props.extraScrollHeight + _this.props.extraHeight;

                if (_reactNative.Platform.OS === 'ios') {
                  if (textInputBottomPosition > keyboardPosition - totalExtraHeight) {
                    _this._scrollToFocusedInputWithNodeHandle(currentlyFocusedField);
                  }
                } else {
                  if (textInputBottomPosition > keyboardPosition) {
                    keyboardSpace = keyboardSpace - (textInputBottomPosition - keyboardPosition);

                    _this.setState({
                      keyboardSpace: keyboardSpace
                    });

                    _this.scrollForExtraHeightOnAndroid(totalExtraHeight);
                  } else if (textInputBottomPosition > keyboardPosition - totalExtraHeight) {
                    _this.scrollForExtraHeightOnAndroid(totalExtraHeight - (keyboardPosition - textInputBottomPosition));
                  }
                }
              });
            }
          });
        }

        if (!_this.props.resetScrollToCoords) {
          if (!_this.defaultResetScrollToCoords) {
            _this.defaultResetScrollToCoords = _this.position;
          }
        }
      };

      _this._resetKeyboardSpace = function () {
        var keyboardSpace = _this.props.viewIsInsideTabBar ? _KAM_DEFAULT_TAB_BAR_HEIGHT : 0;

        _this.setState({
          keyboardSpace: keyboardSpace
        });

        if (_this.props.enableResetScrollToCoords === false) {
          _this.defaultResetScrollToCoords = null;
          return;
        } else if (_this.props.resetScrollToCoords) {
          _this.scrollToPosition(_this.props.resetScrollToCoords.x, _this.props.resetScrollToCoords.y, true);
        } else {
          if (_this.defaultResetScrollToCoords) {
            _this.scrollToPosition(_this.defaultResetScrollToCoords.x, _this.defaultResetScrollToCoords.y, true);

            _this.defaultResetScrollToCoords = null;
          } else {
            _this.scrollToPosition(0, 0, true);
          }
        }
      };

      _this._scrollToFocusedInputWithNodeHandle = function (nodeID, extraHeight, keyboardOpeningTime) {
        if (extraHeight === undefined) {
          extraHeight = _this.props.extraHeight;
        }

        var reactNode = (0, _reactNative.findNodeHandle)(nodeID);

        _this.scrollToFocusedInput(reactNode, extraHeight + _this.props.extraScrollHeight, keyboardOpeningTime !== undefined ? keyboardOpeningTime : _this.props.keyboardOpeningTime || 0);
      };

      _this._handleOnScroll = function (e) {
        _this.position = e.nativeEvent.contentOffset;
      };

      _this._handleRef = function (ref) {
        _this._rnkasv_keyboardView = ref ? hocOptions.extractNativeRef(ref) : ref;

        if (_this.props.innerRef) {
          _this.props.innerRef(_this._rnkasv_keyboardView);
        }
      };

      _this.update = function () {
        var currentlyFocusedField = _reactNative.TextInput.State.currentlyFocusedField();

        var responder = _this.getScrollResponder();

        if (!currentlyFocusedField || !responder) {
          return;
        }

        _this._scrollToFocusedInputWithNodeHandle(currentlyFocusedField);
      };

      _this.keyboardWillShowEvent = undefined;
      _this.keyboardWillHideEvent = undefined;
      _this.callbacks = {};
      _this.position = {
        x: 0,
        y: 0
      };
      _this.defaultResetScrollToCoords = null;

      var _keyboardSpace = props.viewIsInsideTabBar ? _KAM_DEFAULT_TAB_BAR_HEIGHT : 0;

      _this.state = {
        keyboardSpace: _keyboardSpace
      };
      return _this;
    }

    (0, _createClass2["default"])(_class, [{
      key: "componentDidMount",
      value: function componentDidMount() {
        var _this2 = this;

        this.mountedComponent = true;

        if (_reactNative.Platform.OS === 'ios') {
          this.keyboardWillShowEvent = _reactNative.Keyboard.addListener('keyboardWillShow', this._updateKeyboardSpace);
          this.keyboardWillHideEvent = _reactNative.Keyboard.addListener('keyboardWillHide', this._resetKeyboardSpace);
        } else if (_reactNative.Platform.OS === 'android' && this.props.enableOnAndroid) {
          this.keyboardWillShowEvent = _reactNative.Keyboard.addListener('keyboardDidShow', this._updateKeyboardSpace);
          this.keyboardWillHideEvent = _reactNative.Keyboard.addListener('keyboardDidHide', this._resetKeyboardSpace);
        }

        supportedKeyboardEvents.forEach(function (eventName) {
          var callbackName = keyboardEventToCallbackName(eventName);

          if (_this2.props[callbackName]) {
            _this2.callbacks[eventName] = _reactNative.Keyboard.addListener(eventName, _this2.props[callbackName]);
          }
        });
      }
    }, {
      key: "componentDidUpdate",
      value: function componentDidUpdate(prevProps) {
        if (this.props.viewIsInsideTabBar !== prevProps.viewIsInsideTabBar) {
          var keyboardSpace = this.props.viewIsInsideTabBar ? _KAM_DEFAULT_TAB_BAR_HEIGHT : 0;

          if (this.state.keyboardSpace !== keyboardSpace) {
            this.setState({
              keyboardSpace: keyboardSpace
            });
          }
        }
      }
    }, {
      key: "componentWillUnmount",
      value: function componentWillUnmount() {
        this.mountedComponent = false;
        this.keyboardWillShowEvent && this.keyboardWillShowEvent.remove();
        this.keyboardWillHideEvent && this.keyboardWillHideEvent.remove();
        Object.values(this.callbacks).forEach(function (callback) {
          return callback.remove();
        });
      }
    }, {
      key: "render",
      value: function render() {
        var _this$props = this.props,
            enableOnAndroid = _this$props.enableOnAndroid,
            contentContainerStyle = _this$props.contentContainerStyle,
            onScroll = _this$props.onScroll;
        var newContentContainerStyle;

        if (_reactNative.Platform.OS === 'android' && enableOnAndroid) {
          newContentContainerStyle = [].concat(contentContainerStyle).concat({
            paddingBottom: ((contentContainerStyle || {}).paddingBottom || 0) + this.state.keyboardSpace
          });
        }

        var refProps = (0, _defineProperty2["default"])({}, hocOptions.refPropName, this._handleRef);
        return _react["default"].createElement(ScrollableComponent, (0, _extends2["default"])({}, refProps, {
          keyboardDismissMode: "interactive",
          contentInset: {
            bottom: this.state.keyboardSpace
          },
          automaticallyAdjustContentInsets: false,
          showsVerticalScrollIndicator: true,
          scrollEventThrottle: 1
        }, this.props, {
          contentContainerStyle: newContentContainerStyle || contentContainerStyle,
          keyboardSpace: this.state.keyboardSpace,
          getScrollResponder: this.getScrollResponder,
          scrollToPosition: this.scrollToPosition,
          scrollToEnd: this.scrollToEnd,
          scrollForExtraHeightOnAndroid: this.scrollForExtraHeightOnAndroid,
          scrollToFocusedInput: this.scrollToFocusedInput,
          scrollIntoView: this.scrollIntoView,
          resetKeyboardSpace: this._resetKeyboardSpace,
          handleOnScroll: this._handleOnScroll,
          update: this.update,
          onScroll: _reactNative.Animated.forkEvent(onScroll, this._handleOnScroll)
        }));
      }
    }]);
    return _class;
  }(_react["default"].Component), _class.displayName = "KeyboardAware" + getDisplayName(ScrollableComponent), _class.propTypes = _objectSpread({
    viewIsInsideTabBar: _propTypes["default"].bool,
    resetScrollToCoords: _propTypes["default"].shape({
      x: _propTypes["default"].number.isRequired,
      y: _propTypes["default"].number.isRequired
    }),
    enableResetScrollToCoords: _propTypes["default"].bool,
    enableAutomaticScroll: _propTypes["default"].bool,
    extraHeight: _propTypes["default"].number,
    extraScrollHeight: _propTypes["default"].number,
    keyboardOpeningTime: _propTypes["default"].number,
    onScroll: _propTypes["default"].oneOfType([_propTypes["default"].func, _propTypes["default"].object]),
    update: _propTypes["default"].func,
    contentContainerStyle: _propTypes["default"].any,
    enableOnAndroid: _propTypes["default"].bool,
    innerRef: _propTypes["default"].func
  }, keyboardEventPropTypes), _class.defaultProps = {
    enableAutomaticScroll: hocOptions.enableAutomaticScroll,
    extraHeight: hocOptions.extraHeight,
    extraScrollHeight: hocOptions.extraScrollHeight,
    enableResetScrollToCoords: hocOptions.enableResetScrollToCoords,
    keyboardOpeningTime: hocOptions.keyboardOpeningTime,
    viewIsInsideTabBar: hocOptions.viewIsInsideTabBar,
    enableOnAndroid: hocOptions.enableOnAndroid
  }, _temp;
}

var listenToKeyboardEvents = function listenToKeyboardEvents(configOrComp) {
  if ((0, _typeof2["default"])(configOrComp) === 'object') {
    return function (Comp) {
      return KeyboardAwareHOC(Comp, configOrComp);
    };
  } else {
    return KeyboardAwareHOC(configOrComp);
  }
};

var _default = listenToKeyboardEvents;
exports["default"] = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIktleWJvYXJkQXdhcmVIT0MuanMiXSwibmFtZXMiOlsiX0tBTV9ERUZBVUxUX1RBQl9CQVJfSEVJR0hUIiwiX0tBTV9LRVlCT0FSRF9PUEVOSU5HX1RJTUUiLCJfS0FNX0VYVFJBX0hFSUdIVCIsInN1cHBvcnRlZEtleWJvYXJkRXZlbnRzIiwia2V5Ym9hcmRFdmVudFRvQ2FsbGJhY2tOYW1lIiwiZXZlbnROYW1lIiwidG9VcHBlckNhc2UiLCJzdWJzdHJpbmciLCJrZXlib2FyZEV2ZW50UHJvcFR5cGVzIiwicmVkdWNlIiwiYWNjIiwiUHJvcFR5cGVzIiwiZnVuYyIsImtleWJvYXJkQXdhcmVIT0NUeXBlRXZlbnRzIiwiRnVuY3Rpb24iLCJnZXREaXNwbGF5TmFtZSIsIldyYXBwZWRDb21wb25lbnQiLCJkaXNwbGF5TmFtZSIsIm5hbWUiLCJTY3JvbGxJbnRvVmlld0RlZmF1bHRPcHRpb25zIiwiZW5hYmxlT25BbmRyb2lkIiwiY29udGVudENvbnRhaW5lclN0eWxlIiwidW5kZWZpbmVkIiwiZW5hYmxlQXV0b21hdGljU2Nyb2xsIiwiZXh0cmFIZWlnaHQiLCJleHRyYVNjcm9sbEhlaWdodCIsImVuYWJsZVJlc2V0U2Nyb2xsVG9Db29yZHMiLCJrZXlib2FyZE9wZW5pbmdUaW1lIiwidmlld0lzSW5zaWRlVGFiQmFyIiwicmVmUHJvcE5hbWUiLCJleHRyYWN0TmF0aXZlUmVmIiwicmVmIiwiZ2V0Tm9kZSIsIktleWJvYXJkQXdhcmVIT0MiLCJTY3JvbGxhYmxlQ29tcG9uZW50IiwidXNlck9wdGlvbnMiLCJob2NPcHRpb25zIiwicHJvcHMiLCJfcm5rYXN2X2tleWJvYXJkVmlldyIsImtleWJvYXJkV2lsbFNob3dFdmVudCIsImtleWJvYXJkV2lsbEhpZGVFdmVudCIsInBvc2l0aW9uIiwiZGVmYXVsdFJlc2V0U2Nyb2xsVG9Db29yZHMiLCJtb3VudGVkQ29tcG9uZW50IiwiaGFuZGxlT25TY3JvbGwiLCJzdGF0ZSIsImdldFNjcm9sbFJlc3BvbmRlciIsInNjcm9sbFRvUG9zaXRpb24iLCJ4IiwieSIsImFuaW1hdGVkIiwicmVzcG9uZGVyIiwic2Nyb2xsUmVzcG9uZGVyU2Nyb2xsVG8iLCJzY3JvbGxUb0VuZCIsInNjcm9sbFJlc3BvbmRlclNjcm9sbFRvRW5kIiwic2Nyb2xsRm9yRXh0cmFIZWlnaHRPbkFuZHJvaWQiLCJzY3JvbGxUb0ZvY3VzZWRJbnB1dCIsInJlYWN0Tm9kZSIsInNldFRpbWVvdXQiLCJzY3JvbGxSZXNwb25kZXJTY3JvbGxOYXRpdmVIYW5kbGVUb0tleWJvYXJkIiwic2Nyb2xsSW50b1ZpZXciLCJlbGVtZW50Iiwib3B0aW9ucyIsIlByb21pc2UiLCJhbGwiLCJfbWVhc3VyZUVsZW1lbnQiLCJwYXJlbnRMYXlvdXQiLCJjaGlsZExheW91dCIsImdldFNjcm9sbFBvc2l0aW9uIiwiX2RlZmF1bHRHZXRTY3JvbGxQb3NpdGlvbiIsImNvbnRlbnRPZmZzZXQiLCJNYXRoIiwibWF4Iiwibm9kZSIsInJlc29sdmUiLCJVSU1hbmFnZXIiLCJtZWFzdXJlSW5XaW5kb3ciLCJ3aWR0aCIsImhlaWdodCIsIl91cGRhdGVLZXlib2FyZFNwYWNlIiwiZnJhbWVzIiwia2V5Ym9hcmRTcGFjZSIsImVuZENvb3JkaW5hdGVzIiwic2V0U3RhdGUiLCJjdXJyZW50bHlGb2N1c2VkRmllbGQiLCJUZXh0SW5wdXQiLCJTdGF0ZSIsInZpZXdJc0Rlc2NlbmRhbnRPZiIsImdldElubmVyVmlld05vZGUiLCJpc0FuY2VzdG9yIiwidGV4dElucHV0Qm90dG9tUG9zaXRpb24iLCJrZXlib2FyZFBvc2l0aW9uIiwic2NyZWVuWSIsInRvdGFsRXh0cmFIZWlnaHQiLCJQbGF0Zm9ybSIsIk9TIiwiX3Njcm9sbFRvRm9jdXNlZElucHV0V2l0aE5vZGVIYW5kbGUiLCJyZXNldFNjcm9sbFRvQ29vcmRzIiwiX3Jlc2V0S2V5Ym9hcmRTcGFjZSIsIm5vZGVJRCIsIl9oYW5kbGVPblNjcm9sbCIsImUiLCJuYXRpdmVFdmVudCIsIl9oYW5kbGVSZWYiLCJpbm5lclJlZiIsInVwZGF0ZSIsImNhbGxiYWNrcyIsIktleWJvYXJkIiwiYWRkTGlzdGVuZXIiLCJmb3JFYWNoIiwiY2FsbGJhY2tOYW1lIiwicHJldlByb3BzIiwicmVtb3ZlIiwiT2JqZWN0IiwidmFsdWVzIiwiY2FsbGJhY2siLCJvblNjcm9sbCIsIm5ld0NvbnRlbnRDb250YWluZXJTdHlsZSIsImNvbmNhdCIsInBhZGRpbmdCb3R0b20iLCJyZWZQcm9wcyIsImJvdHRvbSIsIkFuaW1hdGVkIiwiZm9ya0V2ZW50IiwiUmVhY3QiLCJDb21wb25lbnQiLCJwcm9wVHlwZXMiLCJib29sIiwic2hhcGUiLCJudW1iZXIiLCJpc1JlcXVpcmVkIiwib25lT2ZUeXBlIiwib2JqZWN0IiwiYW55IiwiZGVmYXVsdFByb3BzIiwibGlzdGVuVG9LZXlib2FyZEV2ZW50cyIsImNvbmZpZ09yQ29tcCIsIkNvbXAiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBRUE7O0FBQ0E7O0FBQ0E7O0FBUUE7Ozs7OztBQUdBLElBQU1BLDJCQUFtQyxHQUFHLDZDQUFjLEVBQWQsR0FBbUIsRUFBL0Q7O0FBQ0EsSUFBTUMsMEJBQWtDLEdBQUcsR0FBM0M7QUFDQSxJQUFNQyxpQkFBeUIsR0FBRyxFQUFsQztBQUVBLElBQU1DLHVCQUF1QixHQUFHLENBQzlCLGtCQUQ4QixFQUU5QixpQkFGOEIsRUFHOUIsa0JBSDhCLEVBSTlCLGlCQUo4QixFQUs5Qix5QkFMOEIsRUFNOUIsd0JBTjhCLENBQWhDOztBQVFBLElBQU1DLDJCQUEyQixHQUFHLFNBQTlCQSwyQkFBOEIsQ0FBQ0MsU0FBRDtBQUFBLFNBQ2xDLE9BQU9BLFNBQVMsQ0FBQyxDQUFELENBQVQsQ0FBYUMsV0FBYixFQUFQLEdBQW9DRCxTQUFTLENBQUNFLFNBQVYsQ0FBb0IsQ0FBcEIsQ0FERjtBQUFBLENBQXBDOztBQUVBLElBQU1DLHNCQUFzQixHQUFHTCx1QkFBdUIsQ0FBQ00sTUFBeEIsQ0FDN0IsVUFBQ0MsR0FBRCxFQUFjTCxTQUFkO0FBQUEsMkJB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QUFFcEJDLElBQUFBLFdBQVcsRUFBRVksVUFBVSxDQUFDWixXQUZKO0FBR3BCQyxJQUFBQSxpQkFBaUIsRUFBRVcsVUFBVSxDQUFDWCxpQkFIVjtBQUlwQkMsSUFBQUEseUJBQXlCLEVBQUVVLFVBQVUsQ0FBQ1YseUJBSmxCO0FBS3BCQyxJQUFBQSxtQkFBbUIsRUFBRVMsVUFBVSxDQUFDVCxtQkFMWjtBQU1wQkMsSUFBQUEsa0JBQWtCLEVBQUVRLFVBQVUsQ0FBQ1Isa0JBTlg7QUFPcEJSLElBQUFBLGVBQWUsRUFBRWdCLFVBQVUsQ0FBQ2hCO0FBUFIsR0FwQ3hCO0FBd1lEOztBQUtELElBQU1tSCxzQkFBc0IsR0FBRyxTQUF6QkEsc0JBQXlCLENBQUNDLFlBQUQsRUFBdUI7QUFDcEQsTUFBSSx5QkFBT0EsWUFBUCxNQUF3QixRQUE1QixFQUFzQztBQUNwQyxXQUFPLFVBQUNDLElBQUQ7QUFBQSxhQUFvQnhHLGdCQUFnQixDQUFDd0csSUFBRCxFQUFPRCxZQUFQLENBQXBDO0FBQUEsS0FBUDtBQUNELEdBRkQsTUFFTztBQUNMLFdBQU92RyxnQkFBZ0IsQ0FBQ3VHLFlBQUQsQ0FBdkI7QUFDRDtBQUNGLENBTkQ7O2VBUWVELHNCIiwic291cmNlc0NvbnRlbnQiOlsiLyogQGZsb3cgKi9cblxuaW1wb3J0IFJlYWN0IGZyb20gJ3JlYWN0J1xuaW1wb3J0IFByb3BUeXBlcyBmcm9tICdwcm9wLXR5cGVzJ1xuaW1wb3J0IHtcbiAgS2V5Ym9hcmQsXG4gIFBsYXRmb3JtLFxuICBVSU1hbmFnZXIsXG4gIFRleHRJbnB1dCxcbiAgZmluZE5vZGVIYW5kbGUsXG4gIEFuaW1hdGVkXG59IGZyb20gJ3JlYWN0LW5hdGl2ZSdcbmltcG9ydCB7IGlzSXBob25lWCB9IGZyb20gJ3JlYWN0LW5hdGl2ZS1pcGhvbmUteC1oZWxwZXInXG5pbXBvcnQgdHlwZSB7IEtleWJvYXJkQXdhcmVJbnRlcmZhY2UgfSBmcm9tICcuL0tleWJvYXJkQXdhcmVJbnRlcmZhY2UnXG5cbmNvbnN0IF9LQU1fREVGQVVMVF9UQUJfQkFSX0hFSUdIVDogbnVtYmVyID0gaXNJcGhvbmVYKCkgPyA4MyA6IDQ5XG5jb25zdCBfS0FNX0tFWUJPQVJEX09QRU5JTkdfVElNRTogbnVtYmVyID0gMjUwXG5jb25zdCBfS0FNX0VYVFJBX0hFSUdIVDogbnVtYmVyID0gNzVcblxuY29uc3Qgc3VwcG9ydGVkS2V5Ym9hcmRFdmVudHMgPSBbXG4gICdrZXlib2FyZFdpbGxTaG93JyxcbiAgJ2tleWJvYXJkRGlkU2hvdycsXG4gICdrZXlib2FyZFdpbGxIaWRlJyxcbiAgJ2tleWJvYXJkRGlkSGlkZScsXG4gICdrZXlib2FyZFdpbGxDaGFuZ2VGcmFtZScsXG4gICdrZXlib2FyZERpZENoYW5nZUZyYW1lJ1xuXVxuY29uc3Qga2V5Ym9hcmRFdmVudFRvQ2FsbGJhY2tOYW1lID0gKGV2ZW50TmFtZTogc3RyaW5nKSA9PlxuICAnb24nICsgZXZlbnROYW1lWzBdLnRvVXBwZXJDYXNlKCkgKyBldmVudE5hbWUuc3Vic3RyaW5nKDEpXG5jb25zdCBrZXlib2FyZEV2ZW50UHJvcFR5cGVzID0gc3VwcG9ydGVkS2V5Ym9hcmRFdmVudHMucmVkdWNlKFxuICAoYWNjOiBPYmplY3QsIGV2ZW50TmFtZTogc3RyaW5nKSA9PiAoe1xuICAgIC4uLmFjYyxcbiAgICBba2V5Ym9hcmRFdmVudFRvQ2FsbGJhY2tOYW1lKGV2ZW50TmFtZSldOiBQcm9wVHlwZXMuZnVuY1xuICB9KSxcbiAge31cbilcbmNvbnN0IGtleWJvYXJkQXdhcmVIT0NUeXBlRXZlbnRzID0gc3VwcG9ydGVkS2V5Ym9hcmRFdmVudHMucmVkdWNlKFxuICAoYWNjOiBPYmplY3QsIGV2ZW50TmFtZTogc3RyaW5nKSA9PiAoe1xuICAgIC4uLmFjYyxcbiAgICBba2V5Ym9hcmRFdmVudFRvQ2FsbGJhY2tOYW1lKGV2ZW50TmFtZSldOiBGdW5jdGlvblxuICB9KSxcbiAge31cbilcblxuZXhwb3J0IHR5cGUgS2V5Ym9hcmRBd2FyZUhPQ1Byb3BzID0ge1xuICB2aWV3SXNJbnNpZGVUYWJCYXI/OiBib29sZWFuLFxuICByZXNldFNjcm9sbFRvQ29vcmRzPzoge1xuICAgIHg6IG51bWJlcixcbiAgICB5OiBudW1iZXJcbiAgfSxcbiAgZW5hYmxlUmVzZXRTY3JvbGxUb0Nvb3Jkcz86IGJvb2xlYW4sXG4gIGVuYWJsZUF1dG9tYXRpY1Njcm9sbD86IGJvb2xlYW4sXG4gIGV4dHJhSGVpZ2h0PzogbnVtYmVyLFxuICBleHRyYVNjcm9sbEhlaWdodD86IG51bWJlcixcbiAga2V5Ym9hcmRPcGVuaW5nVGltZT86IG51bWJlcixcbiAgb25TY3JvbGw/OiBGdW5jdGlvbixcbiAgdXBkYXRlPzogRnVuY3Rpb24sXG4gIGNvbnRlbnRDb250YWluZXJTdHlsZT86IGFueSxcbiAgZW5hYmxlT25BbmRyb2lkPzogYm9vbGVhbixcbiAgaW5uZXJSZWY/OiBGdW5jdGlvbixcbiAgLi4ua2V5Ym9hcmRBd2FyZUhPQ1R5cGVFdmVudHNcbn1cbmV4cG9ydCB0eXBlIEtleWJvYXJkQXdhcmVIT0NTdGF0ZSA9IHtcbiAga2V5Ym9hcmRTcGFjZTogbnVtYmVyXG59XG5cbmV4cG9ydCB0eXBlIEVsZW1lbnRMYXlvdXQgPSB7XG4gIHg6IG51bWJlcixcbiAgeTogbnVtYmVyLFxuICB3aWR0aDogbnVtYmVyLFxuICBoZWlnaHQ6IG51bWJlclxufVxuXG5leHBvcnQgdHlwZSBDb250ZW50T2Zmc2V0ID0ge1xuICB4OiBudW1iZXIsXG4gIHk6IG51bWJlclxufVxuXG5leHBvcnQgdHlwZSBTY3JvbGxQb3NpdGlvbiA9IHtcbiAgeDogbnVtYmVyLFxuICB5OiBudW1iZXIsXG4gIGFuaW1hdGVkOiBib29sZWFuXG59XG5cbmV4cG9ydCB0eXBlIFNjcm9sbEludG9WaWV3T3B0aW9ucyA9ID97XG4gIGdldFNjcm9sbFBvc2l0aW9uPzogKFxuICAgIHBhcmVudExheW91dDogRWxlbWVudExheW91dCxcbiAgICBjaGlsZExheW91dDogRWxlbWVudExheW91dCxcbiAgICBjb250ZW50T2Zmc2V0OiBDb250ZW50T2Zmc2V0XG4gICkgPT4gU2Nyb2xsUG9zaXRpb25cbn1cblxuZXhwb3J0IHR5cGUgS2V5Ym9hcmRBd2FyZUhPQ09wdGlvbnMgPSA/e1xuICBlbmFibGVPbkFuZHJvaWQ6IGJvb2xlYW4sXG4gIGNvbnRlbnRDb250YWluZXJTdHlsZTogP09iamVjdCxcbiAgZW5hYmxlQXV0b21hdGljU2Nyb2xsOiBib29sZWFuLFxuICBleHRyYUhlaWdodDogbnVtYmVyLFxuICBleHRyYVNjcm9sbEhlaWdodDogbnVtYmVyLFxuICBlbmFibGVSZXNldFNjcm9sbFRvQ29vcmRzOiBib29sZWFuLFxuICBrZXlib2FyZE9wZW5pbmdUaW1lOiBudW1iZXIsXG4gIHZpZXdJc0luc2lkZVRhYkJhcjogYm9vbGVhbixcbiAgcmVmUHJvcE5hbWU6IHN0cmluZyxcbiAgZXh0cmFjdE5hdGl2ZVJlZjogRnVuY3Rpb25cbn1cblxuZnVuY3Rpb24gZ2V0RGlzcGxheU5hbWUoV3JhcHBlZENvbXBvbmVudDogUmVhY3QkQ29tcG9uZW50KSB7XG4gIHJldHVybiAoXG4gICAgKFdyYXBwZWRDb21wb25lbnQgJiZcbiAgICAgIChXcmFwcGVkQ29tcG9uZW50LmRpc3BsYXlOYW1lIHx8IFdyYXBwZWRDb21wb25lbnQubmFtZSkpIHx8XG4gICAgJ0NvbXBvbmVudCdcbiAgKVxufVxuXG5jb25zdCBTY3JvbGxJbnRvVmlld0RlZmF1bHRPcHRpb25zOiBLZXlib2FyZEF3YXJlSE9DT3B0aW9ucyA9IHtcbiAgZW5hYmxlT25BbmRyb2lkOiBmYWxzZSxcbiAgY29udGVudENvbnRhaW5lclN0eWxlOiB1bmRlZmluZWQsXG4gIGVuYWJsZUF1dG9tYXRpY1Njcm9sbDogdHJ1ZSxcbiAgZXh0cmFIZWlnaHQ6IF9LQU1fRVhUUkFfSEVJR0hULFxuICBleHRyYVNjcm9sbEhlaWdodDogMCxcbiAgZW5hYmxlUmVzZXRTY3JvbGxUb0Nvb3JkczogdHJ1ZSxcbiAga2V5Ym9hcmRPcGVuaW5nVGltZTogX0tBTV9LRVlCT0FSRF9PUEVOSU5HX1RJTUUsXG4gIHZpZXdJc0luc2lkZVRhYkJhcjogZmFsc2UsXG5cbiAgLy8gVGhlIHJlZiBwcm9wIG5hbWUgdGhhdCB3aWxsIGJlIHBhc3NlZCB0byB0aGUgd3JhcHBlZCBjb21wb25lbnQgdG8gb2J0YWluIGEgcmVmXG4gIC8vIElmIHlvdXIgU2Nyb2xsVmlldyBpcyBhbHJlYWR5IHdyYXBwZWQsIG1heWJlIHRoZSB3cmFwcGVyIHBlcm1pdCB0byBnZXQgYSByZWZcbiAgLy8gRm9yIGV4YW1wbGUsIHdpdGggZ2xhbW9yb3VzLW5hdGl2ZSBTY3JvbGxWaWV3LCB5b3Ugc2hvdWxkIHVzZSBcImlubmVyUmVmXCJcbiAgcmVmUHJvcE5hbWU6ICdyZWYnLFxuICAvLyBTb21ldGltZXMgdGhlIHJlZiB5b3UgZ2V0IGlzIGEgcmVmIHRvIGEgd3JhcHBlZCB2aWV3IChleDogQW5pbWF0ZWQuU2Nyb2xsVmlldylcbiAgLy8gV2UgbmVlZCBhY2Nlc3MgdG8gdGhlIGltcGVyYXRpdmUgQVBJIG9mIGEgcmVhbCBuYXRpdmUgU2Nyb2xsVmlldyBzbyB3ZSBuZWVkIGV4dHJhY3Rpb24gbG9naWNcbiAgZXh0cmFjdE5hdGl2ZVJlZjogKHJlZjogT2JqZWN0KSA9PiB7XG4gICAgLy8gZ2V0Tm9kZSgpIHBlcm1pdCB0byBzdXBwb3J0IEFuaW1hdGVkLlNjcm9sbFZpZXcgYXV0b21hdGljYWxseVxuICAgIC8vIHNlZSBodHRwczovL2dpdGh1Yi5jb20vZmFjZWJvb2svcmVhY3QtbmF0aXZlL2lzc3Vlcy8xOTY1MFxuICAgIC8vIHNlZSBodHRwczovL3N0YWNrb3ZlcmZsb3cuY29tL3F1ZXN0aW9ucy80MjA1MTM2OC9zY3JvbGx0by1pcy11bmRlZmluZWQtb24tYW5pbWF0ZWQtc2Nyb2xsdmlldy80ODc4NjM3NFxuICAgIGlmIChyZWYuZ2V0Tm9kZSkge1xuICAgICAgcmV0dXJuIHJlZi5nZXROb2RlKClcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIHJlZlxuICAgIH1cbiAgfVxufVxuXG5mdW5jdGlvbiBLZXlib2FyZEF3YXJlSE9DKFxuICBTY3JvbGxhYmxlQ29tcG9uZW50OiBSZWFjdCRDb21wb25lbnQsXG4gIHVzZXJPcHRpb25zOiBLZXlib2FyZEF3YXJlSE9DT3B0aW9ucyA9IHt9XG4pIHtcbiAgY29uc3QgaG9jT3B0aW9uczogS2V5Ym9hcmRBd2FyZUhPQ09wdGlvbnMgPSB7XG4gICAgLi4uU2Nyb2xsSW50b1ZpZXdEZWZhdWx0T3B0aW9ucyxcbiAgICAuLi51c2VyT3B0aW9uc1xuICB9XG5cbiAgcmV0dXJuIGNsYXNzXG4gICAgZXh0ZW5kcyBSZWFjdC5Db21wb25lbnQ8S2V5Ym9hcmRBd2FyZUhPQ1Byb3BzLCBLZXlib2FyZEF3YXJlSE9DU3RhdGU+XG4gICAgaW1wbGVtZW50cyBLZXlib2FyZEF3YXJlSW50ZXJmYWNlIHtcbiAgICBfcm5rYXN2X2tleWJvYXJkVmlldzogYW55XG4gICAga2V5Ym9hcmRXaWxsU2hvd0V2ZW50OiA/RnVuY3Rpb25cbiAgICBrZXlib2FyZFdpbGxIaWRlRXZlbnQ6ID9GdW5jdGlvblxuICAgIHBvc2l0aW9uOiBDb250ZW50T2Zmc2V0XG4gICAgZGVmYXVsdFJlc2V0U2Nyb2xsVG9Db29yZHM6ID97IHg6IG51bWJlciwgeTogbnVtYmVyIH1cbiAgICBtb3VudGVkQ29tcG9uZW50OiBib29sZWFuXG4gICAgaGFuZGxlT25TY3JvbGw6IEZ1bmN0aW9uXG4gICAgc3RhdGU6IEtleWJvYXJkQXdhcmVIT0NTdGF0ZVxuICAgIHN0YXRpYyBkaXNwbGF5TmFtZSA9IGBLZXlib2FyZEF3YXJlJHtnZXREaXNwbGF5TmFtZShTY3JvbGxhYmxlQ29tcG9uZW50KX1gXG5cbiAgICBzdGF0aWMgcHJvcFR5cGVzID0ge1xuICAgICAgdmlld0lzSW5zaWRlVGFiQmFyOiBQcm9wVHlwZXMuYm9vbCxcbiAgICAgIHJlc2V0U2Nyb2xsVG9Db29yZHM6IFByb3BUeXBlcy5zaGFwZSh7XG4gICAgICAgIHg6IFByb3BUeXBlcy5udW1iZXIuaXNSZXF1aXJlZCxcbiAgICAgICAgeTogUHJvcFR5cGVzLm51bWJlci5pc1JlcXVpcmVkXG4gICAgICB9KSxcbiAgICAgIGVuYWJsZVJlc2V0U2Nyb2xsVG9Db29yZHM6IFByb3BUeXBlcy5ib29sLFxuICAgICAgZW5hYmxlQXV0b21hdGljU2Nyb2xsOiBQcm9wVHlwZXMuYm9vbCxcbiAgICAgIGV4dHJhSGVpZ2h0OiBQcm9wVHlwZXMubnVtYmVyLFxuICAgICAgZXh0cmFTY3JvbGxIZWlnaHQ6IFByb3BUeXBlcy5udW1iZXIsXG4gICAgICBrZXlib2FyZE9wZW5pbmdUaW1lOiBQcm9wVHlwZXMubnVtYmVyLFxuICAgICAgb25TY3JvbGw6IFByb3BUeXBlcy5vbmVPZlR5cGUoW1xuICAgICAgICBQcm9wVHlwZXMuZnVuYywgLy8gTm9ybWFsIGxpc3RlbmVyXG4gICAgICAgIFByb3BUeXBlcy5vYmplY3QgLy8gQW5pbWF0ZWQuZXZlbnQgbGlzdGVuZXJcbiAgICAgIF0pLFxuICAgICAgdXBkYXRlOiBQcm9wVHlwZXMuZnVuYyxcbiAgICAgIGNvbnRlbnRDb250YWluZXJTdHlsZTogUHJvcFR5cGVzLmFueSxcbiAgICAgIGVuYWJsZU9uQW5kcm9pZDogUHJvcFR5cGVzLmJvb2wsXG4gICAgICBpbm5lclJlZjogUHJvcFR5cGVzLmZ1bmMsXG4gICAgICAuLi5rZXlib2FyZEV2ZW50UHJvcFR5cGVzXG4gICAgfVxuXG4gICAgLy8gSE9DIG9wdGlvbnMgYXJlIHVzZWQgdG8gaW5pdCBkZWZhdWx0IHByb3BzLCBzbyB0aGF0IHRoZXNlIG9wdGlvbnMgY2FuIGJlIG92ZXJyaWRlbiB3aXRoIGNvbXBvbmVudCBwcm9wc1xuICAgIHN0YXRpYyBkZWZhdWx0UHJvcHMgPSB7XG4gICAgICBlbmFibGVBdXRvbWF0aWNTY3JvbGw6IGhvY09wdGlvbnMuZW5hYmxlQXV0b21hdGljU2Nyb2xsLFxuICAgICAgZXh0cmFIZWlnaHQ6IGhvY09wdGlvbnMuZXh0cmFIZWlnaHQsXG4gICAgICBleHRyYVNjcm9sbEhlaWdodDogaG9jT3B0aW9ucy5leHRyYVNjcm9sbEhlaWdodCxcbiAgICAgIGVuYWJsZVJlc2V0U2Nyb2xsVG9Db29yZHM6IGhvY09wdGlvbnMuZW5hYmxlUmVzZXRTY3JvbGxUb0Nvb3JkcyxcbiAgICAgIGtleWJvYXJkT3BlbmluZ1RpbWU6IGhvY09wdGlvbnMua2V5Ym9hcmRPcGVuaW5nVGltZSxcbiAgICAgIHZpZXdJc0luc2lkZVRhYkJhcjogaG9jT3B0aW9ucy52aWV3SXNJbnNpZGVUYWJCYXIsXG4gICAgICBlbmFibGVPbkFuZHJvaWQ6IGhvY09wdGlvbnMuZW5hYmxlT25BbmRyb2lkXG4gICAgfVxuXG4gICAgY29uc3RydWN0b3IocHJvcHM6IEtleWJvYXJkQXdhcmVIT0NQcm9wcykge1xuICAgICAgc3VwZXIocHJvcHMpXG4gICAgICB0aGlzLmtleWJvYXJkV2lsbFNob3dFdmVudCA9IHVuZGVmaW5lZFxuICAgICAgdGhpcy5rZXlib2FyZFdpbGxIaWRlRXZlbnQgPSB1bmRlZmluZWRcbiAgICAgIHRoaXMuY2FsbGJhY2tzID0ge31cbiAgICAgIHRoaXMucG9zaXRpb24gPSB7IHg6IDAsIHk6IDAgfVxuICAgICAgdGhpcy5kZWZhdWx0UmVzZXRTY3JvbGxUb0Nvb3JkcyA9IG51bGxcbiAgICAgIGNvbnN0IGtleWJvYXJkU3BhY2U6IG51bWJlciA9IHByb3BzLnZpZXdJc0luc2lkZVRhYkJhclxuICAgICAgICA/IF9LQU1fREVGQVVMVF9UQUJfQkFSX0hFSUdIVFxuICAgICAgICA6IDBcbiAgICAgIHRoaXMuc3RhdGUgPSB7IGtleWJvYXJkU3BhY2UgfVxuICAgIH1cblxuICAgIGNvbXBvbmVudERpZE1vdW50KCkge1xuICAgICAgdGhpcy5tb3VudGVkQ29tcG9uZW50ID0gdHJ1ZVxuICAgICAgLy8gS2V5Ym9hcmQgZXZlbnRzXG4gICAgICBpZiAoUGxhdGZvcm0uT1MgPT09ICdpb3MnKSB7XG4gICAgICAgIHRoaXMua2V5Ym9hcmRXaWxsU2hvd0V2ZW50ID0gS2V5Ym9hcmQuYWRkTGlzdGVuZXIoXG4gICAgICAgICAgJ2tleWJvYXJkV2lsbFNob3cnLFxuICAgICAgICAgIHRoaXMuX3VwZGF0ZUtleWJvYXJkU3BhY2VcbiAgICAgICAgKVxuICAgICAgICB0aGlzLmtleWJvYXJkV2lsbEhpZGVFdmVudCA9IEtleWJvYXJkLmFkZExpc3RlbmVyKFxuICAgICAgICAgICdrZXlib2FyZFdpbGxIaWRlJyxcbiAgICAgICAgICB0aGlzLl9yZXNldEtleWJvYXJkU3BhY2VcbiAgICAgICAgKVxuICAgICAgfSBlbHNlIGlmIChQbGF0Zm9ybS5PUyA9PT0gJ2FuZHJvaWQnICYmIHRoaXMucHJvcHMuZW5hYmxlT25BbmRyb2lkKSB7XG4gICAgICAgIHRoaXMua2V5Ym9hcmRXaWxsU2hvd0V2ZW50ID0gS2V5Ym9hcmQuYWRkTGlzdGVuZXIoXG4gICAgICAgICAgJ2tleWJvYXJkRGlkU2hvdycsXG4gICAgICAgICAgdGhpcy5fdXBkYXRlS2V5Ym9hcmRTcGFjZVxuICAgICAgICApXG4gICAgICAgIHRoaXMua2V5Ym9hcmRXaWxsSGlkZUV2ZW50ID0gS2V5Ym9hcmQuYWRkTGlzdGVuZXIoXG4gICAgICAgICAgJ2tleWJvYXJkRGlkSGlkZScsXG4gICAgICAgICAgdGhpcy5fcmVzZXRLZXlib2FyZFNwYWNlXG4gICAgICAgIClcbiAgICAgIH1cblxuICAgICAgc3VwcG9ydGVkS2V5Ym9hcmRFdmVudHMuZm9yRWFjaCgoZXZlbnROYW1lOiBzdHJpbmcpID0+IHtcbiAgICAgICAgY29uc3QgY2FsbGJhY2tOYW1lID0ga2V5Ym9hcmRFdmVudFRvQ2FsbGJhY2tOYW1lKGV2ZW50TmFtZSlcbiAgICAgICAgaWYgKHRoaXMucHJvcHNbY2FsbGJhY2tOYW1lXSkge1xuICAgICAgICAgIHRoaXMuY2FsbGJhY2tzW2V2ZW50TmFtZV0gPSBLZXlib2FyZC5hZGRMaXN0ZW5lcihcbiAgICAgICAgICAgIGV2ZW50TmFtZSxcbiAgICAgICAgICAgIHRoaXMucHJvcHNbY2FsbGJhY2tOYW1lXVxuICAgICAgICAgIClcbiAgICAgICAgfVxuICAgICAgfSlcbiAgICB9XG5cbiAgICBjb21wb25lbnREaWRVcGRhdGUocHJldlByb3BzOiBLZXlib2FyZEF3YXJlSE9DUHJvcHMpIHtcbiAgICAgIGlmICh0aGlzLnByb3BzLnZpZXdJc0luc2lkZVRhYkJhciAhPT0gcHJldlByb3BzLnZpZXdJc0luc2lkZVRhYkJhcikge1xuICAgICAgICBjb25zdCBrZXlib2FyZFNwYWNlOiBudW1iZXIgPSB0aGlzLnByb3BzLnZpZXdJc0luc2lkZVRhYkJhclxuICAgICAgICAgID8gX0tBTV9ERUZBVUxUX1RBQl9CQVJfSEVJR0hUXG4gICAgICAgICAgOiAwXG4gICAgICAgIGlmICh0aGlzLnN0YXRlLmtleWJvYXJkU3BhY2UgIT09IGtleWJvYXJkU3BhY2UpIHtcbiAgICAgICAgICB0aGlzLnNldFN0YXRlKHsga2V5Ym9hcmRTcGFjZSB9KVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgY29tcG9uZW50V2lsbFVubW91bnQoKSB7XG4gICAgICB0aGlzLm1vdW50ZWRDb21wb25lbnQgPSBmYWxzZVxuICAgICAgdGhpcy5rZXlib2FyZFdpbGxTaG93RXZlbnQgJiYgdGhpcy5rZXlib2FyZFdpbGxTaG93RXZlbnQucmVtb3ZlKClcbiAgICAgIHRoaXMua2V5Ym9hcmRXaWxsSGlkZUV2ZW50ICYmIHRoaXMua2V5Ym9hcmRXaWxsSGlkZUV2ZW50LnJlbW92ZSgpXG4gICAgICBPYmplY3QudmFsdWVzKHRoaXMuY2FsbGJhY2tzKS5mb3JFYWNoKChjYWxsYmFjazogT2JqZWN0KSA9PlxuICAgICAgICBjYWxsYmFjay5yZW1vdmUoKVxuICAgICAgKVxuICAgIH1cblxuICAgIGdldFNjcm9sbFJlc3BvbmRlciA9ICgpID0+IHtcbiAgICAgIHJldHVybiAoXG4gICAgICAgIHRoaXMuX3Jua2Fzdl9rZXlib2FyZFZpZXcgJiZcbiAgICAgICAgdGhpcy5fcm5rYXN2X2tleWJvYXJkVmlldy5nZXRTY3JvbGxSZXNwb25kZXIgJiZcbiAgICAgICAgdGhpcy5fcm5rYXN2X2tleWJvYXJkVmlldy5nZXRTY3JvbGxSZXNwb25kZXIoKVxuICAgICAgKVxuICAgIH1cblxuICAgIHNjcm9sbFRvUG9zaXRpb24gPSAoeDogbnVtYmVyLCB5OiBudW1iZXIsIGFuaW1hdGVkOiBib29sZWFuID0gdHJ1ZSkgPT4ge1xuICAgICAgY29uc3QgcmVzcG9uZGVyID0gdGhpcy5nZXRTY3JvbGxSZXNwb25kZXIoKVxuICAgICAgcmVzcG9uZGVyICYmIHJlc3BvbmRlci5zY3JvbGxSZXNwb25kZXJTY3JvbGxUbyh7IHgsIHksIGFuaW1hdGVkIH0pXG4gICAgfVxuXG4gICAgc2Nyb2xsVG9FbmQgPSAoYW5pbWF0ZWQ/OiBib29sZWFuID0gdHJ1ZSkgPT4ge1xuICAgICAgY29uc3QgcmVzcG9uZGVyID0gdGhpcy5nZXRTY3JvbGxSZXNwb25kZXIoKVxuICAgICAgcmVzcG9uZGVyICYmIHJlc3BvbmRlci5zY3JvbGxSZXNwb25kZXJTY3JvbGxUb0VuZCh7IGFuaW1hdGVkIH0pXG4gICAgfVxuXG4gICAgc2Nyb2xsRm9yRXh0cmFIZWlnaHRPbkFuZHJvaWQgPSAoZXh0cmFIZWlnaHQ6IG51bWJlcikgPT4ge1xuICAgICAgdGhpcy5zY3JvbGxUb1Bvc2l0aW9uKDAsIHRoaXMucG9zaXRpb24ueSArIGV4dHJhSGVpZ2h0LCB0cnVlKVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBwYXJhbSBrZXlib2FyZE9wZW5pbmdUaW1lOiB0YWtlcyBhIGRpZmZlcmVudCBrZXlib2FyZE9wZW5pbmdUaW1lIGluIGNvbnNpZGVyYXRpb24uXG4gICAgICogQHBhcmFtIGV4dHJhSGVpZ2h0OiB0YWtlcyBhbiBleHRyYSBoZWlnaHQgaW4gY29uc2lkZXJhdGlvbi5cbiAgICAgKi9cbiAgICBzY3JvbGxUb0ZvY3VzZWRJbnB1dCA9IChcbiAgICAgIHJlYWN0Tm9kZTogYW55LFxuICAgICAgZXh0cmFIZWlnaHQ/OiBudW1iZXIsXG4gICAgICBrZXlib2FyZE9wZW5pbmdUaW1lPzogbnVtYmVyXG4gICAgKSA9PiB7XG4gICAgICBpZiAoZXh0cmFIZWlnaHQgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICBleHRyYUhlaWdodCA9IHRoaXMucHJvcHMuZXh0cmFIZWlnaHQgfHwgMFxuICAgICAgfVxuICAgICAgaWYgKGtleWJvYXJkT3BlbmluZ1RpbWUgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICBrZXlib2FyZE9wZW5pbmdUaW1lID0gdGhpcy5wcm9wcy5rZXlib2FyZE9wZW5pbmdUaW1lIHx8IDBcbiAgICAgIH1cbiAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICBpZiAoIXRoaXMubW91bnRlZENvbXBvbmVudCkge1xuICAgICAgICAgIHJldHVyblxuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHJlc3BvbmRlciA9IHRoaXMuZ2V0U2Nyb2xsUmVzcG9uZGVyKClcbiAgICAgICAgcmVzcG9uZGVyICYmXG4gICAgICAgICAgcmVzcG9uZGVyLnNjcm9sbFJlc3BvbmRlclNjcm9sbE5hdGl2ZUhhbmRsZVRvS2V5Ym9hcmQoXG4gICAgICAgICAgICByZWFjdE5vZGUsXG4gICAgICAgICAgICBleHRyYUhlaWdodCxcbiAgICAgICAgICAgIHRydWVcbiAgICAgICAgICApXG4gICAgICB9LCBrZXlib2FyZE9wZW5pbmdUaW1lKVxuICAgIH1cblxuICAgIHNjcm9sbEludG9WaWV3ID0gYXN5bmMgKFxuICAgICAgZWxlbWVudDogUmVhY3QuRWxlbWVudDwqPixcbiAgICAgIG9wdGlvbnM6IFNjcm9sbEludG9WaWV3T3B0aW9ucyA9IHt9XG4gICAgKSA9PiB7XG4gICAgICBpZiAoIXRoaXMuX3Jua2Fzdl9rZXlib2FyZFZpZXcgfHwgIWVsZW1lbnQpIHtcbiAgICAgICAgcmV0dXJuXG4gICAgICB9XG5cbiAgICAgIGNvbnN0IFtwYXJlbnRMYXlvdXQsIGNoaWxkTGF5b3V0XSA9IGF3YWl0IFByb21pc2UuYWxsKFtcbiAgICAgICAgdGhpcy5fbWVhc3VyZUVsZW1lbnQodGhpcy5fcm5rYXN2X2tleWJvYXJkVmlldyksXG4gICAgICAgIHRoaXMuX21lYXN1cmVFbGVtZW50KGVsZW1lbnQpXG4gICAgICBdKVxuXG4gICAgICBjb25zdCBnZXRTY3JvbGxQb3NpdGlvbiA9XG4gICAgICAgIG9wdGlvbnMuZ2V0U2Nyb2xsUG9zaXRpb24gfHwgdGhpcy5fZGVmYXVsdEdldFNjcm9sbFBvc2l0aW9uXG4gICAgICBjb25zdCB7IHgsIHksIGFuaW1hdGVkIH0gPSBnZXRTY3JvbGxQb3NpdGlvbihcbiAgICAgICAgcGFyZW50TGF5b3V0LFxuICAgICAgICBjaGlsZExheW91dCxcbiAgICAgICAgdGhpcy5wb3NpdGlvblxuICAgICAgKVxuICAgICAgdGhpcy5zY3JvbGxUb1Bvc2l0aW9uKHgsIHksIGFuaW1hdGVkKVxuICAgIH1cblxuICAgIF9kZWZhdWx0R2V0U2Nyb2xsUG9zaXRpb24gPSAoXG4gICAgICBwYXJlbnRMYXlvdXQ6IEVsZW1lbnRMYXlvdXQsXG4gICAgICBjaGlsZExheW91dDogRWxlbWVudExheW91dCxcbiAgICAgIGNvbnRlbnRPZmZzZXQ6IENvbnRlbnRPZmZzZXRcbiAgICApOiBTY3JvbGxQb3NpdGlvbiA9PiB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICB4OiAwLFxuICAgICAgICB5OiBNYXRoLm1heCgwLCBjaGlsZExheW91dC55IC0gcGFyZW50TGF5b3V0LnkgKyBjb250ZW50T2Zmc2V0LnkpLFxuICAgICAgICBhbmltYXRlZDogdHJ1ZVxuICAgICAgfVxuICAgIH1cblxuICAgIF9tZWFzdXJlRWxlbWVudCA9IChlbGVtZW50OiBSZWFjdC5FbGVtZW50PCo+KTogUHJvbWlzZTxFbGVtZW50TGF5b3V0PiA9PiB7XG4gICAgICBjb25zdCBub2RlID0gZmluZE5vZGVIYW5kbGUoZWxlbWVudClcbiAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZTogRWxlbWVudExheW91dCA9PiB2b2lkKSA9PiB7XG4gICAgICAgIFVJTWFuYWdlci5tZWFzdXJlSW5XaW5kb3coXG4gICAgICAgICAgbm9kZSxcbiAgICAgICAgICAoeDogbnVtYmVyLCB5OiBudW1iZXIsIHdpZHRoOiBudW1iZXIsIGhlaWdodDogbnVtYmVyKSA9PiB7XG4gICAgICAgICAgICByZXNvbHZlKHsgeCwgeSwgd2lkdGgsIGhlaWdodCB9KVxuICAgICAgICAgIH1cbiAgICAgICAgKVxuICAgICAgfSlcbiAgICB9XG5cbiAgICAvLyBLZXlib2FyZCBhY3Rpb25zXG4gICAgX3VwZGF0ZUtleWJvYXJkU3BhY2UgPSAoZnJhbWVzOiBPYmplY3QpID0+IHtcbiAgICAgIC8vIEF1dG9tYXRpY2FsbHkgc2Nyb2xsIHRvIGZvY3VzZWQgVGV4dElucHV0XG4gICAgICBpZiAodGhpcy5wcm9wcy5lbmFibGVBdXRvbWF0aWNTY3JvbGwpIHtcbiAgICAgICAgbGV0IGtleWJvYXJkU3BhY2U6IG51bWJlciA9XG4gICAgICAgICAgZnJhbWVzLmVuZENvb3JkaW5hdGVzLmhlaWdodCArIHRoaXMucHJvcHMuZXh0cmFTY3JvbGxIZWlnaHRcbiAgICAgICAgaWYgKHRoaXMucHJvcHMudmlld0lzSW5zaWRlVGFiQmFyKSB7XG4gICAgICAgICAga2V5Ym9hcmRTcGFjZSAtPSBfS0FNX0RFRkFVTFRfVEFCX0JBUl9IRUlHSFRcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnNldFN0YXRlKHsga2V5Ym9hcmRTcGFjZSB9KVxuICAgICAgICBjb25zdCBjdXJyZW50bHlGb2N1c2VkRmllbGQgPSBUZXh0SW5wdXQuU3RhdGUuY3VycmVudGx5Rm9jdXNlZEZpZWxkKClcbiAgICAgICAgY29uc3QgcmVzcG9uZGVyID0gdGhpcy5nZXRTY3JvbGxSZXNwb25kZXIoKVxuICAgICAgICBpZiAoIWN1cnJlbnRseUZvY3VzZWRGaWVsZCB8fCAhcmVzcG9uZGVyKSB7XG4gICAgICAgICAgcmV0dXJuXG4gICAgICAgIH1cbiAgICAgICAgVUlNYW5hZ2VyLnZpZXdJc0Rlc2NlbmRhbnRPZihcbiAgICAgICAgICBjdXJyZW50bHlGb2N1c2VkRmllbGQsXG4gICAgICAgICAgcmVzcG9uZGVyLmdldElubmVyVmlld05vZGUoKSxcbiAgICAgICAgICAoaXNBbmNlc3RvcjogYm9vbGVhbikgPT4ge1xuICAgICAgICAgICAgaWYgKGlzQW5jZXN0b3IpIHtcbiAgICAgICAgICAgICAgLy8gQ2hlY2sgaWYgdGhlIFRleHRJbnB1dCB3aWxsIGJlIGhpZGRlbiBieSB0aGUga2V5Ym9hcmRcbiAgICAgICAgICAgICAgVUlNYW5hZ2VyLm1lYXN1cmVJbldpbmRvdyhcbiAgICAgICAgICAgICAgICBjdXJyZW50bHlGb2N1c2VkRmllbGQsXG4gICAgICAgICAgICAgICAgKHg6IG51bWJlciwgeTogbnVtYmVyLCB3aWR0aDogbnVtYmVyLCBoZWlnaHQ6IG51bWJlcikgPT4ge1xuICAgICAgICAgICAgICAgICAgY29uc3QgdGV4dElucHV0Qm90dG9tUG9zaXRpb24gPSB5ICsgaGVpZ2h0XG4gICAgICAgICAgICAgICAgICBjb25zdCBrZXlib2FyZFBvc2l0aW9uID0gZnJhbWVzLmVuZENvb3JkaW5hdGVzLnNjcmVlbllcbiAgICAgICAgICAgICAgICAgIGNvbnN0IHRvdGFsRXh0cmFIZWlnaHQgPVxuICAgICAgICAgICAgICAgICAgICB0aGlzLnByb3BzLmV4dHJhU2Nyb2xsSGVpZ2h0ICsgdGhpcy5wcm9wcy5leHRyYUhlaWdodFxuICAgICAgICAgICAgICAgICAgaWYgKFBsYXRmb3JtLk9TID09PSAnaW9zJykge1xuICAgICAgICAgICAgICAgICAgICBpZiAoXG4gICAgICAgICAgICAgICAgICAgICAgdGV4dElucHV0Qm90dG9tUG9zaXRpb24gPlxuICAgICAgICAgICAgICAgICAgICAgIGtleWJvYXJkUG9zaXRpb24gLSB0b3RhbEV4dHJhSGVpZ2h0XG4gICAgICAgICAgICAgICAgICAgICkge1xuICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3Njcm9sbFRvRm9jdXNlZElucHV0V2l0aE5vZGVIYW5kbGUoXG4gICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50bHlGb2N1c2VkRmllbGRcbiAgICAgICAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIE9uIGFuZHJvaWQsIHRoZSBzeXN0ZW0gd291bGQgc2Nyb2xsIHRoZSB0ZXh0IGlucHV0IGp1c3RcbiAgICAgICAgICAgICAgICAgICAgLy8gYWJvdmUgdGhlIGtleWJvYXJkIHNvIHdlIGp1c3QgbmVldCB0byBzY3JvbGwgdGhlIGV4dHJhXG4gICAgICAgICAgICAgICAgICAgIC8vIGhlaWdodCBwYXJ0XG4gICAgICAgICAgICAgICAgICAgIGlmICh0ZXh0SW5wdXRCb3R0b21Qb3NpdGlvbiA+IGtleWJvYXJkUG9zaXRpb24pIHtcbiAgICAgICAgICAgICAgICAgICAgICAvLyBTaW5jZSB0aGUgc3lzdGVtIGFscmVhZHkgc2Nyb2xsZWQgdGhlIHdob2xlIHZpZXcgdXBcbiAgICAgICAgICAgICAgICAgICAgICAvLyB3ZSBzaG91bGQgcmVkdWNlIHRoYXQgYW1vdW50XG4gICAgICAgICAgICAgICAgICAgICAga2V5Ym9hcmRTcGFjZSA9XG4gICAgICAgICAgICAgICAgICAgICAgICBrZXlib2FyZFNwYWNlIC1cbiAgICAgICAgICAgICAgICAgICAgICAgICh0ZXh0SW5wdXRCb3R0b21Qb3NpdGlvbiAtIGtleWJvYXJkUG9zaXRpb24pXG4gICAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXRTdGF0ZSh7IGtleWJvYXJkU3BhY2UgfSlcbiAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNjcm9sbEZvckV4dHJhSGVpZ2h0T25BbmRyb2lkKHRvdGFsRXh0cmFIZWlnaHQpXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoXG4gICAgICAgICAgICAgICAgICAgICAgdGV4dElucHV0Qm90dG9tUG9zaXRpb24gPlxuICAgICAgICAgICAgICAgICAgICAgIGtleWJvYXJkUG9zaXRpb24gLSB0b3RhbEV4dHJhSGVpZ2h0XG4gICAgICAgICAgICAgICAgICAgICkge1xuICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2Nyb2xsRm9yRXh0cmFIZWlnaHRPbkFuZHJvaWQoXG4gICAgICAgICAgICAgICAgICAgICAgICB0b3RhbEV4dHJhSGVpZ2h0IC1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgKGtleWJvYXJkUG9zaXRpb24gLSB0ZXh0SW5wdXRCb3R0b21Qb3NpdGlvbilcbiAgICAgICAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIClcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIClcbiAgICAgIH1cbiAgICAgIGlmICghdGhpcy5wcm9wcy5yZXNldFNjcm9sbFRvQ29vcmRzKSB7XG4gICAgICAgIGlmICghdGhpcy5kZWZhdWx0UmVzZXRTY3JvbGxUb0Nvb3Jkcykge1xuICAgICAgICAgIHRoaXMuZGVmYXVsdFJlc2V0U2Nyb2xsVG9Db29yZHMgPSB0aGlzLnBvc2l0aW9uXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICBfcmVzZXRLZXlib2FyZFNwYWNlID0gKCkgPT4ge1xuICAgICAgY29uc3Qga2V5Ym9hcmRTcGFjZTogbnVtYmVyID0gdGhpcy5wcm9wcy52aWV3SXNJbnNpZGVUYWJCYXJcbiAgICAgICAgPyBfS0FNX0RFRkFVTFRfVEFCX0JBUl9IRUlHSFRcbiAgICAgICAgOiAwXG4gICAgICB0aGlzLnNldFN0YXRlKHsga2V5Ym9hcmRTcGFjZSB9KVxuICAgICAgLy8gUmVzZXQgc2Nyb2xsIHBvc2l0aW9uIGFmdGVyIGtleWJvYXJkIGRpc21pc3NhbFxuICAgICAgaWYgKHRoaXMucHJvcHMuZW5hYmxlUmVzZXRTY3JvbGxUb0Nvb3JkcyA9PT0gZmFsc2UpIHtcbiAgICAgICAgdGhpcy5kZWZhdWx0UmVzZXRTY3JvbGxUb0Nvb3JkcyA9IG51bGxcbiAgICAgICAgcmV0dXJuXG4gICAgICB9IGVsc2UgaWYgKHRoaXMucHJvcHMucmVzZXRTY3JvbGxUb0Nvb3Jkcykge1xuICAgICAgICB0aGlzLnNjcm9sbFRvUG9zaXRpb24oXG4gICAgICAgICAgdGhpcy5wcm9wcy5yZXNldFNjcm9sbFRvQ29vcmRzLngsXG4gICAgICAgICAgdGhpcy5wcm9wcy5yZXNldFNjcm9sbFRvQ29vcmRzLnksXG4gICAgICAgICAgdHJ1ZVxuICAgICAgICApXG4gICAgICB9IGVsc2Uge1xuICAgICAgICBpZiAodGhpcy5kZWZhdWx0UmVzZXRTY3JvbGxUb0Nvb3Jkcykge1xuICAgICAgICAgIHRoaXMuc2Nyb2xsVG9Qb3NpdGlvbihcbiAgICAgICAgICAgIHRoaXMuZGVmYXVsdFJlc2V0U2Nyb2xsVG9Db29yZHMueCxcbiAgICAgICAgICAgIHRoaXMuZGVmYXVsdFJlc2V0U2Nyb2xsVG9Db29yZHMueSxcbiAgICAgICAgICAgIHRydWVcbiAgICAgICAgICApXG4gICAgICAgICAgdGhpcy5kZWZhdWx0UmVzZXRTY3JvbGxUb0Nvb3JkcyA9IG51bGxcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB0aGlzLnNjcm9sbFRvUG9zaXRpb24oMCwgMCwgdHJ1ZSlcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIF9zY3JvbGxUb0ZvY3VzZWRJbnB1dFdpdGhOb2RlSGFuZGxlID0gKFxuICAgICAgbm9kZUlEOiBudW1iZXIsXG4gICAgICBleHRyYUhlaWdodD86IG51bWJlcixcbiAgICAgIGtleWJvYXJkT3BlbmluZ1RpbWU/OiBudW1iZXJcbiAgICApID0+IHtcbiAgICAgIGlmIChleHRyYUhlaWdodCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIGV4dHJhSGVpZ2h0ID0gdGhpcy5wcm9wcy5leHRyYUhlaWdodFxuICAgICAgfVxuICAgICAgY29uc3QgcmVhY3ROb2RlID0gZmluZE5vZGVIYW5kbGUobm9kZUlEKVxuICAgICAgdGhpcy5zY3JvbGxUb0ZvY3VzZWRJbnB1dChcbiAgICAgICAgcmVhY3ROb2RlLFxuICAgICAgICBleHRyYUhlaWdodCArIHRoaXMucHJvcHMuZXh0cmFTY3JvbGxIZWlnaHQsXG4gICAgICAgIGtleWJvYXJkT3BlbmluZ1RpbWUgIT09IHVuZGVmaW5lZFxuICAgICAgICAgID8ga2V5Ym9hcmRPcGVuaW5nVGltZVxuICAgICAgICAgIDogdGhpcy5wcm9wcy5rZXlib2FyZE9wZW5pbmdUaW1lIHx8IDBcbiAgICAgIClcbiAgICB9XG5cbiAgICBfaGFuZGxlT25TY3JvbGwgPSAoXG4gICAgICBlOiBTeW50aGV0aWNFdmVudDwqPiAmIHsgbmF0aXZlRXZlbnQ6IHsgY29udGVudE9mZnNldDogbnVtYmVyIH0gfVxuICAgICkgPT4ge1xuICAgICAgdGhpcy5wb3NpdGlvbiA9IGUubmF0aXZlRXZlbnQuY29udGVudE9mZnNldFxuICAgIH1cblxuICAgIF9oYW5kbGVSZWYgPSAocmVmOiBSZWFjdC5Db21wb25lbnQ8Kj4pID0+IHtcbiAgICAgIHRoaXMuX3Jua2Fzdl9rZXlib2FyZFZpZXcgPSByZWYgPyBob2NPcHRpb25zLmV4dHJhY3ROYXRpdmVSZWYocmVmKSA6IHJlZlxuICAgICAgaWYgKHRoaXMucHJvcHMuaW5uZXJSZWYpIHtcbiAgICAgICAgdGhpcy5wcm9wcy5pbm5lclJlZih0aGlzLl9ybmthc3Zfa2V5Ym9hcmRWaWV3KVxuICAgICAgfVxuICAgIH1cblxuICAgIHVwZGF0ZSA9ICgpID0+IHtcbiAgICAgIGNvbnN0IGN1cnJlbnRseUZvY3VzZWRGaWVsZCA9IFRleHRJbnB1dC5TdGF0ZS5jdXJyZW50bHlGb2N1c2VkRmllbGQoKVxuICAgICAgY29uc3QgcmVzcG9uZGVyID0gdGhpcy5nZXRTY3JvbGxSZXNwb25kZXIoKVxuXG4gICAgICBpZiAoIWN1cnJlbnRseUZvY3VzZWRGaWVsZCB8fCAhcmVzcG9uZGVyKSB7XG4gICAgICAgIHJldHVyblxuICAgICAgfVxuXG4gICAgICB0aGlzLl9zY3JvbGxUb0ZvY3VzZWRJbnB1dFdpdGhOb2RlSGFuZGxlKGN1cnJlbnRseUZvY3VzZWRGaWVsZClcbiAgICB9XG5cbiAgICByZW5kZXIoKSB7XG4gICAgICBjb25zdCB7IGVuYWJsZU9uQW5kcm9pZCwgY29udGVudENvbnRhaW5lclN0eWxlLCBvblNjcm9sbCB9ID0gdGhpcy5wcm9wc1xuICAgICAgbGV0IG5ld0NvbnRlbnRDb250YWluZXJTdHlsZVxuICAgICAgaWYgKFBsYXRmb3JtLk9TID09PSAnYW5kcm9pZCcgJiYgZW5hYmxlT25BbmRyb2lkKSB7XG4gICAgICAgIG5ld0NvbnRlbnRDb250YWluZXJTdHlsZSA9IFtdLmNvbmNhdChjb250ZW50Q29udGFpbmVyU3R5bGUpLmNvbmNhdCh7XG4gICAgICAgICAgcGFkZGluZ0JvdHRvbTpcbiAgICAgICAgICAgICgoY29udGVudENvbnRhaW5lclN0eWxlIHx8IHt9KS5wYWRkaW5nQm90dG9tIHx8IDApICtcbiAgICAgICAgICAgIHRoaXMuc3RhdGUua2V5Ym9hcmRTcGFjZVxuICAgICAgICB9KVxuICAgICAgfVxuICAgICAgY29uc3QgcmVmUHJvcHMgPSB7IFtob2NPcHRpb25zLnJlZlByb3BOYW1lXTogdGhpcy5faGFuZGxlUmVmIH1cbiAgICAgIHJldHVybiAoXG4gICAgICAgIDxTY3JvbGxhYmxlQ29tcG9uZW50XG4gICAgICAgICAgey4uLnJlZlByb3BzfVxuICAgICAgICAgIGtleWJvYXJkRGlzbWlzc01vZGU9J2ludGVyYWN0aXZlJ1xuICAgICAgICAgIGNvbnRlbnRJbnNldD17eyBib3R0b206IHRoaXMuc3RhdGUua2V5Ym9hcmRTcGFjZSB9fVxuICAgICAgICAgIGF1dG9tYXRpY2FsbHlBZGp1c3RDb250ZW50SW5zZXRzPXtmYWxzZX1cbiAgICAgICAgICBzaG93c1ZlcnRpY2FsU2Nyb2xsSW5kaWNhdG9yPXt0cnVlfVxuICAgICAgICAgIHNjcm9sbEV2ZW50VGhyb3R0bGU9ezF9XG4gICAgICAgICAgey4uLnRoaXMucHJvcHN9XG4gICAgICAgICAgY29udGVudENvbnRhaW5lclN0eWxlPXtcbiAgICAgICAgICAgIG5ld0NvbnRlbnRDb250YWluZXJTdHlsZSB8fCBjb250ZW50Q29udGFpbmVyU3R5bGVcbiAgICAgICAgICB9XG4gICAgICAgICAga2V5Ym9hcmRTcGFjZT17dGhpcy5zdGF0ZS5rZXlib2FyZFNwYWNlfVxuICAgICAgICAgIGdldFNjcm9sbFJlc3BvbmRlcj17dGhpcy5nZXRTY3JvbGxSZXNwb25kZXJ9XG4gICAgICAgICAgc2Nyb2xsVG9Qb3NpdGlvbj17dGhpcy5zY3JvbGxUb1Bvc2l0aW9ufVxuICAgICAgICAgIHNjcm9sbFRvRW5kPXt0aGlzLnNjcm9sbFRvRW5kfVxuICAgICAgICAgIHNjcm9sbEZvckV4dHJhSGVpZ2h0T25BbmRyb2lkPXt0aGlzLnNjcm9sbEZvckV4dHJhSGVpZ2h0T25BbmRyb2lkfVxuICAgICAgICAgIHNjcm9sbFRvRm9jdXNlZElucHV0PXt0aGlzLnNjcm9sbFRvRm9jdXNlZElucHV0fVxuICAgICAgICAgIHNjcm9sbEludG9WaWV3PXt0aGlzLnNjcm9sbEludG9WaWV3fVxuICAgICAgICAgIHJlc2V0S2V5Ym9hcmRTcGFjZT17dGhpcy5fcmVzZXRLZXlib2FyZFNwYWNlfVxuICAgICAgICAgIGhhbmRsZU9uU2Nyb2xsPXt0aGlzLl9oYW5kbGVPblNjcm9sbH1cbiAgICAgICAgICB1cGRhdGU9e3RoaXMudXBkYXRlfVxuICAgICAgICAgIG9uU2Nyb2xsPXtBbmltYXRlZC5mb3JrRXZlbnQob25TY3JvbGwsIHRoaXMuX2hhbmRsZU9uU2Nyb2xsKX1cbiAgICAgICAgLz5cbiAgICAgIClcbiAgICB9XG4gIH1cbn1cblxuLy8gQWxsb3cgdG8gcGFzcyBvcHRpb25zLCB3aXRob3V0IGJyZWFraW5nIGNoYW5nZSwgYW5kIGN1cnJpZWQgZm9yIGNvbXBvc2l0aW9uXG4vLyBsaXN0ZW5Ub0tleWJvYXJkRXZlbnRzKFNjcm9sbFZpZXcpO1xuLy8gbGlzdGVuVG9LZXlib2FyZEV2ZW50cyhvcHRpb25zKShDb21wKTtcbmNvbnN0IGxpc3RlblRvS2V5Ym9hcmRFdmVudHMgPSAoY29uZmlnT3JDb21wOiBhbnkpID0+IHtcbiAgaWYgKHR5cGVvZiBjb25maWdPckNvbXAgPT09ICdvYmplY3QnKSB7XG4gICAgcmV0dXJuIChDb21wOiBGdW5jdGlvbikgPT4gS2V5Ym9hcmRBd2FyZUhPQyhDb21wLCBjb25maWdPckNvbXApXG4gIH0gZWxzZSB7XG4gICAgcmV0dXJuIEtleWJvYXJkQXdhcmVIT0MoY29uZmlnT3JDb21wKVxuICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IGxpc3RlblRvS2V5Ym9hcmRFdmVudHNcbiJdfQ==