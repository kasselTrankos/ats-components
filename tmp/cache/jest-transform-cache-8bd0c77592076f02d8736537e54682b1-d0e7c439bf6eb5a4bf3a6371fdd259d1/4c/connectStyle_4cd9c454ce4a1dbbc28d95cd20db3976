21f789bfd2b58d81f56ad474866011ac
var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard");

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.clearThemeCache = clearThemeCache;
exports["default"] = void 0;

var _extends2 = _interopRequireDefault(require("@babel/runtime/helpers/extends"));

var _typeof2 = _interopRequireDefault(require("@babel/runtime/helpers/typeof"));

var _toConsumableArray2 = _interopRequireDefault(require("@babel/runtime/helpers/toConsumableArray"));

var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));

var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));

var _possibleConstructorReturn2 = _interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));

var _getPrototypeOf2 = _interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));

var _assertThisInitialized2 = _interopRequireDefault(require("@babel/runtime/helpers/assertThisInitialized"));

var _inherits2 = _interopRequireDefault(require("@babel/runtime/helpers/inherits"));

var _react = _interopRequireDefault(require("react"));

var _propTypes = _interopRequireDefault(require("prop-types"));

var _hoistNonReactStatics = _interopRequireDefault(require("hoist-non-react-statics"));

var _ = _interopRequireWildcard(require("lodash"));

var _normalizeStyle = _interopRequireDefault(require("./StyleNormalizer/normalizeStyle"));

var _reactNative = require("react-native");

var _Theme = _interopRequireWildcard(require("./Theme"));

var _resolveComponentStyle = require("./resolveComponentStyle");

var themeCache = {};

function clearThemeCache() {
  themeCache = {};
}

function throwConnectStyleError(errorMessage, componentDisplayName) {
  throw Error(errorMessage + " - when connecting " + componentDisplayName + " component to style.");
}

function getTheme(context) {
  return context.theme || _Theme["default"].getDefaultTheme();
}

function isStyleVariant(propertyName) {
  return /^\./.test(propertyName);
}

function isChildStyle(propertyName) {
  return /(^[^\.].*\.)|^\*$/.test(propertyName);
}

function getConcreteStyle(style) {
  return _.pickBy(style, function (value, key) {
    return !isStyleVariant(key) && !isChildStyle(key);
  });
}

var _default = function _default(componentStyleName) {
  var componentStyle = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};
  var mapPropsToStyleNames = arguments.length > 2 ? arguments[2] : undefined;
  var options = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : {};

  function getComponentDisplayName(WrappedComponent) {
    return WrappedComponent.displayName || WrappedComponent.name || "Component";
  }

  return function wrapWithStyledComponent(WrappedComponent) {
    var componentDisplayName = getComponentDisplayName(WrappedComponent);

    if (!_.isPlainObject(componentStyle)) {
      throwConnectStyleError("Component style must be plain object", componentDisplayName);
    }

    if (!_.isString(componentStyleName)) {
      throwConnectStyleError("Component Style Name must be string", componentDisplayName);
    }

    var StyledComponent = function (_React$Component) {
      (0, _inherits2["default"])(StyledComponent, _React$Component);

      function StyledComponent(props, context) {
        var _this;

        (0, _classCallCheck2["default"])(this, StyledComponent);
        _this = (0, _possibleConstructorReturn2["default"])(this, (0, _getPrototypeOf2["default"])(StyledComponent).call(this, props, context));

        var styleNames = _this.getStyleNames(props);

        var style = props.style;

        var finalStyle = _this.getFinalStyle(props, context, style, styleNames);

        _this.setWrappedInstance = _this.setWrappedInstance.bind((0, _assertThisInitialized2["default"])(_this));
        _this.resolveConnectedComponentStyle = _this.resolveConnectedComponentStyle.bind((0, _assertThisInitialized2["default"])(_this));
        _this.state = {
          style: finalStyle,
          addedProps: _this.resolveAddedProps(),
          styleNames: styleNames
        };
        return _this;
      }

      (0, _createClass2["default"])(StyledComponent, [{
        key: "getFinalStyle",
        value: function getFinalStyle(props, context, style, styleNames) {
          var resolvedStyle = {};

          if (context.parentPath) {
            resolvedStyle = this.getOrSetStylesInCache(context, props, styleNames, [].concat((0, _toConsumableArray2["default"])(context.parentPath), [componentStyleName], (0, _toConsumableArray2["default"])(styleNames)));
          } else {
            resolvedStyle = this.resolveStyle(context, props, styleNames);
            themeCache[componentStyleName] = resolvedStyle;
          }

          var concreteStyle = getConcreteStyle(_.merge({}, resolvedStyle));

          if (_.isArray(style)) {
            return [concreteStyle].concat((0, _toConsumableArray2["default"])(style));
          }

          if (typeof style == "number" || (0, _typeof2["default"])(style) == "object") {
            return [concreteStyle, style];
          }

          return concreteStyle;
        }
      }, {
        key: "getStyleNames",
        value: function getStyleNames(props) {
          var styleNamesArr = _.map(props, function (value, key) {
            if ((0, _typeof2["default"])(value) !== "object" && value === true) {
              return "." + key;
            } else {
              return false;
            }
          });

          _.remove(styleNamesArr, function (value, index) {
            return value === false;
          });

          return styleNamesArr;
        }
      }, {
        key: "getParentPath",
        value: function getParentPath() {
          if (!this.context.parentPath) {
            return [componentStyleName];
          } else {
            return [].concat((0, _toConsumableArray2["default"])(this.context.parentPath), [componentStyleName], (0, _toConsumableArray2["default"])(this.getStyleNames(this.props)));
          }
        }
      }, {
        key: "getChildContext",
        value: function getChildContext() {
          return {
            parentPath: this.getParentPath()
          };
        }
      }, {
        key: "UNSAFE_componentWillReceiveProps",
        value: function UNSAFE_componentWillReceiveProps(nextProps, nextContext) {
          var styleNames = this.getStyleNames(nextProps);
          var style = nextProps.style;

          if (this.shouldRebuildStyle(nextProps, nextContext, styleNames)) {
            var finalStyle = this.getFinalStyle(nextProps, nextContext, style, styleNames);
            this.setState({
              style: finalStyle,
              styleNames: styleNames
            });
          }
        }
      }, {
        key: "setNativeProps",
        value: function setNativeProps(nativeProps) {
          if (this.wrappedInstance.setNativeProps) {
            this.wrappedInstance.setNativeProps(nativeProps);
          }
        }
      }, {
        key: "setWrappedInstance",
        value: function setWrappedInstance(component) {
          if (component && component._root) {
            this._root = component._root;
          } else {
            this._root = component;
          }

          this.wrappedInstance = this._root;
        }
      }, {
        key: "hasStyleNameChanged",
        value: function hasStyleNameChanged(nextProps, styleNames) {
          return mapPropsToStyleNames && this.props !== nextProps && !_.isEqual(this.state.styleNames, styleNames);
        }
      }, {
        key: "shouldRebuildStyle",
        value: function shouldRebuildStyle(nextProps, nextContext, styleNames) {
          return nextProps.style !== this.props.style || nextProps.styleName !== this.props.styleName || nextContext.theme !== this.context.theme || !_.isEqual(nextContext.parentPath, this.context.parentPath) || this.hasStyleNameChanged(nextProps, styleNames);
        }
      }, {
        key: "resolveStyleNames",
        value: function resolveStyleNames(props) {
          var styleName = props.styleName;
          var styleNames = styleName ? styleName.split(/\s/g) : [];

          if (!mapPropsToStyleNames) {
            return styleNames;
          }

          return _.uniq(mapPropsToStyleNames(styleNames, props));
        }
      }, {
        key: "resolveAddedProps",
        value: function resolveAddedProps() {
          var addedProps = {};

          if (options.withRef) {
            addedProps.ref = "wrappedInstance";
          }

          return addedProps;
        }
      }, {
        key: "getOrSetStylesInCache",
        value: function getOrSetStylesInCache(context, props, styleNames, path) {
          if (themeCache && themeCache[path.join(">")]) {
            return themeCache[path.join(">")];
          } else {
            var resolvedStyle = this.resolveStyle(context, props, styleNames);

            if (Object.keys(themeCache).length < 10000) {
              themeCache[path.join(">")] = resolvedStyle;
            }

            return resolvedStyle;
          }
        }
      }, {
        key: "resolveStyle",
        value: function resolveStyle(context, props, styleNames) {
          var parentStyle = {};
          var theme = getTheme(context);
          var themeStyle = theme.createComponentStyle(componentStyleName, componentStyle);

          if (context.parentPath) {
            parentStyle = themeCache[context.parentPath.join(">")];
          } else {
            parentStyle = (0, _resolveComponentStyle.resolveComponentStyle)(componentStyleName, styleNames, themeStyle, parentStyle);
          }

          return (0, _resolveComponentStyle.resolveComponentStyle)(componentStyleName, styleNames, themeStyle, parentStyle);
        }
      }, {
        key: "resolveConnectedComponentStyle",
        value: function resolveConnectedComponentStyle(props) {
          var styleNames = this.resolveStyleNames(props);
          return this.resolveStyle(this.context, props, styleNames).componentStyle;
        }
      }, {
        key: "render",
        value: function render() {
          var _this$state = this.state,
              addedProps = _this$state.addedProps,
              style = _this$state.style;
          return _react["default"].createElement(WrappedComponent, (0, _extends2["default"])({}, this.props, addedProps, {
            style: style,
            ref: this.setWrappedInstance
          }));
        }
      }]);
      return StyledComponent;
    }(_react["default"].Component);

    StyledComponent.contextTypes = {
      theme: _Theme.ThemeShape,
      parentPath: _propTypes["default"].array
    };
    StyledComponent.childContextTypes = {
      parentPath: _propTypes["default"].array
    };
    StyledComponent.propTypes = {
      style: _propTypes["default"].oneOfType([_propTypes["default"].object, _propTypes["default"].number, _propTypes["default"].array]),
      styleName: _propTypes["default"].string,
      virtual: _propTypes["default"].bool
    };
    StyledComponent.defaultProps = {
      virtual: options.virtual
    };
    StyledComponent.displayName = "Styled(" + componentDisplayName + ")";
    StyledComponent.WrappedComponent = WrappedComponent;
    return (0, _hoistNonReactStatics["default"])(StyledComponent, WrappedComponent);
  };
};

exports["default"] = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvbm5lY3RTdHlsZS5qcyJdLCJuYW1lcyI6WyJ0aGVtZUNhY2hlIiwiY2xlYXJUaGVtZUNhY2hlIiwidGhyb3dDb25uZWN0U3R5bGVFcnJvciIsImVycm9yTWVzc2FnZSIsImNvbXBvbmVudERpc3BsYXlOYW1lIiwiRXJyb3IiLCJnZXRUaGVtZSIsImNvbnRleHQiLCJ0aGVtZSIsIlRoZW1lIiwiZ2V0RGVmYXVsdFRoZW1lIiwiaXNTdHlsZVZhcmlhbnQiLCJwcm9wZXJ0eU5hbWUiLCJ0ZXN0IiwiaXNDaGlsZFN0eWxlIiwiZ2V0Q29uY3JldGVTdHlsZSIsInN0eWxlIiwiXyIsInBpY2tCeSIsInZhbHVlIiwia2V5IiwiY29tcG9uZW50U3R5bGVOYW1lIiwiY29tcG9uZW50U3R5bGUiLCJtYXBQcm9wc1RvU3R5bGVOYW1lcyIsIm9wdGlvbnMiLCJnZXRDb21wb25lbnREaXNwbGF5TmFtZSIsIldyYXBwZWRDb21wb25lbnQiLCJkaXNwbGF5TmFtZSIsIm5hbWUiLCJ3cmFwV2l0aFN0eWxlZENvbXBvbmVudCIsImlzUGxhaW5PYmplY3QiLCJpc1N0cmluZyIsIlN0eWxlZENvbXBvbmVudCIsInByb3BzIiwic3R5bGVOYW1lcyIsImdldFN0eWxlTmFtZXMiLCJmaW5hbFN0eWxlIiwiZ2V0RmluYWxTdHlsZSIsInNldFdyYXBwZWRJbnN0YW5jZSIsImJpbmQiLCJyZXNvbHZlQ29ubmVjdGVkQ29tcG9uZW50U3R5bGUiLCJzdGF0ZSIsImFkZGVkUHJvcHMiLCJyZXNvbHZlQWRkZWRQcm9wcyIsInJlc29sdmVkU3R5bGUiLCJwYXJlbnRQYXRoIiwiZ2V0T3JTZXRTdHlsZXNJbkNhY2hlIiwicmVzb2x2ZVN0eWxlIiwiY29uY3JldGVTdHlsZSIsIm1lcmdlIiwiaXNBcnJheSIsInN0eWxlTmFtZXNBcnIiLCJtYXAiLCJyZW1vdmUiLCJpbmRleCIsImdldFBhcmVudFBhdGgiLCJuZXh0UHJvcHMiLCJuZXh0Q29udGV4dCIsInNob3VsZFJlYnVpbGRTdHlsZSIsInNldFN0YXRlIiwibmF0aXZlUHJvcHMiLCJ3cmFwcGVkSW5zdGFuY2UiLCJzZXROYXRpdmVQcm9wcyIsImNvbXBvbmVudCIsIl9yb290IiwiaXNFcXVhbCIsInN0eWxlTmFtZSIsImhhc1N0eWxlTmFtZUNoYW5nZWQiLCJzcGxpdCIsInVuaXEiLCJ3aXRoUmVmIiwicmVmIiwicGF0aCIsImpvaW4iLCJPYmplY3QiLCJrZXlzIiwibGVuZ3RoIiwicGFyZW50U3R5bGUiLCJ0aGVtZVN0eWxlIiwiY3JlYXRlQ29tcG9uZW50U3R5bGUiLCJyZXNvbHZlU3R5bGVOYW1lcyIsIlJlYWN0IiwiQ29tcG9uZW50IiwiY29udGV4dFR5cGVzIiwiVGhlbWVTaGFwZSIsIlByb3BUeXBlcyIsImFycmF5IiwiY2hpbGRDb250ZXh0VHlwZXMiLCJwcm9wVHlwZXMiLCJvbmVPZlR5cGUiLCJvYmplY3QiLCJudW1iZXIiLCJzdHJpbmciLCJ2aXJ0dWFsIiwiYm9vbCIsImRlZmF1bHRQcm9wcyJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUVBOztBQUNBOztBQUVBLElBQUlBLFVBQVUsR0FBRyxFQUFqQjs7QUFNTyxTQUFTQyxlQUFULEdBQTJCO0FBQ2hDRCxFQUFBQSxVQUFVLEdBQUcsRUFBYjtBQUNEOztBQVFELFNBQVNFLHNCQUFULENBQWdDQyxZQUFoQyxFQUE4Q0Msb0JBQTlDLEVBQW9FO0FBQ2xFLFFBQU1DLEtBQUssQ0FDTkYsWUFETSwyQkFDNEJDLG9CQUQ1QiwwQkFBWDtBQUdEOztBQVNELFNBQVNFLFFBQVQsQ0FBa0JDLE9BQWxCLEVBQTJCO0FBR3pCLFNBQU9BLE9BQU8sQ0FBQ0MsS0FBUixJQUFpQkMsa0JBQU1DLGVBQU4sRUFBeEI7QUFDRDs7QUFXRCxTQUFTQyxjQUFULENBQXdCQyxZQUF4QixFQUFzQztBQUNwQyxTQUFPLE1BQU1DLElBQU4sQ0FBV0QsWUFBWCxDQUFQO0FBQ0Q7O0FBY0QsU0FBU0UsWUFBVCxD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L0N3RCxTQWhDK0MsR0FnQ25DO0FBRWpCeEUsTUFBQUEsS0FBSyxFQUFFcUUsc0JBQVVJLFNBQVYsQ0FBb0IsQ0FDekJKLHNCQUFVSyxNQURlLEVBRXpCTCxzQkFBVU0sTUFGZSxFQUd6Qk4sc0JBQVVDLEtBSGUsQ0FBcEIsQ0FGVTtBQVNqQnBCLE1BQUFBLFNBQVMsRUFBRW1CLHNCQUFVTyxNQVRKO0FBY2pCQyxNQUFBQSxPQUFPLEVBQUVSLHNCQUFVUztBQWRGLEtBaENtQztBQWlCbEQ5RCxJQUFBQSxlQWpCa0QsQ0FpRC9DK0QsWUFqRCtDLEdBaURoQztBQUNwQkYsTUFBQUEsT0FBTyxFQUFFckUsT0FBTyxDQUFDcUU7QUFERyxLQWpEZ0M7QUFpQmxEN0QsSUFBQUEsZUFqQmtELENBcUQvQ0wsV0FyRCtDLGVBcUR2QnZCLG9CQXJEdUI7QUFpQmxENEIsSUFBQUEsZUFqQmtELENBc0QvQ04sZ0JBdEQrQyxHQXNENUJBLGdCQXRENEI7QUF3U3hELFdBQU8sc0NBQWFNLGVBQWIsRUFBOEJOLGdCQUE5QixDQUFQO0FBQ0QsR0F6U0Q7QUEwU0QsQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBSZWFjdCBmcm9tICdyZWFjdCc7XG5pbXBvcnQgUHJvcFR5cGVzIGZyb20gJ3Byb3AtdHlwZXMnO1xuaW1wb3J0IGhvaXN0U3RhdGljcyBmcm9tICdob2lzdC1ub24tcmVhY3Qtc3RhdGljcyc7XG5pbXBvcnQgKiBhcyBfIGZyb20gJ2xvZGFzaCc7XG5pbXBvcnQgbm9ybWFsaXplU3R5bGUgZnJvbSAnLi9TdHlsZU5vcm1hbGl6ZXIvbm9ybWFsaXplU3R5bGUnO1xuaW1wb3J0IHsgU3R5bGVTaGVldCB9IGZyb20gXCJyZWFjdC1uYXRpdmVcIjtcblxuaW1wb3J0IFRoZW1lLCB7IFRoZW1lU2hhcGUgfSBmcm9tIFwiLi9UaGVtZVwiO1xuaW1wb3J0IHsgcmVzb2x2ZUNvbXBvbmVudFN0eWxlIH0gZnJvbSBcIi4vcmVzb2x2ZUNvbXBvbmVudFN0eWxlXCI7XG5cbmxldCB0aGVtZUNhY2hlID0ge307XG5cbi8qKlxuICogY2xlYXIgdGhlbWUgY2FjaGVcbiAqIEBleHBvcnRcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGNsZWFyVGhlbWVDYWNoZSgpIHtcbiAgdGhlbWVDYWNoZSA9IHt9O1xufVxuXG4vKipcbiAqIEZvcm1hdHMgYW5kIHRocm93cyBhbiBlcnJvciB3aGVuIGNvbm5lY3RpbmcgY29tcG9uZW50IHN0eWxlIHdpdGggdGhlIHRoZW1lLlxuICpcbiAqIEBwYXJhbSBlcnJvck1lc3NhZ2UgVGhlIGVycm9yIG1lc3NhZ2UuXG4gKiBAcGFyYW0gY29tcG9uZW50RGlzcGxheU5hbWUgVGhlIG5hbWUgb2YgdGhlIGNvbXBvbmVudCB0aGF0IGlzIGJlaW5nIGNvbm5lY3RlZC5cbiAqL1xuZnVuY3Rpb24gdGhyb3dDb25uZWN0U3R5bGVFcnJvcihlcnJvck1lc3NhZ2UsIGNvbXBvbmVudERpc3BsYXlOYW1lKSB7XG4gIHRocm93IEVycm9yKFxuICAgIGAke2Vycm9yTWVzc2FnZX0gLSB3aGVuIGNvbm5lY3RpbmcgJHtjb21wb25lbnREaXNwbGF5TmFtZX0gY29tcG9uZW50IHRvIHN0eWxlLmBcbiAgKTtcbn1cblxuLyoqXG4gKiBSZXR1cm5zIHRoZSB0aGVtZSBvYmplY3QgZnJvbSB0aGUgcHJvdmlkZWQgY29udGV4dCxcbiAqIG9yIGFuIGVtcHR5IHRoZW1lIGlmIHRoZSBjb250ZXh0IGRvZXNuJ3QgY29udGFpbiBhIHRoZW1lLlxuICpcbiAqIEBwYXJhbSBjb250ZXh0IFRoZSBSZWFjdCBjb21wb25lbnQgY29udGV4dC5cbiAqIEByZXR1cm5zIHtUaGVtZX0gVGhlIFRoZW1lIG9iamVjdC5cbiAqL1xuZnVuY3Rpb24gZ2V0VGhlbWUoY29udGV4dCkge1xuICAvLyBGYWxsYmFjayB0byBhIGRlZmF1bHQgdGhlbWUgaWYgdGhlIGNvbXBvbmVudCBpc24ndFxuICAvLyByZW5kZXJlZCBpbiBhIFN0eWxlUHJvdmlkZXIuXG4gIHJldHVybiBjb250ZXh0LnRoZW1lIHx8IFRoZW1lLmdldERlZmF1bHRUaGVtZSgpO1xufVxuXG4vKipcbiAqIE1hdGNoZXMgYW55IHN0eWxlIHByb3BlcnRpZXMgdGhhdCByZXByZXNlbnQgY29tcG9uZW50IHN0eWxlIHZhcmlhbnRzLlxuICogVGhvc2Ugc3R5bGVzIGNhbiBiZSBhcHBsaWVkIHRvIHRoZSBjb21wb25lbnQgYnkgdXNpbmcgdGhlIHN0eWxlTmFtZVxuICogcHJvcC4gQWxsIHN0eWxlIHZhcmlhbnQgcHJvcGVydHkgbmFtZXMgbXVzdCBzdGFydCB3aXRoIGEgc2luZ2xlICcuJ1xuICogY2hhcmFjdGVyLCBlLmcuLCAnLnZhcmlhbnQnLlxuICpcbiAqIEBwYXJhbSBwcm9wZXJ0eU5hbWUgVGhlIHN0eWxlIHByb3BlcnR5IG5hbWUuXG4gKiBAcmV0dXJucyB7Ym9vbGVhbn0gVHJ1ZSBpZiB0aGUgc3R5bGUgcHJvcGVydHkgcmVwcmVzZW50cyBhIGNvbXBvbmVudCB2YXJpYW50LCBmYWxzZSBvdGhlcndpc2UuXG4gKi9cbmZ1bmN0aW9uIGlzU3R5bGVWYXJpYW50KHByb3BlcnR5TmFtZSkge1xuICByZXR1cm4gL15cXC4vLnRlc3QocHJvcGVydHlOYW1lKTtcbn1cblxuLyoqXG4gKiBNYXRjaGVzIGFueSBzdHlsZSBwcm9wZXJ0aWVzIHRoYXQgcmVwcmVzZW50IHN0eWxlIHJ1bGVzIHRoYXQgdGFyZ2V0IHRoZVxuICogY29tcG9uZW50IGNoaWxkcmVuLiBUaG9zZSBzdHlsZXMgY2FuIGhhdmUgdHdvIGZvcm1hdHMsIHRoZXkgY2FuIGVpdGhlclxuICogdGFyZ2V0IHRoZSBjb21wb25lbnRzIGJ5IGNvbXBvbmVudCBuYW1lICgnc2hvdXRlbS51aS5UZXh0JyksIG9yIGJ5IGNvbXBvbmVudFxuICogbmFtZSBhbmQgdmFyaWFudCAoJ3Nob3V0ZW0udWkuVGV4dC5saW5lLXRocm91Z2gnKS4gQmVzaWRlIHNwZWNpZnlpbmcgdGhlXG4gKiBjb21wb25lbnQgbmFtZSwgdGhvc2Ugc3R5bGVzIGNhbiBhbHNvIHRhcmdldCBhbnkgY29tcG9uZW50IGJ5IHVzaW5nIHRoZVxuICogJyonIHdpbGRjYXJkICgnKicsIG9yICcqLmxpbmUtdGhyb3VnaCcpLiBUaGUgcnVsZSB0byBpZGVudGlmeSB0aG9zZSBzdHlsZXMgaXNcbiAqIHRoYXQgdGhleSBoYXZlIHRvIGNvbnRhaW4gYSAnLicgY2hhcmFjdGVyIGluIHRoZWlyIG5hbWUgb3IgYmUgYSAnKicuXG4gKlxuICogQHBhcmFtIHByb3BlcnR5TmFtZSBUaGUgc3R5bGUgcHJvcGVydHkgbmFtZS5cbiAqIEByZXR1cm5zIHtib29sZWFufSBUcnVlIGlmIHRoZSBzdHlsZSBwcm9wZXJ0eSByZXByZXNlbnRzIGEgY2hpbGQgc3R5bGUsIGZhbHNlIG90aGVyd2lzZS5cbiAqL1xuZnVuY3Rpb24gaXNDaGlsZFN0eWxlKHByb3BlcnR5TmFtZSkge1xuICByZXR1cm4gLyheW15cXC5dLipcXC4pfF5cXCokLy50ZXN0KHByb3BlcnR5TmFtZSk7XG59XG5cbmZ1bmN0aW9uIGdldENvbmNyZXRlU3R5bGUoc3R5bGUpIHtcbiAgcmV0dXJuIF8ucGlja0J5KHN0eWxlLCAodmFsdWUsIGtleSkgPT4ge1xuICAgIHJldHVybiAhaXNTdHlsZVZhcmlhbnQoa2V5KSAmJiAhaXNDaGlsZFN0eWxlKGtleSk7XG4gIH0pO1xufVxuXG4vKipcbiAqIFJlc29sdmVzIHRoZSBmaW5hbCBjb21wb25lbnQgc3R5bGUgYnkgdXNpbmcgdGhlIHRoZW1lIHN0eWxlLCBpZiBhdmFpbGFibGUgYW5kXG4gKiBtZXJnaW5nIGl0IHdpdGggdGhlIHN0eWxlIHByb3ZpZGVkIGRpcmVjdGx5IHRocm91Z2ggdGhlIHN0eWxlIHByb3AsIGFuZCBzdHlsZVxuICogdmFyaWFudHMgYXBwbGllZCB0aHJvdWdoIHRoZSBzdHlsZU5hbWUgcHJvcC5cbiAqXG4gKiBAcGFyYW0gY29tcG9uZW50U3R5bGVOYW1lIFRoZSBjb21wb25lbnQgbmFtZSB0aGF0IHdpbGwgYmUgdXNlZFxuICogdG8gdGFyZ2V0IHRoaXMgY29tcG9uZW50IGluIHN0eWxlIHJ1bGVzLlxuICogQHBhcmFtIGNvbXBvbmVudFN0eWxlIFRoZSBkZWZhdWx0IGNvbXBvbmVudCBzdHlsZS5cbiAqIEBwYXJhbSBtYXBQcm9wc1RvU3R5bGVOYW1lcyBQdXJlIGZ1bmN0aW9uIHRvIGN1c3RvbWl6ZSBzdHlsZU5hbWVzIGRlcGVuZGluZyBvbiBwcm9wcy5cbiAqIEBwYXJhbSBvcHRpb25zIFRoZSBhZGRpdGlvbmFsIGNvbm5lY3RTdHlsZSBvcHRpb25zXG4gKiBAcGFyYW0gb3B0aW9ucy52aXJ0dWFsIFRoZSBkZWZhdWx0IHZhbHVlIG9mIHRoZSB2aXJ0dWFsIHByb3BcbiAqIEBwYXJhbSBvcHRpb25zLndpdGhSZWYgQ3JlYXRlIGNvbXBvbmVudCByZWYgd2l0aCBhZGRlZFByb3BzOyBpZiB0cnVlLCByZWYgbmFtZSBpcyB3cmFwcGVkSW5zdGFuY2VcbiAqIEByZXR1cm5zIHtTdHlsZWRDb21wb25lbnR9IFRoZSBuZXcgY29tcG9uZW50IHRoYXQgd2lsbCBoYW5kbGVcbiAqIHRoZSBzdHlsaW5nIG9mIHRoZSB3cmFwcGVkIGNvbXBvbmVudC5cbiAqL1xuZXhwb3J0IGRlZmF1bHQgKFxuICBjb21wb25lbnRTdHlsZU5hbWUsXG4gIGNvbXBvbmVudFN0eWxlID0ge30sXG4gIG1hcFByb3BzVG9TdHlsZU5hbWVzLFxuICBvcHRpb25zID0ge31cbikgPT4ge1xuICBmdW5jdGlvbiBnZXRDb21wb25lbnREaXNwbGF5TmFtZShXcmFwcGVkQ29tcG9uZW50KSB7XG4gICAgcmV0dXJuIFdyYXBwZWRDb21wb25lbnQuZGlzcGxheU5hbWUgfHwgV3JhcHBlZENvbXBvbmVudC5uYW1lIHx8IFwiQ29tcG9uZW50XCI7XG4gIH1cblxuICByZXR1cm4gZnVuY3Rpb24gd3JhcFdpdGhTdHlsZWRDb21wb25lbnQoV3JhcHBlZENvbXBvbmVudCkge1xuICAgIGNvbnN0IGNvbXBvbmVudERpc3BsYXlOYW1lID0gZ2V0Q29tcG9uZW50RGlzcGxheU5hbWUoV3JhcHBlZENvbXBvbmVudCk7XG5cbiAgICBpZiAoIV8uaXNQbGFpbk9iamVjdChjb21wb25lbnRTdHlsZSkpIHtcbiAgICAgIHRocm93Q29ubmVjdFN0eWxlRXJyb3IoXG4gICAgICAgIFwiQ29tcG9uZW50IHN0eWxlIG11c3QgYmUgcGxhaW4gb2JqZWN0XCIsXG4gICAgICAgIGNvbXBvbmVudERpc3BsYXlOYW1lXG4gICAgICApO1xuICAgIH1cblxuICAgIGlmICghXy5pc1N0cmluZyhjb21wb25lbnRTdHlsZU5hbWUpKSB7XG4gICAgICB0aHJvd0Nvbm5lY3RTdHlsZUVycm9yKFxuICAgICAgICBcIkNvbXBvbmVudCBTdHlsZSBOYW1lIG11c3QgYmUgc3RyaW5nXCIsXG4gICAgICAgIGNvbXBvbmVudERpc3BsYXlOYW1lXG4gICAgICApO1xuICAgIH1cblxuICAgIGNsYXNzIFN0eWxlZENvbXBvbmVudCBleHRlbmRzIFJlYWN0LkNvbXBvbmVudCB7XG4gICAgICBzdGF0aWMgY29udGV4dFR5cGVzID0ge1xuICAgICAgICB0aGVtZTogVGhlbWVTaGFwZSxcbiAgICAgICAgLy8gVGhlIHN0eWxlIGluaGVyaXRlZCBmcm9tIHRoZSBwYXJlbnRcbiAgICAgICAgLy8gcGFyZW50U3R5bGU6IFByb3BUeXBlcy5vYmplY3QsXG4gICAgICAgIHBhcmVudFBhdGg6IFByb3BUeXBlcy5hcnJheVxuICAgICAgfTtcblxuICAgICAgc3RhdGljIGNoaWxkQ29udGV4dFR5cGVzID0ge1xuICAgICAgICAvLyBQcm92aWRlIHRoZSBwYXJlbnQgc3R5bGUgdG8gY2hpbGQgY29tcG9uZW50c1xuICAgICAgICAvLyBwYXJlbnRTdHlsZTogUHJvcFR5cGVzLm9iamVjdCxcbiAgICAgICAgLy8gcmVzb2x2ZVN0eWxlOiBQcm9wVHlwZXMuZnVuYyxcbiAgICAgICAgcGFyZW50UGF0aDogUHJvcFR5cGVzLmFycmF5XG4gICAgICB9O1xuXG4gICAgICBzdGF0aWMgcHJvcFR5cGVzID0ge1xuICAgICAgICAvLyBFbGVtZW50IHN0eWxlIHRoYXQgb3ZlcnJpZGVzIGFueSBvdGhlciBzdHlsZSBvZiB0aGUgY29tcG9uZW50XG4gICAgICAgIHN0eWxlOiBQcm9wVHlwZXMub25lT2ZUeXBlKFtcbiAgICAgICAgICBQcm9wVHlwZXMub2JqZWN0LFxuICAgICAgICAgIFByb3BUeXBlcy5udW1iZXIsXG4gICAgICAgICAgUHJvcFR5cGVzLmFycmF5XG4gICAgICAgIF0pLFxuICAgICAgICAvLyBUaGUgc3R5bGUgdmFyaWFudCBuYW1lcyB0byBhcHBseSB0byB0aGlzIGNvbXBvbmVudCxcbiAgICAgICAgLy8gbXVsdGlwbGUgdmFyaWFudHMgbWF5IGJlIHNlcGFyYXRlZCB3aXRoIGEgc3BhY2UgY2hhcmFjdGVyXG4gICAgICAgIHN0eWxlTmFtZTogUHJvcFR5cGVzLnN0cmluZyxcbiAgICAgICAgLy8gVmlydHVhbCBlbGVtZW50cyB3aWxsIHByb3BhZ2F0ZSB0aGUgcGFyZW50XG4gICAgICAgIC8vIHN0eWxlIHRvIHRoZWlyIGNoaWxkcmVuLCBpLmUuLCB0aGUgY2hpbGRyZW5cbiAgICAgICAgLy8gd2lsbCBiZWhhdmUgYXMgdGhleSBhcmUgcGxhY2VkIGRpcmVjdGx5IGJlbG93XG4gICAgICAgIC8vIHRoZSBwYXJlbnQgb2YgYSB2aXJ0dWFsIGVsZW1lbnQuXG4gICAgICAgIHZpcnR1YWw6IFByb3BUeXBlcy5ib29sXG4gICAgICB9O1xuXG4gICAgICBzdGF0aWMgZGVmYXVsdFByb3BzID0ge1xuICAgICAgICB2aXJ0dWFsOiBvcHRpb25zLnZpcnR1YWxcbiAgICAgIH07XG5cbiAgICAgIHN0YXRpYyBkaXNwbGF5TmFtZSA9IGBTdHlsZWQoJHtjb21wb25lbnREaXNwbGF5TmFtZX0pYDtcbiAgICAgIHN0YXRpYyBXcmFwcGVkQ29tcG9uZW50ID0gV3JhcHBlZENvbXBvbmVudDtcblxuICAgICAgY29uc3RydWN0b3IocHJvcHMsIGNvbnRleHQpIHtcbiAgICAgICAgc3VwZXIocHJvcHMsIGNvbnRleHQpO1xuICAgICAgICAvLyBjb25zb2xlLmxvZyhjb250ZXh0LnBhcmVudFBhdGgpO1xuICAgICAgICBjb25zdCBzdHlsZU5hbWVzID0gdGhpcy5nZXRTdHlsZU5hbWVzKHByb3BzKTtcbiAgICAgICAgY29uc3Qgc3R5bGUgPSBwcm9wcy5zdHlsZTtcblxuICAgICAgICBjb25zdCBmaW5hbFN0eWxlID0gdGhpcy5nZXRGaW5hbFN0eWxlKFxuICAgICAgICAgIHByb3BzLFxuICAgICAgICAgIGNvbnRleHQsXG4gICAgICAgICAgc3R5bGUsXG4gICAgICAgICAgc3R5bGVOYW1lc1xuICAgICAgICApO1xuXG4gICAgICAgIHRoaXMuc2V0V3JhcHBlZEluc3RhbmNlID0gdGhpcy5zZXRXcmFwcGVkSW5zdGFuY2UuYmluZCh0aGlzKTtcbiAgICAgICAgdGhpcy5yZXNvbHZlQ29ubmVjdGVkQ29tcG9uZW50U3R5bGUgPSB0aGlzLnJlc29sdmVDb25uZWN0ZWRDb21wb25lbnRTdHlsZS5iaW5kKFxuICAgICAgICAgIHRoaXNcbiAgICAgICAgKTtcbiAgICAgICAgdGhpcy5zdGF0ZSA9IHtcbiAgICAgICAgICBzdHlsZTogZmluYWxTdHlsZSxcbiAgICAgICAgICAvLyBBZGRlZFByb3BzIGFyZSBhZGRpdGlvbmFsIFdyYXBwZWRDb21wb25lbnQgcHJvcHNcbiAgICAgICAgICAvLyBVc3VhbGx5IHRoZXkgYXJlIHNldCB0cm91Z2ggYWx0ZXJuYXRpdmUgd2F5cyxcbiAgICAgICAgICAvLyBzdWNoIGFzIHRoZW1lIHN0eWxlLCBvciB0cm91Z2ggb3B0aW9uc1xuICAgICAgICAgIGFkZGVkUHJvcHM6IHRoaXMucmVzb2x2ZUFkZGVkUHJvcHMoKSxcbiAgICAgICAgICBzdHlsZU5hbWVzXG4gICAgICAgIH07XG4gICAgICB9XG5cbiAgICAgIGdldEZpbmFsU3R5bGUocHJvcHMsIGNvbnRleHQsIHN0eWxlLCBzdHlsZU5hbWVzKSB7XG4gICAgICAgIGxldCByZXNvbHZlZFN0eWxlID0ge307XG4gICAgICAgIGlmIChjb250ZXh0LnBhcmVudFBhdGgpIHtcbiAgICAgICAgICByZXNvbHZlZFN0eWxlID0gdGhpcy5nZXRPclNldFN0eWxlc0luQ2FjaGUoXG4gICAgICAgICAgICBjb250ZXh0LFxuICAgICAgICAgICAgcHJvcHMsXG4gICAgICAgICAgICBzdHlsZU5hbWVzLFxuICAgICAgICAgICAgWy4uLmNvbnRleHQucGFyZW50UGF0aCwgY29tcG9uZW50U3R5bGVOYW1lLCAuLi5zdHlsZU5hbWVzXVxuICAgICAgICAgICk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcmVzb2x2ZWRTdHlsZSA9IHRoaXMucmVzb2x2ZVN0eWxlKGNvbnRleHQsIHByb3BzLCBzdHlsZU5hbWVzKTtcbiAgICAgICAgICB0aGVtZUNhY2hlW2NvbXBvbmVudFN0eWxlTmFtZV0gPSByZXNvbHZlZFN0eWxlO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgY29uY3JldGVTdHlsZSA9IGdldENvbmNyZXRlU3R5bGUoXy5tZXJnZSh7fSwgcmVzb2x2ZWRTdHlsZSkpO1xuXG4gICAgICAgIGlmIChfLmlzQXJyYXkoc3R5bGUpKSB7XG4gICAgICAgICAgcmV0dXJuIFtjb25jcmV0ZVN0eWxlLCAuLi5zdHlsZV07XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodHlwZW9mIHN0eWxlID09IFwibnVtYmVyXCIgfHwgdHlwZW9mIHN0eWxlID09IFwib2JqZWN0XCIpIHtcbiAgICAgICAgICByZXR1cm4gW2NvbmNyZXRlU3R5bGUsIHN0eWxlXTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBjb25jcmV0ZVN0eWxlO1xuICAgICAgfVxuXG4gICAgICBnZXRTdHlsZU5hbWVzKHByb3BzKSB7XG4gICAgICAgIGNvbnN0IHN0eWxlTmFtZXNBcnIgPSBfLm1hcChwcm9wcywgKHZhbHVlLCBrZXkpID0+IHtcbiAgICAgICAgICBpZiAodHlwZW9mIHZhbHVlICE9PSBcIm9iamVjdFwiICYmIHZhbHVlID09PSB0cnVlKSB7XG4gICAgICAgICAgICByZXR1cm4gXCIuXCIgKyBrZXk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBfLnJlbW92ZShzdHlsZU5hbWVzQXJyLCAodmFsdWUsIGluZGV4KSA9PiB7XG4gICAgICAgICAgcmV0dXJuIHZhbHVlID09PSBmYWxzZTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgcmV0dXJuIHN0eWxlTmFtZXNBcnI7XG4gICAgICB9XG5cbiAgICAgIGdldFBhcmVudFBhdGgoKSB7XG4gICAgICAgIGlmICghdGhpcy5jb250ZXh0LnBhcmVudFBhdGgpIHtcbiAgICAgICAgICByZXR1cm4gW2NvbXBvbmVudFN0eWxlTmFtZV07XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcmV0dXJuIFtcbiAgICAgICAgICAgIC4uLnRoaXMuY29udGV4dC5wYXJlbnRQYXRoLFxuICAgICAgICAgICAgY29tcG9uZW50U3R5bGVOYW1lLFxuICAgICAgICAgICAgLi4udGhpcy5nZXRTdHlsZU5hbWVzKHRoaXMucHJvcHMpXG4gICAgICAgICAgXTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBnZXRDaGlsZENvbnRleHQoKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgLy8gcGFyZW50U3R5bGU6IHRoaXMucHJvcHMudmlydHVhbCA/XG4gICAgICAgICAgLy8gICB0aGlzLmNvbnRleHQucGFyZW50U3R5bGUgOlxuICAgICAgICAgIC8vICAgdGhpcy5zdGF0ZS5jaGlsZHJlblN0eWxlLFxuICAgICAgICAgIC8vIHJlc29sdmVTdHlsZTogdGhpcy5yZXNvbHZlQ29ubmVjdGVkQ29tcG9uZW50U3R5bGUsXG4gICAgICAgICAgcGFyZW50UGF0aDogdGhpcy5nZXRQYXJlbnRQYXRoKClcbiAgICAgICAgfTtcbiAgICAgIH1cblxuICAgICAgVU5TQUZFX2NvbXBvbmVudFdpbGxSZWNlaXZlUHJvcHMobmV4dFByb3BzLCBuZXh0Q29udGV4dCkge1xuICAgICAgICBjb25zdCBzdHlsZU5hbWVzID0gdGhpcy5nZXRTdHlsZU5hbWVzKG5leHRQcm9wcyk7XG4gICAgICAgIGNvbnN0IHN0eWxlID0gbmV4dFByb3BzLnN0eWxlO1xuICAgICAgICBpZiAodGhpcy5zaG91bGRSZWJ1aWxkU3R5bGUobmV4dFByb3BzLCBuZXh0Q29udGV4dCwgc3R5bGVOYW1lcykpIHtcbiAgICAgICAgICBjb25zdCBmaW5hbFN0eWxlID0gdGhpcy5nZXRGaW5hbFN0eWxlKFxuICAgICAgICAgICAgbmV4dFByb3BzLFxuICAgICAgICAgICAgbmV4dENvbnRleHQsXG4gICAgICAgICAgICBzdHlsZSxcbiAgICAgICAgICAgIHN0eWxlTmFtZXNcbiAgICAgICAgICApO1xuXG4gICAgICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgICAgICBzdHlsZTogZmluYWxTdHlsZSxcbiAgICAgICAgICAgIC8vIGNoaWxkcmVuU3R5bGU6IHJlc29sdmVkU3R5bGUuY2hpbGRyZW5TdHlsZSxcbiAgICAgICAgICAgIHN0eWxlTmFtZXNcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBzZXROYXRpdmVQcm9wcyhuYXRpdmVQcm9wcykge1xuICAgICAgICBpZiAodGhpcy53cmFwcGVkSW5zdGFuY2Uuc2V0TmF0aXZlUHJvcHMpIHtcbiAgICAgICAgICB0aGlzLndyYXBwZWRJbnN0YW5jZS5zZXROYXRpdmVQcm9wcyhuYXRpdmVQcm9wcyk7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgc2V0V3JhcHBlZEluc3RhbmNlKGNvbXBvbmVudCkge1xuICAgICAgICBpZiAoY29tcG9uZW50ICYmIGNvbXBvbmVudC5fcm9vdCkge1xuICAgICAgICAgIHRoaXMuX3Jvb3QgPSBjb21wb25lbnQuX3Jvb3Q7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdGhpcy5fcm9vdCA9IGNvbXBvbmVudDtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLndyYXBwZWRJbnN0YW5jZSA9IHRoaXMuX3Jvb3Q7XG4gICAgICB9XG5cbiAgICAgIGhhc1N0eWxlTmFtZUNoYW5nZWQobmV4dFByb3BzLCBzdHlsZU5hbWVzKSB7XG4gICAgICAgIHJldHVybiAoXG4gICAgICAgICAgbWFwUHJvcHNUb1N0eWxlTmFtZXMgJiZcbiAgICAgICAgICB0aGlzLnByb3BzICE9PSBuZXh0UHJvcHMgJiZcbiAgICAgICAgICAvLyBFdmVuIHRob3VnaCBwcm9wcyBkaWQgY2hhbmdlIGhlcmUsXG4gICAgICAgICAgLy8gaXQgZG9lc24ndCBuZWNlc3NhcnkgbWVhbnMgY2hhbmdlZCBwcm9wcyBhcmUgdGhvc2Ugd2hpY2ggYWZmZWN0IHN0eWxlTmFtZVxuICAgICAgICAgICFfLmlzRXF1YWwodGhpcy5zdGF0ZS5zdHlsZU5hbWVzLCBzdHlsZU5hbWVzKVxuICAgICAgICApO1xuICAgICAgfVxuXG4gICAgICBzaG91bGRSZWJ1aWxkU3R5bGUobmV4dFByb3BzLCBuZXh0Q29udGV4dCwgc3R5bGVOYW1lcykge1xuICAgICAgICByZXR1cm4gKFxuICAgICAgICAgIG5leHRQcm9wcy5zdHlsZSAhPT0gdGhpcy5wcm9wcy5zdHlsZSB8fFxuICAgICAgICAgIG5leHRQcm9wcy5zdHlsZU5hbWUgIT09IHRoaXMucHJvcHMuc3R5bGVOYW1lIHx8XG4gICAgICAgICAgbmV4dENvbnRleHQudGhlbWUgIT09IHRoaXMuY29udGV4dC50aGVtZSB8fFxuICAgICAgICAgICFfLmlzRXF1YWwobmV4dENvbnRleHQucGFyZW50UGF0aCwgdGhpcy5jb250ZXh0LnBhcmVudFBhdGgpIHx8XG4gICAgICAgICAgdGhpcy5oYXNTdHlsZU5hbWVDaGFuZ2VkKG5leHRQcm9wcywgc3R5bGVOYW1lcylcbiAgICAgICAgKTtcbiAgICAgIH1cblxuICAgICAgcmVzb2x2ZVN0eWxlTmFtZXMocHJvcHMpIHtcbiAgICAgICAgY29uc3QgeyBzdHlsZU5hbWUgfSA9IHByb3BzO1xuICAgICAgICBjb25zdCBzdHlsZU5hbWVzID0gc3R5bGVOYW1lID8gc3R5bGVOYW1lLnNwbGl0KC9cXHMvZykgOiBbXTtcblxuICAgICAgICBpZiAoIW1hcFByb3BzVG9TdHlsZU5hbWVzKSB7XG4gICAgICAgICAgcmV0dXJuIHN0eWxlTmFtZXM7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBXZSBvbmx5IHdhbnQgdG8ga2VlcCB0aGUgdW5pcXVlIHN0eWxlIG5hbWVzXG4gICAgICAgIHJldHVybiBfLnVuaXEobWFwUHJvcHNUb1N0eWxlTmFtZXMoc3R5bGVOYW1lcywgcHJvcHMpKTtcbiAgICAgIH1cblxuICAgICAgcmVzb2x2ZUFkZGVkUHJvcHMoKSB7XG4gICAgICAgIGNvbnN0IGFkZGVkUHJvcHMgPSB7fTtcbiAgICAgICAgaWYgKG9wdGlvbnMud2l0aFJlZikge1xuICAgICAgICAgIGFkZGVkUHJvcHMucmVmID0gXCJ3cmFwcGVkSW5zdGFuY2VcIjtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gYWRkZWRQcm9wcztcbiAgICAgIH1cblxuICAgICAgZ2V0T3JTZXRTdHlsZXNJbkNhY2hlKGNvbnRleHQsIHByb3BzLCBzdHlsZU5hbWVzLCBwYXRoKSB7XG4gICAgICAgIGlmICh0aGVtZUNhY2hlICYmIHRoZW1lQ2FjaGVbcGF0aC5qb2luKFwiPlwiKV0pIHtcbiAgICAgICAgICAvLyBjb25zb2xlLmxvZygnKioqKioqKioqKioqKionKTtcblxuICAgICAgICAgIHJldHVybiB0aGVtZUNhY2hlW3BhdGguam9pbihcIj5cIildO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGNvbnN0IHJlc29sdmVkU3R5bGUgPSB0aGlzLnJlc29sdmVTdHlsZShjb250ZXh0LCBwcm9wcywgc3R5bGVOYW1lcyk7XG4gICAgICAgICAgaWYgKE9iamVjdC5rZXlzKHRoZW1lQ2FjaGUpLmxlbmd0aCA8IDEwMDAwKSB7XG4gICAgICAgICAgICB0aGVtZUNhY2hlW3BhdGguam9pbihcIj5cIildID0gcmVzb2x2ZWRTdHlsZTtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIHJlc29sdmVkU3R5bGU7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgcmVzb2x2ZVN0eWxlKGNvbnRleHQsIHByb3BzLCBzdHlsZU5hbWVzKSB7XG4gICAgICAgIGxldCBwYXJlbnRTdHlsZSA9IHt9O1xuXG4gICAgICAgIGNvbnN0IHRoZW1lID0gZ2V0VGhlbWUoY29udGV4dCk7XG4gICAgICAgIGNvbnN0IHRoZW1lU3R5bGUgPSB0aGVtZS5jcmVhdGVDb21wb25lbnRTdHlsZShcbiAgICAgICAgICBjb21wb25lbnRTdHlsZU5hbWUsXG4gICAgICAgICAgY29tcG9uZW50U3R5bGVcbiAgICAgICAgKTtcblxuICAgICAgICBpZiAoY29udGV4dC5wYXJlbnRQYXRoKSB7XG4gICAgICAgICAgcGFyZW50U3R5bGUgPSB0aGVtZUNhY2hlW2NvbnRleHQucGFyZW50UGF0aC5qb2luKFwiPlwiKV07XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcGFyZW50U3R5bGUgPSByZXNvbHZlQ29tcG9uZW50U3R5bGUoXG4gICAgICAgICAgICBjb21wb25lbnRTdHlsZU5hbWUsXG4gICAgICAgICAgICBzdHlsZU5hbWVzLFxuICAgICAgICAgICAgdGhlbWVTdHlsZSxcbiAgICAgICAgICAgIHBhcmVudFN0eWxlXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiByZXNvbHZlQ29tcG9uZW50U3R5bGUoXG4gICAgICAgICAgY29tcG9uZW50U3R5bGVOYW1lLFxuICAgICAgICAgIHN0eWxlTmFtZXMsXG4gICAgICAgICAgdGhlbWVTdHlsZSxcbiAgICAgICAgICBwYXJlbnRTdHlsZVxuICAgICAgICApO1xuICAgICAgfVxuXG4gICAgICAvKipcbiAgICAgICAqIEEgaGVscGVyIGZ1bmN0aW9uIHByb3ZpZGVkIHRvIGNoaWxkIGNvbXBvbmVudHMgdGhhdCBlbmFibGVzXG4gICAgICAgKiB0aGVtIHRvIHJlc29sdmUgdGhlaXIgc3R5bGUgZm9yIGFueSBzZXQgb2YgcHJvcCB2YWx1ZXMuXG4gICAgICAgKlxuICAgICAgICogQHBhcmFtIHByb3BzIFRoZSBjb21wb25lbnQgcHJvcHMgdG8gdXNlIHRvIHJlc29sdmUgdGhlIHN0eWxlIHZhbHVlcy5cbiAgICAgICAqIEByZXR1cm5zIHsqfSBUaGUgcmVzb2x2ZWQgY29tcG9uZW50IHN0eWxlLlxuICAgICAgICovXG4gICAgICByZXNvbHZlQ29ubmVjdGVkQ29tcG9uZW50U3R5bGUocHJvcHMpIHtcbiAgICAgICAgY29uc3Qgc3R5bGVOYW1lcyA9IHRoaXMucmVzb2x2ZVN0eWxlTmFtZXMocHJvcHMpO1xuICAgICAgICByZXR1cm4gdGhpcy5yZXNvbHZlU3R5bGUodGhpcy5jb250ZXh0LCBwcm9wcywgc3R5bGVOYW1lcylcbiAgICAgICAgICAuY29tcG9uZW50U3R5bGU7XG4gICAgICB9XG5cbiAgICAgIHJlbmRlcigpIHtcbiAgICAgICAgLy8gY29uc29sZS5sb2coJ3RoZW1lQ2FjaGUnLCB0aGVtZUNhY2hlKTtcblxuICAgICAgICAvLyBpZihjb21wb25lbnRTdHlsZU5hbWUgPT0gJ05hdGl2ZUJhc2UuVGV4dCcpIHtcbiAgICAgICAgLy8gICBjb25zb2xlLmxvZyh0aGlzLnN0YXRlLnN0eWxlKTtcbiAgICAgICAgLy8gICBjb25zb2xlLmxvZyh0aGVtZUNhY2hlKTtcbiAgICAgICAgLy8gfVxuXG4gICAgICAgIGNvbnN0IHsgYWRkZWRQcm9wcywgc3R5bGUgfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgIHJldHVybiAoXG4gICAgICAgICAgPFdyYXBwZWRDb21wb25lbnRcbiAgICAgICAgICAgIHsuLi50aGlzLnByb3BzfVxuICAgICAgICAgICAgey4uLmFkZGVkUHJvcHN9XG4gICAgICAgICAgICBzdHlsZT17c3R5bGV9XG4gICAgICAgICAgICByZWY9e3RoaXMuc2V0V3JhcHBlZEluc3RhbmNlfVxuICAgICAgICAgIC8+XG4gICAgICAgICk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIGhvaXN0U3RhdGljcyhTdHlsZWRDb21wb25lbnQsIFdyYXBwZWRDb21wb25lbnQpO1xuICB9O1xufTtcbiJdfQ==