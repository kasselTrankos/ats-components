e25b3b0ce330732cadf83879d63635d3
'use strict';

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));

var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));

var _possibleConstructorReturn2 = _interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));

var _getPrototypeOf2 = _interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));

var _get2 = _interopRequireDefault(require("@babel/runtime/helpers/get"));

var _inherits2 = _interopRequireDefault(require("@babel/runtime/helpers/inherits"));

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }

function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(source, true).forEach(function (key) { (0, _defineProperty2["default"])(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(source).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }

var AnimatedNode = require('./AnimatedNode');

var AnimatedWithChildren = require('./AnimatedWithChildren');

var NativeAnimatedHelper = require('../NativeAnimatedHelper');

var invariant = require('invariant');

var normalizeColor = require('../../../Color/normalizeColor');

var linear = function linear(t) {
  return t;
};

function createInterpolation(config) {
  if (config.outputRange && typeof config.outputRange[0] === 'string') {
    return createInterpolationFromStringOutputRange(config);
  }

  var outputRange = config.outputRange;
  checkInfiniteRange('outputRange', outputRange);
  var inputRange = config.inputRange;
  checkInfiniteRange('inputRange', inputRange);
  checkValidInputRange(inputRange);
  invariant(inputRange.length === outputRange.length, 'inputRange (' + inputRange.length + ') and outputRange (' + outputRange.length + ') must have the same length');
  var easing = config.easing || linear;
  var extrapolateLeft = 'extend';

  if (config.extrapolateLeft !== undefined) {
    extrapolateLeft = config.extrapolateLeft;
  } else if (config.extrapolate !== undefined) {
    extrapolateLeft = config.extrapolate;
  }

  var extrapolateRight = 'extend';

  if (config.extrapolateRight !== undefined) {
    extrapolateRight = config.extrapolateRight;
  } else if (config.extrapolate !== undefined) {
    extrapolateRight = config.extrapolate;
  }

  return function (input) {
    invariant(typeof input === 'number', 'Cannot interpolation an input which is not a number');
    var range = findRange(input, inputRange);
    return interpolate(input, inputRange[range], inputRange[range + 1], outputRange[range], outputRange[range + 1], easing, extrapolateLeft, extrapolateRight);
  };
}

function interpolate(input, inputMin, inputMax, outputMin, outputMax, easing, extrapolateLeft, extrapolateRight) {
  var result = input;

  if (result < inputMin) {
    if (extrapolateLeft === 'identity') {
      return result;
    } else if (extrapolateLeft === 'clamp') {
      result = inputMin;
    } else if (extrapolateLeft === 'extend') {}
  }

  if (result > inputMax) {
    if (extrapolateRight === 'identity') {
      return result;
    } else if (extrapolateRight === 'clamp') {
      result = inputMax;
    } else if (extrapolateRight === 'extend') {}
  }

  if (outputMin === outputMax) {
    return outputMin;
  }

  if (inputMin === inputMax) {
    if (input <= inputMin) {
      return outputMin;
    }

    return outputMax;
  }

  if (inputMin === -Infinity) {
    result = -result;
  } else if (inputMax === Infinity) {
    result = result - inputMin;
  } else {
    result = (result - inputMin) / (inputMax - inputMin);
  }

  result = easing(result);

  if (outputMin === -Infinity) {
    result = -result;
  } else if (outputMax === Infinity) {
    result = result + outputMin;
  } else {
    result = result * (outputMax - outputMin) + outputMin;
  }

  return result;
}

function colorToRgba(input) {
  var int32Color = normalizeColor(input);

  if (int32Color === null) {
    return input;
  }

  int32Color = int32Color || 0;
  var r = (int32Color & 0xff000000) >>> 24;
  var g = (int32Color & 0x00ff0000) >>> 16;
  var b = (int32Color & 0x0000ff00) >>> 8;
  var a = (int32Color & 0x000000ff) / 255;
  return "rgba(" + r + ", " + g + ", " + b + ", " + a + ")";
}

var stringShapeRegex = /[+-]?(?:\d+\.?\d*|\.\d+)(?:[eE][+-]?\d+)?/g;

function createInterpolationFromStringOutputRange(config) {
  var outputRange = config.outputRange;
  invariant(outputRange.length >= 2, 'Bad output range');
  outputRange = outputRange.map(colorToRgba);
  checkPattern(outputRange);
  var outputRanges = outputRange[0].match(stringShapeRegex).map(function () {
    return [];
  });
  outputRange.forEach(function (value) {
    value.match(stringShapeRegex).forEach(function (number, i) {
      outputRanges[i].push(+number);
    });
  });
  var interpolations = outputRange[0].match(stringShapeRegex).map(function (value, i) {
    return createInterpolation(_objectSpread({}, config, {
      outputRange: outputRanges[i]
    }));
  });
  var shouldRound = isRgbOrRgba(outputRange[0]);
  return function (input) {
    var i = 0;
    return outputRange[0].replace(stringShapeRegex, function () {
      var val = +interpolations[i++](input);

      if (shouldRound) {
        val = i < 4 ? Math.round(val) : Math.round(val * 1000) / 1000;
      }

      return String(val);
    });
  };
}

function isRgbOrRgba(range) {
  return typeof range === 'string' && range.startsWith('rgb');
}

function checkPattern(arr) {
  var pattern = arr[0].replace(stringShapeRegex, '');

  for (var i = 1; i < arr.length; ++i) {
    invariant(pattern === arr[i].replace(stringShapeRegex, ''), 'invalid pattern ' + arr[0] + ' and ' + arr[i]);
  }
}

function findRange(input, inputRange) {
  var i;

  for (i = 1; i < inputRange.length - 1; ++i) {
    if (inputRange[i] >= input) {
      break;
    }
  }

  return i - 1;
}

function checkValidInputRange(arr) {
  invariant(arr.length >= 2, 'inputRange must have at least 2 elements');

  for (var i = 1; i < arr.length; ++i) {
    invariant(arr[i] >= arr[i - 1], 'inputRange must be monotonically non-decreasing ' + arr);
  }
}

function checkInfiniteRange(name, arr) {
  invariant(arr.length >= 2, name + ' must have at least 2 elements');
  invariant(arr.length !== 2 || arr[0] !== -Infinity || arr[1] !== Infinity, name + 'cannot be ]-infinity;+infinity[ ' + arr);
}

var AnimatedInterpolation = function (_AnimatedWithChildren) {
  (0, _inherits2["default"])(AnimatedInterpolation, _AnimatedWithChildren);

  function AnimatedInterpolation(parent, config) {
    var _this;

    (0, _classCallCheck2["default"])(this, AnimatedInterpolation);
    _this = (0, _possibleConstructorReturn2["default"])(this, (0, _getPrototypeOf2["default"])(AnimatedInterpolation).call(this));
    _this._parent = void 0;
    _this._config = void 0;
    _this._interpolation = void 0;
    _this._parent = parent;
    _this._config = config;
    _this._interpolation = createInterpolation(config);
    return _this;
  }

  (0, _createClass2["default"])(AnimatedInterpolation, [{
    key: "__makeNative",
    value: function __makeNative() {
      this._parent.__makeNative();

      (0, _get2["default"])((0, _getPrototypeOf2["default"])(AnimatedInterpolation.prototype), "__makeNative", this).call(this);
    }
  }, {
    key: "__getValue",
    value: function __getValue() {
      var parentValue = this._parent.__getValue();

      invariant(typeof parentValue === 'number', 'Cannot interpolate an input which is not a number.');
      return this._interpolation(parentValue);
    }
  }, {
    key: "interpolate",
    value: function interpolate(config) {
      return new AnimatedInterpolation(this, config);
    }
  }, {
    key: "__attach",
    value: function __attach() {
      this._parent.__addChild(this);
    }
  }, {
    key: "__detach",
    value: function __detach() {
      this._parent.__removeChild(this);

      (0, _get2["default"])((0, _getPrototypeOf2["default"])(AnimatedInterpolation.prototype), "__detach", this).call(this);
    }
  }, {
    key: "__transformDataType",
    value: function __transformDataType(range) {
      return range.map(NativeAnimatedHelper.transformDataType);
    }
  }, {
    key: "__getNativeConfig",
    value: function __getNativeConfig() {
      if (__DEV__) {
        NativeAnimatedHelper.validateInterpolation(this._config);
      }

      return {
        inputRange: this._config.inputRange,
        outputRange: this.__transformDataType(this._config.outputRange),
        extrapolateLeft: this._config.extrapolateLeft || this._config.extrapolate || 'extend',
        extrapolateRight: this._config.extrapolateRight || this._config.extrapolate || 'extend',
        type: 'interpolation'
      };
    }
  }]);
  return AnimatedInterpolation;
}(AnimatedWithChildren);

AnimatedInterpolation.__createInterpolation = createInterpolation;
module.exports = AnimatedInterpolation;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkFuaW1hdGVkSW50ZXJwb2xhdGlvbi5qcyJdLCJuYW1lcyI6WyJBbmltYXRlZE5vZGUiLCJyZXF1aXJlIiwiQW5pbWF0ZWRXaXRoQ2hpbGRyZW4iLCJOYXRpdmVBbmltYXRlZEhlbHBlciIsImludmFyaWFudCIsIm5vcm1hbGl6ZUNvbG9yIiwibGluZWFyIiwidCIsImNyZWF0ZUludGVycG9sYXRpb24iLCJjb25maWciLCJvdXRwdXRSYW5nZSIsImNyZWF0ZUludGVycG9sYXRpb25Gcm9tU3RyaW5nT3V0cHV0UmFuZ2UiLCJjaGVja0luZmluaXRlUmFuZ2UiLCJpbnB1dFJhbmdlIiwiY2hlY2tWYWxpZElucHV0UmFuZ2UiLCJsZW5ndGgiLCJlYXNpbmciLCJleHRyYXBvbGF0ZUxlZnQiLCJ1bmRlZmluZWQiLCJleHRyYXBvbGF0ZSIsImV4dHJhcG9sYXRlUmlnaHQiLCJpbnB1dCIsInJhbmdlIiwiZmluZFJhbmdlIiwiaW50ZXJwb2xhdGUiLCJpbnB1dE1pbiIsImlucHV0TWF4Iiwib3V0cHV0TWluIiwib3V0cHV0TWF4IiwicmVzdWx0IiwiSW5maW5pdHkiLCJjb2xvclRvUmdiYSIsImludDMyQ29sb3IiLCJyIiwiZyIsImIiLCJhIiwic3RyaW5nU2hhcGVSZWdleCIsIm1hcCIsImNoZWNrUGF0dGVybiIsIm91dHB1dFJhbmdlcyIsIm1hdGNoIiwiZm9yRWFjaCIsInZhbHVlIiwibnVtYmVyIiwiaSIsInB1c2giLCJpbnRlcnBvbGF0aW9ucyIsInNob3VsZFJvdW5kIiwiaXNSZ2JPclJnYmEiLCJyZXBsYWNlIiwidmFsIiwiTWF0aCIsInJvdW5kIiwiU3RyaW5nIiwic3RhcnRzV2l0aCIsImFyciIsInBhdHRlcm4iLCJuYW1lIiwiQW5pbWF0ZWRJbnRlcnBvbGF0aW9uIiwicGFyZW50IiwiX3BhcmVudCIsIl9jb25maWciLCJfaW50ZXJwb2xhdGlvbiIsIl9fbWFrZU5hdGl2ZSIsInBhcmVudFZhbHVlIiwiX19nZXRWYWx1ZSIsIl9fYWRkQ2hpbGQiLCJfX3JlbW92ZUNoaWxkIiwidHJhbnNmb3JtRGF0YVR5cGUiLCJfX0RFVl9fIiwidmFsaWRhdGVJbnRlcnBvbGF0aW9uIiwiX190cmFuc2Zvcm1EYXRhVHlwZSIsInR5cGUiLCJfX2NyZWF0ZUludGVycG9sYXRpb24iLCJtb2R1bGUiLCJleHBvcnRzIl0sIm1hcHBpbmdzIjoiQUFVQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUVBLElBQU1BLFlBQVksR0FBR0MsT0FBTyxDQUFDLGdCQUFELENBQTVCOztBQUNBLElBQU1DLG9CQUFvQixHQUFHRCxPQUFPLENBQUMsd0JBQUQsQ0FBcEM7O0FBQ0EsSUFBTUUsb0JBQW9CLEdBQUdGLE9BQU8sQ0FBQyx5QkFBRCxDQUFwQzs7QUFFQSxJQUFNRyxTQUFTLEdBQUdILE9BQU8sQ0FBQyxXQUFELENBQXpCOztBQUNBLElBQU1JLGNBQWMsR0FBR0osT0FBTyxDQUFDLCtCQUFELENBQTlCOztBQWlCQSxJQUFNSyxNQUFNLEdBQUcsU0FBVEEsTUFBUyxDQUFBQyxDQUFDO0FBQUEsU0FBSUEsQ0FBSjtBQUFBLENBQWhCOztBQU1BLFNBQVNDLG1CQUFULENBQ0VDLE1BREYsRUFFc0M7QUFDcEMsTUFBSUEsTUFBTSxDQUFDQyxXQUFQLElBQXNCLE9BQU9ELE1BQU0sQ0FBQ0MsV0FBUCxDQUFtQixDQUFuQixDQUFQLEtBQWlDLFFBQTNELEVBQXFFO0FBQ25FLFdBQU9DLHdDQUF3QyxDQUFDRixNQUFELENBQS9DO0FBQ0Q7O0FBRUQsTUFBTUMsV0FBMEIsR0FBSUQsTUFBTSxDQUFDQyxXQUEzQztBQUNBRSxFQUFBQSxrQkFBa0IsQ0FBQyxhQUFELEVBQWdCRixXQUFoQixDQUFsQjtBQUVBLE1BQU1HLFVBQVUsR0FBR0osTUFBTSxDQUFDSSxVQUExQjtBQUNBRCxFQUFBQSxrQkFBa0IsQ0FBQyxZQUFELEVBQWVDLFVBQWYsQ0FBbEI7QUFDQUMsRUFBQUEsb0JBQW9CLENBQUNELFVBQUQsQ0FBcEI7QUFFQVQsRUFBQUEsU0FBUyxDQUNQUyxVQUFVLENBQUNFLE1BQVgsS0FBc0JMLFdBQVcsQ0FBQ0ssTUFEM0IsRUFFUCxpQkFDRUYsVUFBVSxDQUFDRSxNQURiLEdBRUUscUJBRkYsR0FHRUwsV0FBVyxDQUFDSyxNQUhkLEdBSUUsNkJBTkssQ0FBVDtBQVNBLE1BQU1DLE1BQU0sR0FBR1AsTUFBTSxDQUFDTyxNQUFQLElBQWlCVixNQUFoQztBQUVBLE1BQUlXLGVBQWdDLEdBQUcsUUFBdkM7O0FBQ0EsTUFBSVIsTUFBTSxDQUFDUSxlQUFQLEtBQTJCQyxTQUEvQixFQUEwQztBQUN4Q0QsSUFBQUEsZUFBZSxHQUFHUixNQUFNLENBQUNRLGVBQXpCO0FBQ0QsR0FGRCxNQUVPLElBQUlSLE1BQU0sQ0FBQ1UsV0FBUCxLQUF1QkQsU0FBM0IsRUFBc0M7QUFDM0NELElBQUFBLGVBQWUsR0FBR1IsTUFBTSxDQUFDVSxXQUF6QjtBQUNEOztBQUVELE1BQUlDLGdCQUFpQyxHQUFHLFFBQXhDOztBQUNBLE1BQUlYLE1BQU0sQ0FBQ1csZ0JBQVAsS0FBNEJGLFNBQWhDLEVBQTJDO0FBQ3pDRSxJQUFBQSxnQkFBZ0IsR0FBR1gsTUFBTSxDQUFDVyxnQkFBMUI7QUFDRCxHQUZELE1BRU8sSUFBSVgsTUFBTSxDQUFDVSxXQUFQLEtBQXVCRCxTQUEzQixFQUFzQztBQUMzQ0UsSUFBQUEsZ0JBQWdCLEdBQUdYLE1BQU0sQ0FBQ1UsV0FBMUI7QUFDRDs7QUFFRCxTQUFPLFVBQUFFLEtBQUssRUFBSTtBQUNkakIsSUFBQUEsU0FBUyxDQUNQLE9BQU9pQixLQUFQLEtBQWlCLFFBRFYsRUFFUCxxREFGTyxDQUFUO0FBS0EsUUFBTUMsS0FBSyxHQUFHQyxTQUFTLENBQUNGLEtBQUQsRUFBUVIsVUFBUixDQUF2QjtBQUNBLFdBQU9XLFdBQVcsQ0FDaEJILEtBRGdCLEVBRWhCUixVQUFVLENBQUNTLEtBQUQsQ0FGTSxFQUdoQlQsVUFBVSxDQUFDUyxLQUFLLEdBQUcsQ0FBVCxDQUhNLEVBSWhCWixXQUFXLENBQUNZLEtBQUQsQ0FKSyxFQUtoQlosV0FBVyxDQUFDWSxLQUFLLEdBQUcsQ0FBVCxDQUxLLEVBTWhCTixNQU5nQixFQU9oQkMsZUFQZ0IsRUFRaEJHLGdCQVJnQixDQUFsQjtBQVVELEdBakJEO0FBa0JEOztBQUVELFNBQVNJLFdBQVQsQ0FDRUgsS0FERixFQUVFSSxRQUZGLEVBR0VDLFFBSEYsRUFJRUMsU0FKRixFQUtFQyxTQUxGLEVBTUVaLE1BTkYsRUFPRUMsZUFQRixFQVFFRyxnQkFSRixFQVNFO0FBQ0EsTUFBSVMsTUFBTSxHQUFHUixLQUFiOztBQUdBLE1BQUlRLE1BQU0sR0FBR0osUUFBYixFQUF1QjtBQUNyQixRQUFJUixlQUFlLEtBQUssVUFBeEIsRUFBb0M7QUFDbEMsYUFBT1ksTUFBUDtBQUNELEtBRkQsTUFFTyxJQUFJWixlQUFlLEtBQUssT0FBeEIsRUFBaUM7QUFDdENZLE1BQUFBLE1BQU0sR0FBR0osUUFBVDtBQUNELEtBRk0sTUFFQSxJQUFJUixlQUFlLEtBQUssUUFBeEIsRUFBa0MsQ0FFeEM7QUFDRjs7QUFFRCxNQUFJWSxNQUFNLEdBQUdILFFBQWIsRUFBdUI7QUFDckIsUUFBSU4sZ0JBQWdCLEtBQUssVUFBekIsRUFBcUM7QUFDbkMsYUFBT1MsTUFBUDtBQUNELEtBRkQsTUFFTyxJQUFJVCxnQkFBZ0IsS0FBSyxPQUF6QixFQUFrQztBQUN2Q1MsTUFBQUEsTUFBTSxHQUFHSCxRQUFUO0FBQ0QsS0FGTSxNQUVBLElBQUlOLGdCQUFnQixLQUFLLFFBQXpCLEVBQW1DLENBRXpDO0FBQ0Y7O0FBRUQsTUFBSU8sU0FBUyxLQUFLQyxTQUFsQixFQUE2QjtBQUMzQixXQUFPRCxTQUFQO0FBQ0Q7O0FBRUQsTUFBSUYsUUFBUSxLQUFLQyxRQUFqQixFQUEyQjtBQUN6QixRQUFJTCxLQUFLLElBQUlJLFFBQWIsRUFBdUI7QUFDckIsYUFBT0UsU0FBUDtBQUNEOztBQUNELFdBQU9DLFNBQVA7QUFDRDs7QUFHRCxNQUFJSCxRQUFRLEtBQUssQ0FBQ0ssUUFBbEIsRUFBNEI7QUFDMUJELElBQUFBLE1BQU0sR0FBRyxDQUFDQSxNQUFWO0FBQ0QsR0FGRCxNQUVPLElBQUlILFFBQVEsS0FBS0ksUUFBakIsRUFBMkI7QUFDaENELElBQUFBLE1BQU0sR0FBR0EsTUFBTSxHQUFHSixRQUFsQjtBQUNELEdBRk0sTUFFQTtBQUNMSSxJQUFBQSxNQUFNLEdBQUcsQ0FBQ0EsTUFBTSxHQUFHSixRQUFWLEtBQXVCQyxRQUFRLEdBQUdELFFBQWxDLENBQVQ7QUFDRDs7QUFHREksRUFBQUEsTUFBTSxHQUFHYixNQUFNLENBQUNhLE1BQUQsQ0FBZjs7QUFHQSxNQUFJRixTQUFTLEtBQUssQ0FBQ0csUUFBbkIsRUFBNkI7QUFDM0JELElBQUFBLE1BQU0sR0FBRyxDQUFDQSxNQUFWO0FBQ0QsR0FGRCxNQUVPLElBQUlELFNBQVMsS0FBS0UsUUFBbEIsRUFBNEI7QUFDakNELElBQUFBLE1BQU0sR0FBR0EsTUFBTSxHQUFHRixTQUFsQjtBQUNELEdBRk0sTUFFQTtBQUNMRSxJQUFBQSxNQUFNLEdBQUdBLE1BQU0sSUFBSUQsU0FBUyxHQUFHRCxTQUFoQixDQUFOLEdBQW1DQSxTQUE1QztBQUNEOztBQUVELFNBQU9FLE1BQVA7QUFDRDs7QUFFRCxTQUFTRSxXQUFULENBQXFCVixLQUFyQixFQUE0QztBQUMxQyxNQUFJVyxVQUFVLEdBQUczQixjQUFjLENBQUNnQixLQUFELENBQS9COztBQUNBLE1BQUlXLFVBQVUsS0FBSyxJQUFuQixFQUF5QjtBQUN2QixXQUFPWCxLQUFQO0FBQ0Q7O0FBRURXLEVBQUFBLFVBQVUsR0FBR0EsVUFBVSxJQUFJLENBQTNCO0FBRUEsTUFBTUMsQ0FBQyxHQUFHLENBQUNELFVBQVUsR0FBRyxVQUFkLE1BQThCLEVBQXhDO0FBQ0EsTUFBTUUsQ0FBQyxHQUFHLENBQUNGLFVBQVUsR0FBRyxVQUFkLE1BQThCLEVBQXhDO0FBQ0EsTUFBTUcsQ0FBQyxHQUFHLENBQUNILFVBQVUsR0FBRyxVQUFkLE1BQThCLENBQXhDO0FBQ0EsTUFBTUksQ0FBQyxHQUFHLENBQUNKLFVBQVUsR0FBRyxVQUFkLElBQTRCLEdBQXRDO0FBRUEsbUJBQWVDLENBQWYsVUFBcUJDLENBQXJCLFVBQTJCQyxDQUEzQixVQUFpQ0MsQ0FBakM7QUFDRDs7QUFFRCxJQUFNQyxnQkFBZ0IsR0FBRyw0Q0FBekI7O0FBVUEsU0FBUzFCLHdDQUFULENBQ0VGLE1BREYsRUFFNkI7QUFDM0IsTUFBSUMsV0FBMEIsR0FBSUQsTUFBTSxDQUFDQyxXQUF6QztBQUNBTixFQUFBQSxTQUFTLENBQUNNLFdBQVcsQ0FBQ0ssTUFBWixJQUFzQixDQUF2QixFQUEwQixrQkFBMUIsQ0FBVDtBQUNBTCxFQUFBQSxXQUFXLEdBQUdBLFdBQVcsQ0FBQzRCLEdBQVosQ0FBZ0JQLFdBQWhCLENBQWQ7QUFDQVEsRUFBQUEsWUFBWSxDQUFDN0IsV0FBRCxDQUFaO0FBYUEsTUFBTThCLFlBQVksR0FBRzlCLFdBQVcsQ0FBQyxDQUFELENBQVgsQ0FBZStCLEtBQWYsQ0FBcUJKLGdCQUFyQixFQUF1Q0MsR0FBdkMsQ0FBMkM7QUFBQSxXQUFNLEVBQU47QUFBQSxHQUEzQyxDQUFyQjtBQUNBNUIsRUFBQUEsV0FBVyxDQUFDZ0MsT0FBWixDQUFvQixVQUFBQyxLQUFLLEVBQUk7QUFJM0JBLElBQUFBLEtBQUssQ0FBQ0YsS0FBTixDQUFZSixnQkFBWixFQUE4QkssT0FBOUIsQ0FBc0MsVUFBQ0UsTUFBRCxFQUFTQyxDQUFULEVBQWU7QUFDbkRMLE1BQUFBLFlBQVksQ0FBQ0ssQ0FBRCxDQUFaLENBQWdCQyxJQUFoQixDQUFxQixDQUFDRixNQUF0QjtBQUNELEtBRkQ7QUFHRCxHQVBEO0FBWUEsTUFBTUcsY0FBYyxHQUFHckMsV0FBVyxDQUFDLENBQUQsQ0FBWCxDQUNwQitCLEtBRG9CLENBQ2RKLGdCQURjLEVBRXBCQyxHQUZvQixDQUVoQixVQUFDSyxLQUFELEVBQVFFLENBQVIsRUFBYztBQUNqQixXQUFPckMsbUJBQW1CLG1CQUNyQkMsTUFEcUI7QUFFeEJDLE1BQUFBLFdBQVcsRUFBRThCLFlBQVksQ0FBQ0ssQ0FBRDtBQUZELE9BQTFCO0FBSUQsR0FQb0IsQ0FBdkI7QUFXQSxNQUFNRyxXQUFXLEdBQUdDLFdBQVcsQ0FBQ3ZDLFdBQVcsQ0FBQyxDQUFELENBQVosQ0FBL0I7QUFFQSxTQUFPLFVBQUFXLEtBQUssRUFBSTtBQUNkLFFBQUl3QixDQUFDLEdBQUcsQ0FBUjtBQUlBLFdBQU9uQyxXQUFXLENBQUMsQ0FBRCxDQUFYLENBQWV3QyxPQUFmLENBQXVCYixnQkFBdkIsRUFBeUMsWUFBTTtBQUNwRCxVQUFJYyxHQUFHLEdBQUcsQ0FBQ0osY0FBYyxDQUFDRixDQUFDLEVBQUYsQ0FBZCxDQUFvQnhCLEtBQXBCLENBQVg7O0FBQ0EsVUFBSTJCLFdBQUosRUFBaUI7QUFDZkcsUUFBQUEsR0FBRyxHQUFHTixDQUFDLEdBQUcsQ0FBSixHQUFRTyxJQUFJLENBQUNDLEtBQUwsQ0FBV0YsR0FBWCxDQUFSLEdBQTBCQyxJQUFJLENBQUNDLEtBQUwsQ0FBV0YsR0FBRyxHQUFHLElBQWpCLElBQXlCLElBQXpEO0FBQ0Q7O0FBQ0QsYUFBT0csTUFBTSxDQUFDSCxHQUFELENBQWI7QUFDRCxLQU5NLENBQVA7QUFPRCxHQVpEO0FBYUQ7O0FBRUQsU0FBU0YsV0FBVCxDQUFxQjNCLEtBQXJCLEVBQTRCO0FBQzFCLFNBQU8sT0FBT0EsS0FBUCxLQUFpQixRQUFqQixJQUE2QkEsS0FBSyxDQUFDaUMsVUFBTixDQUFpQixLQUFqQixDQUFwQztBQUNEOztBQUVELFNBQVNoQixZQUFULENBQXNCaUIsR0FBdEIsRUFBMEM7QUFDeEMsTUFBTUMsT0FBTyxHQUFHRCxHQUFHLENBQUMsQ0FBRCxDQUFILENBQU9OLE9BQVAsQ0FBZWIsZ0JBQWYsRUFBaUMsRUFBakMsQ0FBaEI7O0FBQ0EsT0FBSyxJQUFJUSxDQUFDLEdBQUcsQ0FBYixFQUFnQkEsQ0FBQyxHQUFHVyxHQUFHLENBQUN6QyxNQUF4QixFQUFnQyxFQUFFOEIsQ0FBbEMsRUFBcUM7QUFDbkN6QyxJQUFBQSxTQUFTLENBQ1BxRCxPQUFPLEtBQUtELEdBQUcsQ0FBQ1gsQ0FBRCxDQUFILENBQU9LLE9BQVAsQ0FBZWIsZ0JBQWYsRUFBaUMsRUFBakMsQ0FETCxFQUVQLHFCQUFxQm1CLEdBQUcsQ0FBQyxDQUFELENBQXhCLEdBQThCLE9BQTlCLEdBQXdDQSxHQUFHLENBQUNYLENBQUQsQ0FGcEMsQ0FBVDtBQUlEO0FBQ0Y7O0FBRUQsU0FBU3RCLFNBQVQsQ0FBbUJGLEtBQW5CLEVBQWtDUixVQUFsQyxFQUE2RDtBQUMzRCxNQUFJZ0MsQ0FBSjs7QUFDQSxPQUFLQSxDQUFDLEdBQUcsQ0FBVCxFQUFZQSxDQUFDLEdBQUdoQyxVQUFVLENBQUNFLE1BQVgsR0FBb0IsQ0FBcEMsRUFBdUMsRUFBRThCLENBQXpDLEVBQTRDO0FBQzFDLFFBQUloQyxVQUFVLENBQUNnQyxDQUFELENBQVYsSUFBaUJ4QixLQUFyQixFQUE0QjtBQUMxQjtBQUNEO0FBQ0Y7O0FBQ0QsU0FBT3dCLENBQUMsR0FBRyxDQUFYO0FBQ0Q7O0FBRUQsU0FBUy9CLG9CQUFULENBQThCMEMsR0FBOUIsRUFBa0Q7QUFDaERwRCxFQUFBQSxTQUFTLENBQUNvRCxHQUFHLENBQUN6QyxNQUFKLElBQWMsQ0FBZixFQUFrQiwwQ0FBbEIsQ0FBVDs7QUFDQSxPQUFLLElBQUk4QixDQUFDLEdBQUcsQ0FBYixFQUFnQkEsQ0FBQyxHQUFHVyxHQUFHLENBQUN6QyxNQUF4QixFQUFnQyxFQUFFOEIsQ0FBbEMsRUFBcUM7QUFDbkN6QyxJQUFBQSxTQUFTLENBQ1BvRCxHQUFHLENBQUNYLENBQUQsQ0FBSCxJQUFVVyxHQUFHLENBQUNYLENBQUMsR0FBRyxDQUFMLENBRE4sRUFRUCxxREFBcURXLEdBUjlDLENBQVQ7QUFVRDtBQUNGOztBQUVELFNBQVM1QyxrQkFBVCxDQUE0QjhDLElBQTVCLEVBQTBDRixHQUExQyxFQUE4RDtBQUM1RHBELEVBQUFBLFNBQVMsQ0FBQ29ELEdBQUcsQ0FBQ3pDLE1BQUosSUFBYyxDQUFmLEVBQWtCMkMsSUFBSSxHQUFHLGdDQUF6QixDQUFUO0FBQ0F0RCxFQUFBQSxTQUFTLENBQ1BvRCxHQUFHLENBQUN6QyxNQUFKLEtBQWUsQ0FBZixJQUFvQnlDLEdBQUcsQ0FBQyxDQUFELENBQUgsS0FBVyxDQUFDMUIsUUFBaEMsSUFBNEMwQixHQUFHLENBQUMsQ0FBRCxDQUFILEtBQVcxQixRQURoRCxFQVFQNEIsSUFBSSxHQUFHLGtDQUFQLEdBQTRDRixHQVJyQyxDQUFUO0FBVUQ7O0lBRUtHLHFCOzs7QUFVSixpQ0FBWUMsTUFBWixFQUFrQ25ELE1BQWxDLEVBQW1FO0FBQUE7O0FBQUE7QUFDakU7QUFEaUUsVUFKbkVvRCxPQUltRTtBQUFBLFVBSG5FQyxPQUdtRTtBQUFBLFVBRm5FQyxjQUVtRTtBQUVqRSxVQUFLRixPQUFMLEdBQWVELE1BQWY7QUFDQSxVQUFLRSxPQUFMLEdBQWVyRCxNQUFmO0FBQ0EsVUFBS3NELGNBQUwsR0FBc0J2RCxtQkFBbUIsQ0FBQ0MsTUFBRCxDQUF6QztBQUppRTtBQUtsRTs7OzttQ0FFYztBQUNiLFdBQUtvRCxPQUFMLENBQWFHLFlBQWI7O0FBQ0E7QUFDRDs7O2lDQUU2QjtBQUM1QixVQUFNQyxXQUFtQixHQUFHLEtBQUtKLE9BQUwsQ0FBYUssVUFBYixFQUE1Qjs7QUFDQTlELE1BQUFBLFNBQVMsQ0FDUCxPQUFPNkQsV0FBUCxLQUF1QixRQURoQixFQUVQLG9EQUZPLENBQVQ7QUFJQSxhQUFPLEtBQUtGLGNBQUwsQ0FBb0JFLFdBQXBCLENBQVA7QUFDRDs7O2dDQUVXeEQsTSxFQUF3RDtBQUNsRSxhQUFPLElBQUlrRCxxQkFBSixDQUEwQixJQUExQixFQUFnQ2xELE1BQWhDLENBQVA7QUFDRDs7OytCQUVnQjtBQUNmLFdBQUtvRCxPQUFMLENBQWFNLFVBQWIsQ0FBd0IsSUFBeEI7QUFDRDs7OytCQUVnQjtBQUNmLFdBQUtOLE9BQUwsQ0FBYU8sYUFBYixDQUEyQixJQUEzQjs7QUFDQTtBQUNEOzs7d0NBRW1COUMsSyxFQUErQjtBQUNqRCxhQUFPQSxLQUFLLENBQUNnQixHQUFOLENBQVVuQyxvQkFBb0IsQ0FBQ2tFLGlCQUEvQixDQUFQO0FBQ0Q7Ozt3Q0FFd0I7QUFDdkIsVUFBSUMsT0FBSixFQUFhO0FBQ1huRSxRQUFBQSxvQkFBb0IsQ0FBQ29FLHFCQUFyQixDQUEyQyxLQUFLVCxPQUFoRDtBQUNEOztBQUVELGFBQU87QUFDTGpELFFBQUFBLFVBQVUsRUFBRSxLQUFLaUQsT0FBTCxDQUFhakQsVUFEcEI7QUFHTEgsUUFBQUEsV0FBVyxFQUFFLEtBQUs4RCxtQkFBTCxDQUF5QixLQUFLVixPQUFMLENBQWFwRCxXQUF0QyxDQUhSO0FBSUxPLFFBQUFBLGVBQWUsRUFDYixLQUFLNkMsT0FBTCxDQUFhN0MsZUFBYixJQUFnQyxLQUFLNkMsT0FBTCxDQUFhM0MsV0FBN0MsSUFBNEQsUUFMekQ7QUFNTEMsUUFBQUEsZ0JBQWdCLEVBQ2QsS0FBSzBDLE9BQUwsQ0FBYTFDLGdCQUFiLElBQWlDLEtBQUswQyxPQUFMLENBQWEzQyxXQUE5QyxJQUE2RCxRQVAxRDtBQVFMc0QsUUFBQUEsSUFBSSxFQUFFO0FBUkQsT0FBUDtBQVVEOzs7RUEvRGlDdkUsb0I7O0FBQTlCeUQscUIsQ0FFR2UscUIsR0FFbUNsRSxtQjtBQThENUNtRSxNQUFNLENBQUNDLE9BQVAsR0FBaUJqQixxQkFBakIiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIENvcHlyaWdodCAoYykgRmFjZWJvb2ssIEluYy4gYW5kIGl0cyBhZmZpbGlhdGVzLlxuICpcbiAqIFRoaXMgc291cmNlIGNvZGUgaXMgbGljZW5zZWQgdW5kZXIgdGhlIE1JVCBsaWNlbnNlIGZvdW5kIGluIHRoZVxuICogTElDRU5TRSBmaWxlIGluIHRoZSByb290IGRpcmVjdG9yeSBvZiB0aGlzIHNvdXJjZSB0cmVlLlxuICpcbiAqIEBmbG93XG4gKiBAZm9ybWF0XG4gKi9cbi8qIGVzbGludCBuby1iaXR3aXNlOiAwICovXG4ndXNlIHN0cmljdCc7XG5cbmNvbnN0IEFuaW1hdGVkTm9kZSA9IHJlcXVpcmUoJy4vQW5pbWF0ZWROb2RlJyk7XG5jb25zdCBBbmltYXRlZFdpdGhDaGlsZHJlbiA9IHJlcXVpcmUoJy4vQW5pbWF0ZWRXaXRoQ2hpbGRyZW4nKTtcbmNvbnN0IE5hdGl2ZUFuaW1hdGVkSGVscGVyID0gcmVxdWlyZSgnLi4vTmF0aXZlQW5pbWF0ZWRIZWxwZXInKTtcblxuY29uc3QgaW52YXJpYW50ID0gcmVxdWlyZSgnaW52YXJpYW50Jyk7XG5jb25zdCBub3JtYWxpemVDb2xvciA9IHJlcXVpcmUoJy4uLy4uLy4uL0NvbG9yL25vcm1hbGl6ZUNvbG9yJyk7XG5cbnR5cGUgRXh0cmFwb2xhdGVUeXBlID0gJ2V4dGVuZCcgfCAnaWRlbnRpdHknIHwgJ2NsYW1wJztcblxuZXhwb3J0IHR5cGUgSW50ZXJwb2xhdGlvbkNvbmZpZ1R5cGUgPSB7XG4gIGlucHV0UmFuZ2U6IEFycmF5PG51bWJlcj4sXG4gIC8qICRGbG93Rml4TWUoPj0wLjM4LjAgc2l0ZT1yZWFjdF9uYXRpdmVfZmIscmVhY3RfbmF0aXZlX29zcykgLSBGbG93IGVycm9yXG4gICAqIGRldGVjdGVkIGR1cmluZyB0aGUgZGVwbG95bWVudCBvZiB2MC4zOC4wLiBUbyBzZWUgdGhlIGVycm9yLCByZW1vdmUgdGhpc1xuICAgKiBjb21tZW50IGFuZCBydW4gZmxvd1xuICAgKi9cbiAgb3V0cHV0UmFuZ2U6IEFycmF5PG51bWJlcj4gfCBBcnJheTxzdHJpbmc+LFxuICBlYXNpbmc/OiAoaW5wdXQ6IG51bWJlcikgPT4gbnVtYmVyLFxuICBleHRyYXBvbGF0ZT86IEV4dHJhcG9sYXRlVHlwZSxcbiAgZXh0cmFwb2xhdGVMZWZ0PzogRXh0cmFwb2xhdGVUeXBlLFxuICBleHRyYXBvbGF0ZVJpZ2h0PzogRXh0cmFwb2xhdGVUeXBlLFxufTtcblxuY29uc3QgbGluZWFyID0gdCA9PiB0O1xuXG4vKipcbiAqIFZlcnkgaGFuZHkgaGVscGVyIHRvIG1hcCBpbnB1dCByYW5nZXMgdG8gb3V0cHV0IHJhbmdlcyB3aXRoIGFuIGVhc2luZ1xuICogZnVuY3Rpb24gYW5kIGN1c3RvbSBiZWhhdmlvciBvdXRzaWRlIG9mIHRoZSByYW5nZXMuXG4gKi9cbmZ1bmN0aW9uIGNyZWF0ZUludGVycG9sYXRpb24oXG4gIGNvbmZpZzogSW50ZXJwb2xhdGlvbkNvbmZpZ1R5cGUsXG4pOiAoaW5wdXQ6IG51bWJlcikgPT4gbnVtYmVyIHwgc3RyaW5nIHtcbiAgaWYgKGNvbmZpZy5vdXRwdXRSYW5nZSAmJiB0eXBlb2YgY29uZmlnLm91dHB1dFJhbmdlWzBdID09PSAnc3RyaW5nJykge1xuICAgIHJldHVybiBjcmVhdGVJbnRlcnBvbGF0aW9uRnJvbVN0cmluZ091dHB1dFJhbmdlKGNvbmZpZyk7XG4gIH1cblxuICBjb25zdCBvdXRwdXRSYW5nZTogQXJyYXk8bnVtYmVyPiA9IChjb25maWcub3V0cHV0UmFuZ2U6IGFueSk7XG4gIGNoZWNrSW5maW5pdGVSYW5nZSgnb3V0cHV0UmFuZ2UnLCBvdXRwdXRSYW5nZSk7XG5cbiAgY29uc3QgaW5wdXRSYW5nZSA9IGNvbmZpZy5pbnB1dFJhbmdlO1xuICBjaGVja0luZmluaXRlUmFuZ2UoJ2lucHV0UmFuZ2UnLCBpbnB1dFJhbmdlKTtcbiAgY2hlY2tWYWxpZElucHV0UmFuZ2UoaW5wdXRSYW5nZSk7XG5cbiAgaW52YXJpYW50KFxuICAgIGlucHV0UmFuZ2UubGVuZ3RoID09PSBvdXRwdXRSYW5nZS5sZW5ndGgsXG4gICAgJ2lucHV0UmFuZ2UgKCcgK1xuICAgICAgaW5wdXRSYW5nZS5sZW5ndGggK1xuICAgICAgJykgYW5kIG91dHB1dFJhbmdlICgnICtcbiAgICAgIG91dHB1dFJhbmdlLmxlbmd0aCArXG4gICAgICAnKSBtdXN0IGhhdmUgdGhlIHNhbWUgbGVuZ3RoJyxcbiAgKTtcblxuICBjb25zdCBlYXNpbmcgPSBjb25maWcuZWFzaW5nIHx8IGxpbmVhcjtcblxuICBsZXQgZXh0cmFwb2xhdGVMZWZ0OiBFeHRyYXBvbGF0ZVR5cGUgPSAnZXh0ZW5kJztcbiAgaWYgKGNvbmZpZy5leHRyYXBvbGF0ZUxlZnQgIT09IHVuZGVmaW5lZCkge1xuICAgIGV4dHJhcG9sYXRlTGVmdCA9IGNvbmZpZy5leHRyYXBvbGF0ZUxlZnQ7XG4gIH0gZWxzZSBpZiAoY29uZmlnLmV4dHJhcG9sYXRlICE9PSB1bmRlZmluZWQpIHtcbiAgICBleHRyYXBvbGF0ZUxlZnQgPSBjb25maWcuZXh0cmFwb2xhdGU7XG4gIH1cblxuICBsZXQgZXh0cmFwb2xhdGVSaWdodDogRXh0cmFwb2xhdGVUeXBlID0gJ2V4dGVuZCc7XG4gIGlmIChjb25maWcuZXh0cmFwb2xhdGVSaWdodCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgZXh0cmFwb2xhdGVSaWdodCA9IGNvbmZpZy5leHRyYXBvbGF0ZVJpZ2h0O1xuICB9IGVsc2UgaWYgKGNvbmZpZy5leHRyYXBvbGF0ZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgZXh0cmFwb2xhdGVSaWdodCA9IGNvbmZpZy5leHRyYXBvbGF0ZTtcbiAgfVxuXG4gIHJldHVybiBpbnB1dCA9PiB7XG4gICAgaW52YXJpYW50KFxuICAgICAgdHlwZW9mIGlucHV0ID09PSAnbnVtYmVyJyxcbiAgICAgICdDYW5ub3QgaW50ZXJwb2xhdGlvbiBhbiBpbnB1dCB3aGljaCBpcyBub3QgYSBudW1iZXInLFxuICAgICk7XG5cbiAgICBjb25zdCByYW5nZSA9IGZpbmRSYW5nZShpbnB1dCwgaW5wdXRSYW5nZSk7XG4gICAgcmV0dXJuIGludGVycG9sYXRlKFxuICAgICAgaW5wdXQsXG4gICAgICBpbnB1dFJhbmdlW3JhbmdlXSxcbiAgICAgIGlucHV0UmFuZ2VbcmFuZ2UgKyAxXSxcbiAgICAgIG91dHB1dFJhbmdlW3JhbmdlXSxcbiAgICAgIG91dHB1dFJhbmdlW3JhbmdlICsgMV0sXG4gICAgICBlYXNpbmcsXG4gICAgICBleHRyYXBvbGF0ZUxlZnQsXG4gICAgICBleHRyYXBvbGF0ZVJpZ2h0LFxuICAgICk7XG4gIH07XG59XG5cbmZ1bmN0aW9uIGludGVycG9sYXRlKFxuICBpbnB1dDogbnVtYmVyLFxuICBpbnB1dE1pbjogbnVtYmVyLFxuICBpbnB1dE1heDogbnVtYmVyLFxuICBvdXRwdXRNaW46IG51bWJlcixcbiAgb3V0cHV0TWF4OiBudW1iZXIsXG4gIGVhc2luZzogKGlucHV0OiBudW1iZXIpID0+IG51bWJlcixcbiAgZXh0cmFwb2xhdGVMZWZ0OiBFeHRyYXBvbGF0ZVR5cGUsXG4gIGV4dHJhcG9sYXRlUmlnaHQ6IEV4dHJhcG9sYXRlVHlwZSxcbikge1xuICBsZXQgcmVzdWx0ID0gaW5wdXQ7XG5cbiAgLy8gRXh0cmFwb2xhdGVcbiAgaWYgKHJlc3VsdCA8IGlucHV0TWluKSB7XG4gICAgaWYgKGV4dHJhcG9sYXRlTGVmdCA9PT0gJ2lkZW50aXR5Jykge1xuICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9IGVsc2UgaWYgKGV4dHJhcG9sYXRlTGVmdCA9PT0gJ2NsYW1wJykge1xuICAgICAgcmVzdWx0ID0gaW5wdXRNaW47XG4gICAgfSBlbHNlIGlmIChleHRyYXBvbGF0ZUxlZnQgPT09ICdleHRlbmQnKSB7XG4gICAgICAvLyBub29wXG4gICAgfVxuICB9XG5cbiAgaWYgKHJlc3VsdCA+IGlucHV0TWF4KSB7XG4gICAgaWYgKGV4dHJhcG9sYXRlUmlnaHQgPT09ICdpZGVudGl0eScpIHtcbiAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfSBlbHNlIGlmIChleHRyYXBvbGF0ZVJpZ2h0ID09PSAnY2xhbXAnKSB7XG4gICAgICByZXN1bHQgPSBpbnB1dE1heDtcbiAgICB9IGVsc2UgaWYgKGV4dHJhcG9sYXRlUmlnaHQgPT09ICdleHRlbmQnKSB7XG4gICAgICAvLyBub29wXG4gICAgfVxuICB9XG5cbiAgaWYgKG91dHB1dE1pbiA9PT0gb3V0cHV0TWF4KSB7XG4gICAgcmV0dXJuIG91dHB1dE1pbjtcbiAgfVxuXG4gIGlmIChpbnB1dE1pbiA9PT0gaW5wdXRNYXgpIHtcbiAgICBpZiAoaW5wdXQgPD0gaW5wdXRNaW4pIHtcbiAgICAgIHJldHVybiBvdXRwdXRNaW47XG4gICAgfVxuICAgIHJldHVybiBvdXRwdXRNYXg7XG4gIH1cblxuICAvLyBJbnB1dCBSYW5nZVxuICBpZiAoaW5wdXRNaW4gPT09IC1JbmZpbml0eSkge1xuICAgIHJlc3VsdCA9IC1yZXN1bHQ7XG4gIH0gZWxzZSBpZiAoaW5wdXRNYXggPT09IEluZmluaXR5KSB7XG4gICAgcmVzdWx0ID0gcmVzdWx0IC0gaW5wdXRNaW47XG4gIH0gZWxzZSB7XG4gICAgcmVzdWx0ID0gKHJlc3VsdCAtIGlucHV0TWluKSAvIChpbnB1dE1heCAtIGlucHV0TWluKTtcbiAgfVxuXG4gIC8vIEVhc2luZ1xuICByZXN1bHQgPSBlYXNpbmcocmVzdWx0KTtcblxuICAvLyBPdXRwdXQgUmFuZ2VcbiAgaWYgKG91dHB1dE1pbiA9PT0gLUluZmluaXR5KSB7XG4gICAgcmVzdWx0ID0gLXJlc3VsdDtcbiAgfSBlbHNlIGlmIChvdXRwdXRNYXggPT09IEluZmluaXR5KSB7XG4gICAgcmVzdWx0ID0gcmVzdWx0ICsgb3V0cHV0TWluO1xuICB9IGVsc2Uge1xuICAgIHJlc3VsdCA9IHJlc3VsdCAqIChvdXRwdXRNYXggLSBvdXRwdXRNaW4pICsgb3V0cHV0TWluO1xuICB9XG5cbiAgcmV0dXJuIHJlc3VsdDtcbn1cblxuZnVuY3Rpb24gY29sb3JUb1JnYmEoaW5wdXQ6IHN0cmluZyk6IHN0cmluZyB7XG4gIGxldCBpbnQzMkNvbG9yID0gbm9ybWFsaXplQ29sb3IoaW5wdXQpO1xuICBpZiAoaW50MzJDb2xvciA9PT0gbnVsbCkge1xuICAgIHJldHVybiBpbnB1dDtcbiAgfVxuXG4gIGludDMyQ29sb3IgPSBpbnQzMkNvbG9yIHx8IDA7XG5cbiAgY29uc3QgciA9IChpbnQzMkNvbG9yICYgMHhmZjAwMDAwMCkgPj4+IDI0O1xuICBjb25zdCBnID0gKGludDMyQ29sb3IgJiAweDAwZmYwMDAwKSA+Pj4gMTY7XG4gIGNvbnN0IGIgPSAoaW50MzJDb2xvciAmIDB4MDAwMGZmMDApID4+PiA4O1xuICBjb25zdCBhID0gKGludDMyQ29sb3IgJiAweDAwMDAwMGZmKSAvIDI1NTtcblxuICByZXR1cm4gYHJnYmEoJHtyfSwgJHtnfSwgJHtifSwgJHthfSlgO1xufVxuXG5jb25zdCBzdHJpbmdTaGFwZVJlZ2V4ID0gL1srLV0/KD86XFxkK1xcLj9cXGQqfFxcLlxcZCspKD86W2VFXVsrLV0/XFxkKyk/L2c7XG5cbi8qKlxuICogU3VwcG9ydHMgc3RyaW5nIHNoYXBlcyBieSBleHRyYWN0aW5nIG51bWJlcnMgc28gbmV3IHZhbHVlcyBjYW4gYmUgY29tcHV0ZWQsXG4gKiBhbmQgcmVjb21iaW5lcyB0aG9zZSB2YWx1ZXMgaW50byBuZXcgc3RyaW5ncyBvZiB0aGUgc2FtZSBzaGFwZS4gIFN1cHBvcnRzXG4gKiB0aGluZ3MgbGlrZTpcbiAqXG4gKiAgIHJnYmEoMTIzLCA0MiwgOTksIDAuMzYpIC8vIGNvbG9yc1xuICogICAtNDVkZWcgICAgICAgICAgICAgICAgICAvLyB2YWx1ZXMgd2l0aCB1bml0c1xuICovXG5mdW5jdGlvbiBjcmVhdGVJbnRlcnBvbGF0aW9uRnJvbVN0cmluZ091dHB1dFJhbmdlKFxuICBjb25maWc6IEludGVycG9sYXRpb25Db25maWdUeXBlLFxuKTogKGlucHV0OiBudW1iZXIpID0+IHN0cmluZyB7XG4gIGxldCBvdXRwdXRSYW5nZTogQXJyYXk8c3RyaW5nPiA9IChjb25maWcub3V0cHV0UmFuZ2U6IGFueSk7XG4gIGludmFyaWFudChvdXRwdXRSYW5nZS5sZW5ndGggPj0gMiwgJ0JhZCBvdXRwdXQgcmFuZ2UnKTtcbiAgb3V0cHV0UmFuZ2UgPSBvdXRwdXRSYW5nZS5tYXAoY29sb3JUb1JnYmEpO1xuICBjaGVja1BhdHRlcm4ob3V0cHV0UmFuZ2UpO1xuXG4gIC8vIFsncmdiYSgwLCAxMDAsIDIwMCwgMCknLCAncmdiYSg1MCwgMTUwLCAyNTAsIDAuNSknXVxuICAvLyAtPlxuICAvLyBbXG4gIC8vICAgWzAsIDUwXSxcbiAgLy8gICBbMTAwLCAxNTBdLFxuICAvLyAgIFsyMDAsIDI1MF0sXG4gIC8vICAgWzAsIDAuNV0sXG4gIC8vIF1cbiAgLyogJEZsb3dGaXhNZSg+PTAuMTguMCk6IGBvdXRwdXRSYW5nZVswXS5tYXRjaCgpYCBjYW4gcmV0dXJuIGBudWxsYC4gTmVlZCB0b1xuICAgKiBndWFyZCBhZ2FpbnN0IHRoaXMgcG9zc2liaWxpdHkuXG4gICAqL1xuICBjb25zdCBvdXRwdXRSYW5nZXMgPSBvdXRwdXRSYW5nZVswXS5tYXRjaChzdHJpbmdTaGFwZVJlZ2V4KS5tYXAoKCkgPT4gW10pO1xuICBvdXRwdXRSYW5nZS5mb3JFYWNoKHZhbHVlID0+IHtcbiAgICAvKiAkRmxvd0ZpeE1lKD49MC4xOC4wKTogYHZhbHVlLm1hdGNoKClgIGNhbiByZXR1cm4gYG51bGxgLiBOZWVkIHRvIGd1YXJkXG4gICAgICogYWdhaW5zdCB0aGlzIHBvc3NpYmlsaXR5LlxuICAgICAqL1xuICAgIHZhbHVlLm1hdGNoKHN0cmluZ1NoYXBlUmVnZXgpLmZvckVhY2goKG51bWJlciwgaSkgPT4ge1xuICAgICAgb3V0cHV0UmFuZ2VzW2ldLnB1c2goK251bWJlcik7XG4gICAgfSk7XG4gIH0pO1xuXG4gIC8qICRGbG93Rml4TWUoPj0wLjE4LjApOiBgb3V0cHV0UmFuZ2VbMF0ubWF0Y2goKWAgY2FuIHJldHVybiBgbnVsbGAuIE5lZWQgdG9cbiAgICogZ3VhcmQgYWdhaW5zdCB0aGlzIHBvc3NpYmlsaXR5LlxuICAgKi9cbiAgY29uc3QgaW50ZXJwb2xhdGlvbnMgPSBvdXRwdXRSYW5nZVswXVxuICAgIC5tYXRjaChzdHJpbmdTaGFwZVJlZ2V4KVxuICAgIC5tYXAoKHZhbHVlLCBpKSA9PiB7XG4gICAgICByZXR1cm4gY3JlYXRlSW50ZXJwb2xhdGlvbih7XG4gICAgICAgIC4uLmNvbmZpZyxcbiAgICAgICAgb3V0cHV0UmFuZ2U6IG91dHB1dFJhbmdlc1tpXSxcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gIC8vIHJnYmEgcmVxdWlyZXMgdGhhdCB0aGUgcixnLGIgYXJlIGludGVnZXJzLi4uLiBzbyB3ZSB3YW50IHRvIHJvdW5kIHRoZW0sIGJ1dCB3ZSAqZG9udCogd2FudCB0b1xuICAvLyByb3VuZCB0aGUgb3BhY2l0eSAoNHRoIGNvbHVtbikuXG4gIGNvbnN0IHNob3VsZFJvdW5kID0gaXNSZ2JPclJnYmEob3V0cHV0UmFuZ2VbMF0pO1xuXG4gIHJldHVybiBpbnB1dCA9PiB7XG4gICAgbGV0IGkgPSAwO1xuICAgIC8vICdyZ2JhKDAsIDEwMCwgMjAwLCAwKSdcbiAgICAvLyAtPlxuICAgIC8vICdyZ2JhKCR7aW50ZXJwb2xhdGlvbnNbMF0oaW5wdXQpfSwgJHtpbnRlcnBvbGF0aW9uc1sxXShpbnB1dCl9LCAuLi4nXG4gICAgcmV0dXJuIG91dHB1dFJhbmdlWzBdLnJlcGxhY2Uoc3RyaW5nU2hhcGVSZWdleCwgKCkgPT4ge1xuICAgICAgbGV0IHZhbCA9ICtpbnRlcnBvbGF0aW9uc1tpKytdKGlucHV0KTtcbiAgICAgIGlmIChzaG91bGRSb3VuZCkge1xuICAgICAgICB2YWwgPSBpIDwgNCA/IE1hdGgucm91bmQodmFsKSA6IE1hdGgucm91bmQodmFsICogMTAwMCkgLyAxMDAwO1xuICAgICAgfVxuICAgICAgcmV0dXJuIFN0cmluZyh2YWwpO1xuICAgIH0pO1xuICB9O1xufVxuXG5mdW5jdGlvbiBpc1JnYk9yUmdiYShyYW5nZSkge1xuICByZXR1cm4gdHlwZW9mIHJhbmdlID09PSAnc3RyaW5nJyAmJiByYW5nZS5zdGFydHNXaXRoKCdyZ2InKTtcbn1cblxuZnVuY3Rpb24gY2hlY2tQYXR0ZXJuKGFycjogQXJyYXk8c3RyaW5nPikge1xuICBjb25zdCBwYXR0ZXJuID0gYXJyWzBdLnJlcGxhY2Uoc3RyaW5nU2hhcGVSZWdleCwgJycpO1xuICBmb3IgKGxldCBpID0gMTsgaSA8IGFyci5sZW5ndGg7ICsraSkge1xuICAgIGludmFyaWFudChcbiAgICAgIHBhdHRlcm4gPT09IGFycltpXS5yZXBsYWNlKHN0cmluZ1NoYXBlUmVnZXgsICcnKSxcbiAgICAgICdpbnZhbGlkIHBhdHRlcm4gJyArIGFyclswXSArICcgYW5kICcgKyBhcnJbaV0sXG4gICAgKTtcbiAgfVxufVxuXG5mdW5jdGlvbiBmaW5kUmFuZ2UoaW5wdXQ6IG51bWJlciwgaW5wdXRSYW5nZTogQXJyYXk8bnVtYmVyPikge1xuICBsZXQgaTtcbiAgZm9yIChpID0gMTsgaSA8IGlucHV0UmFuZ2UubGVuZ3RoIC0gMTsgKytpKSB7XG4gICAgaWYgKGlucHV0UmFuZ2VbaV0gPj0gaW5wdXQpIHtcbiAgICAgIGJyZWFrO1xuICAgIH1cbiAgfVxuICByZXR1cm4gaSAtIDE7XG59XG5cbmZ1bmN0aW9uIGNoZWNrVmFsaWRJbnB1dFJhbmdlKGFycjogQXJyYXk8bnVtYmVyPikge1xuICBpbnZhcmlhbnQoYXJyLmxlbmd0aCA+PSAyLCAnaW5wdXRSYW5nZSBtdXN0IGhhdmUgYXQgbGVhc3QgMiBlbGVtZW50cycpO1xuICBmb3IgKGxldCBpID0gMTsgaSA8IGFyci5sZW5ndGg7ICsraSkge1xuICAgIGludmFyaWFudChcbiAgICAgIGFycltpXSA+PSBhcnJbaSAtIDFdLFxuICAgICAgLyogJEZsb3dGaXhNZSg+PTAuMTMuMCkgLSBJbiB0aGUgYWRkaXRpb24gZXhwcmVzc2lvbiBiZWxvdyB0aGlzIGNvbW1lbnQsXG4gICAgICAgKiBvbmUgb3IgYm90aCBvZiB0aGUgb3BlcmFuZHMgbWF5IGJlIHNvbWV0aGluZyB0aGF0IGRvZXNuJ3QgY2xlYW5seVxuICAgICAgICogY29udmVydCB0byBhIHN0cmluZywgbGlrZSB1bmRlZmluZWQsIG51bGwsIGFuZCBvYmplY3QsIGV0Yy4gSWYgeW91IHJlYWxseVxuICAgICAgICogbWVhbiB0aGlzIGltcGxpY2l0IHN0cmluZyBjb252ZXJzaW9uLCB5b3UgY2FuIGRvIHNvbWV0aGluZyBsaWtlXG4gICAgICAgKiBTdHJpbmcobXlUaGluZylcbiAgICAgICAqL1xuICAgICAgJ2lucHV0UmFuZ2UgbXVzdCBiZSBtb25vdG9uaWNhbGx5IG5vbi1kZWNyZWFzaW5nICcgKyBhcnIsXG4gICAgKTtcbiAgfVxufVxuXG5mdW5jdGlvbiBjaGVja0luZmluaXRlUmFuZ2UobmFtZTogc3RyaW5nLCBhcnI6IEFycmF5PG51bWJlcj4pIHtcbiAgaW52YXJpYW50KGFyci5sZW5ndGggPj0gMiwgbmFtZSArICcgbXVzdCBoYXZlIGF0IGxlYXN0IDIgZWxlbWVudHMnKTtcbiAgaW52YXJpYW50KFxuICAgIGFyci5sZW5ndGggIT09IDIgfHwgYXJyWzBdICE9PSAtSW5maW5pdHkgfHwgYXJyWzFdICE9PSBJbmZpbml0eSxcbiAgICAvKiAkRmxvd0ZpeE1lKD49MC4xMy4wKSAtIEluIHRoZSBhZGRpdGlvbiBleHByZXNzaW9uIGJlbG93IHRoaXMgY29tbWVudCxcbiAgICAgKiBvbmUgb3IgYm90aCBvZiB0aGUgb3BlcmFuZHMgbWF5IGJlIHNvbWV0aGluZyB0aGF0IGRvZXNuJ3QgY2xlYW5seSBjb252ZXJ0XG4gICAgICogdG8gYSBzdHJpbmcsIGxpa2UgdW5kZWZpbmVkLCBudWxsLCBhbmQgb2JqZWN0LCBldGMuIElmIHlvdSByZWFsbHkgbWVhblxuICAgICAqIHRoaXMgaW1wbGljaXQgc3RyaW5nIGNvbnZlcnNpb24sIHlvdSBjYW4gZG8gc29tZXRoaW5nIGxpa2VcbiAgICAgKiBTdHJpbmcobXlUaGluZylcbiAgICAgKi9cbiAgICBuYW1lICsgJ2Nhbm5vdCBiZSBdLWluZmluaXR5OytpbmZpbml0eVsgJyArIGFycixcbiAgKTtcbn1cblxuY2xhc3MgQW5pbWF0ZWRJbnRlcnBvbGF0aW9uIGV4dGVuZHMgQW5pbWF0ZWRXaXRoQ2hpbGRyZW4ge1xuICAvLyBFeHBvcnQgZm9yIHRlc3RpbmcuXG4gIHN0YXRpYyBfX2NyZWF0ZUludGVycG9sYXRpb246IChcbiAgICBjb25maWc6IEludGVycG9sYXRpb25Db25maWdUeXBlLFxuICApID0+IChpbnB1dDogbnVtYmVyKSA9PiBudW1iZXIgfCBzdHJpbmcgPSBjcmVhdGVJbnRlcnBvbGF0aW9uO1xuXG4gIF9wYXJlbnQ6IEFuaW1hdGVkTm9kZTtcbiAgX2NvbmZpZzogSW50ZXJwb2xhdGlvbkNvbmZpZ1R5cGU7XG4gIF9pbnRlcnBvbGF0aW9uOiAoaW5wdXQ6IG51bWJlcikgPT4gbnVtYmVyIHwgc3RyaW5nO1xuXG4gIGNvbnN0cnVjdG9yKHBhcmVudDogQW5pbWF0ZWROb2RlLCBjb25maWc6IEludGVycG9sYXRpb25Db25maWdUeXBlKSB7XG4gICAgc3VwZXIoKTtcbiAgICB0aGlzLl9wYXJlbnQgPSBwYXJlbnQ7XG4gICAgdGhpcy5fY29uZmlnID0gY29uZmlnO1xuICAgIHRoaXMuX2ludGVycG9sYXRpb24gPSBjcmVhdGVJbnRlcnBvbGF0aW9uKGNvbmZpZyk7XG4gIH1cblxuICBfX21ha2VOYXRpdmUoKSB7XG4gICAgdGhpcy5fcGFyZW50Ll9fbWFrZU5hdGl2ZSgpO1xuICAgIHN1cGVyLl9fbWFrZU5hdGl2ZSgpO1xuICB9XG5cbiAgX19nZXRWYWx1ZSgpOiBudW1iZXIgfCBzdHJpbmcge1xuICAgIGNvbnN0IHBhcmVudFZhbHVlOiBudW1iZXIgPSB0aGlzLl9wYXJlbnQuX19nZXRWYWx1ZSgpO1xuICAgIGludmFyaWFudChcbiAgICAgIHR5cGVvZiBwYXJlbnRWYWx1ZSA9PT0gJ251bWJlcicsXG4gICAgICAnQ2Fubm90IGludGVycG9sYXRlIGFuIGlucHV0IHdoaWNoIGlzIG5vdCBhIG51bWJlci4nLFxuICAgICk7XG4gICAgcmV0dXJuIHRoaXMuX2ludGVycG9sYXRpb24ocGFyZW50VmFsdWUpO1xuICB9XG5cbiAgaW50ZXJwb2xhdGUoY29uZmlnOiBJbnRlcnBvbGF0aW9uQ29uZmlnVHlwZSk6IEFuaW1hdGVkSW50ZXJwb2xhdGlvbiB7XG4gICAgcmV0dXJuIG5ldyBBbmltYXRlZEludGVycG9sYXRpb24odGhpcywgY29uZmlnKTtcbiAgfVxuXG4gIF9fYXR0YWNoKCk6IHZvaWQge1xuICAgIHRoaXMuX3BhcmVudC5fX2FkZENoaWxkKHRoaXMpO1xuICB9XG5cbiAgX19kZXRhY2goKTogdm9pZCB7XG4gICAgdGhpcy5fcGFyZW50Ll9fcmVtb3ZlQ2hpbGQodGhpcyk7XG4gICAgc3VwZXIuX19kZXRhY2goKTtcbiAgfVxuXG4gIF9fdHJhbnNmb3JtRGF0YVR5cGUocmFuZ2U6IEFycmF5PGFueT4pOiBBcnJheTxhbnk+IHtcbiAgICByZXR1cm4gcmFuZ2UubWFwKE5hdGl2ZUFuaW1hdGVkSGVscGVyLnRyYW5zZm9ybURhdGFUeXBlKTtcbiAgfVxuXG4gIF9fZ2V0TmF0aXZlQ29uZmlnKCk6IGFueSB7XG4gICAgaWYgKF9fREVWX18pIHtcbiAgICAgIE5hdGl2ZUFuaW1hdGVkSGVscGVyLnZhbGlkYXRlSW50ZXJwb2xhdGlvbih0aGlzLl9jb25maWcpO1xuICAgIH1cblxuICAgIHJldHVybiB7XG4gICAgICBpbnB1dFJhbmdlOiB0aGlzLl9jb25maWcuaW5wdXRSYW5nZSxcbiAgICAgIC8vIE9ubHkgdGhlIGBvdXRwdXRSYW5nZWAgY2FuIGNvbnRhaW4gc3RyaW5ncyBzbyB3ZSBkb24ndCBuZWVkIHRvIHRyYW5zZm9ybSBgaW5wdXRSYW5nZWAgaGVyZVxuICAgICAgb3V0cHV0UmFuZ2U6IHRoaXMuX190cmFuc2Zvcm1EYXRhVHlwZSh0aGlzLl9jb25maWcub3V0cHV0UmFuZ2UpLFxuICAgICAgZXh0cmFwb2xhdGVMZWZ0OlxuICAgICAgICB0aGlzLl9jb25maWcuZXh0cmFwb2xhdGVMZWZ0IHx8IHRoaXMuX2NvbmZpZy5leHRyYXBvbGF0ZSB8fCAnZXh0ZW5kJyxcbiAgICAgIGV4dHJhcG9sYXRlUmlnaHQ6XG4gICAgICAgIHRoaXMuX2NvbmZpZy5leHRyYXBvbGF0ZVJpZ2h0IHx8IHRoaXMuX2NvbmZpZy5leHRyYXBvbGF0ZSB8fCAnZXh0ZW5kJyxcbiAgICAgIHR5cGU6ICdpbnRlcnBvbGF0aW9uJyxcbiAgICB9O1xuICB9XG59XG5cbm1vZHVsZS5leHBvcnRzID0gQW5pbWF0ZWRJbnRlcnBvbGF0aW9uO1xuIl19